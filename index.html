<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon-192.png">
  <meta name="theme-color" content="#1e40af">
  <title>Chatbot Koco Acreimex</title>

  <style>
    :root {
      --primary: #1e40af;
      --accent: #2563eb;
      --muted: #64748b;
      --bg: #f8f9fa;
      --card-bg: #fff;
    }

    /* PANTALLA DE LOGIN */
    #pantalla-login {
      display: flex; /* Se controla luego por JS si es necesario ocultar */
      flex-direction: column;
      align-items: center;
      justify-content: center;
      height: 100vh;
      width: 100vw;
      background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);
      position: fixed;
      top: 0;
      left: 0;
      z-index: 10000;
      color: white;
    }

    .login-card {
      background: white;
      padding: 30px;
      border-radius: 20px;
      box-shadow: 0 10px 25px rgba(0,0,0,0.2);
      width: 90%;
      max-width: 380px;
      color: #333;
      text-align: center;
    }

    .login-card input {
      width: 100%;
      padding: 12px;
      margin: 10px 0;
      border: 1px solid #ddd;
      border-radius: 8px;
      font-size: 16px;
    }

    .btn-entrar {
      width: 100%;
      padding: 12px;
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 8px;
      font-weight: bold;
      cursor: pointer;
      margin-top: 10px;
    }

    /* BODY Y ESTRUCTURA UNIFICADA */
    body {
      margin: 0;
      padding: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: #f1f5f9;
      height: 100dvh;
      overflow: hidden;
    }

    #contenido-pwa {
      display: none; /* Se activa tras el login */
      width: 100%;
      height: 100%;
    }

    .wrap {
      width: 100%;
      height: 100dvh;
      display: flex;
      justify-content: center;
    }

    .chat-container {
      background: var(--card-bg);
      display: flex;
      flex-direction: column;
      width: 100%;
      max-width: 100%; /* Ocupa todo el ancho */
      height: 100%;
      box-shadow: none;
    }

    /* HEADER */
    .chat-header {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: white;
      padding: 15px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      flex-shrink: 0;
    }

    .chat-header h1 { margin: 0; font-size: 18px; font-weight: 600; }
    .chat-header p { margin: 0; font-size: 12px; opacity: 0.9; }

    .btn-salir {
      background: rgba(255,255,255,0.2);
      color: white;
      border: 1px solid white;
      padding: 5px 12px;
      border-radius: 6px;
      cursor: pointer;
      font-size: 12px;
    }

    /* MENSAJES */
    .chat-messages {
      flex-grow: 1;
      overflow-y: auto;
      padding: 20px;
      background: #f8f9fa;
      display: flex;
      flex-direction: column;
      gap: 15px;
    }

    .message {
      padding: 12px 16px;
      border-radius: 15px;
      max-width: 85%;
      line-height: 1.5;
      font-size: 14px;
      word-wrap: break-word;
      text-align: justify;
    }

    .bot-message { background: #e3f2fd; border: 1px solid #bbdefb; align-self: flex-start; color: #1e293b; }
    .user-message { background: var(--primary); color: white; align-self: flex-end; }

    /* INPUT */
    .chat-input-container {
      padding: 15px;
      background: white;
      border-top: 1px solid #e2e8f0;
      display: flex;
      gap: 10px;
      align-items: center;
    }

    .chat-input {
      flex: 1;
      padding: 12px 18px;
      border-radius: 25px;
      border: 2px solid #e2e8f0;
      outline: none;
      font-size: 15px;
    }

    .send-btn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 50%;
      width: 45px;
      height: 45px;
      cursor: pointer;
      font-size: 20px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .footer {
      text-align: center;
      font-size: 11px;
      padding: 8px;
      color: #94a3b8;
      background: #fff;
      border-top: 1px solid #f1f5f9;
    }
  </style>
</head>

<body>

  <div id="pantalla-login" style="display: flex; flex-direction: column; align-items: center; justify-content: center; height: 100vh; width: 100vw; background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%); position: fixed; top: 0; left: 0; z-index: 10000; color: white;">
    <div class="login-card" style="background: white; padding: 30px; border-radius: 20px; box-shadow: 0 10px 25px rgba(0,0,0,0.2); width: 90%; max-width: 380px; color: #333; text-align: center;">
      <h1 style="font-size: 24px; font-weight: bold; margin-bottom: 5px;">Koco Acreimex</h1>
      <p style="color: #64748b; margin-bottom: 20px;">Inicia sesi√≥n para continuar</p>
      <input type="email" id="loginEmail" placeholder="Usuario o Correo" style="width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
      <input type="password" id="loginPass" placeholder="Contrase√±a" style="width: 100%; padding: 12px; margin: 10px 0; border: 1px solid #ddd; border-radius: 8px; font-size: 16px;">
      <button class="btn-entrar" id="btnEntrar" style="width: 100%; padding: 12px; background: #1e40af; color: white; border: none; border-radius: 8px; font-weight: bold; cursor: pointer; margin-top: 10px;">ACCEDER</button>
    </div>
  </div>

  <div id="contenido-pwa" style="display: none; width: 100%; height: 100dvh;">
    <div class="wrap" style="width: 100%; height: 100%; display: flex; flex-direction: column;">
      <div class="chat-container" role="application" aria-label="Asistente Cr√©ditos Solidarios - Koco" style="background: #fff; display: flex; flex-direction: column; height: 100%; width: 100%;">
        
        <div class="chat-header" style="display: flex; justify-content: space-between; align-items: center; background: linear-gradient(135deg, #1e40af, #2563eb); color: white; padding: 15px 20px; flex-shrink: 0;">
          <div>
            <h1 id="company-title" style="margin: 0; font-size: 20px; font-weight: 600;">Asistente de la Coordinaci√≥n de cr√©ditos solidarios</h1>
            <p id="company-sub" style="margin: 0; font-size: 13px; opacity: 0.9;">KOCO SOLIDARIO</p>
          </div>
          
          <div style="text-align: right; min-width: 150px;">
            <button class="btn-salir" id="btnSalir" style="margin-bottom: 8px; background: rgba(255,255,255,0.2); border: 1px solid white; color: white; padding: 5px 12px; border-radius: 6px; cursor: pointer; font-size: 12px;">
              Cerrar Sesi√≥n
            </button>
            <div style="display: block;">
              <big id="footer-message-small" style="font-style: italic; display: block;">
                üíñü§ù Tu trabajo abre oportunidades donde antes solo hab√≠a sue√±os. üå±üí´
              </big>
            </div>
          </div>
        </div>

        <div class="chat-messages" id="chatMessages" aria-live="polite" style="flex-grow: 1; overflow-y: auto; padding: 20px; background: #f8f9fa;"></div>

        <div class="chat-input-container" style="padding: 15px; background: white; border-top: 1px solid #e2e8f0; display: flex; gap: 10px; align-items: center;">
          <input id="messageInput" class="chat-input" type="text" 
                 placeholder="Escribe tu pregunta..." 
                 maxlength="500" 
                 aria-label="Escribe tu consulta"
                 style="flex: 1; padding: 12px 18px; border-radius: 25px; border: 2px solid #e2e8f0; outline: none;">
          <button id="sendBtn" class="send-btn" type="button" aria-label="Enviar mensaje" style="background: #1e40af; color: white; border: none; border-radius: 50%; width: 45px; height: 45px; cursor: pointer; font-size: 20px; display: flex; align-items: center; justify-content: center;">‚û§</button>
        </div>

        <div class="footer" style="text-align: center; font-size: 11px; padding: 8px; color: #94a3b8; background: #fff; border-top: 1px solid #f1f5f9;">Informaci√≥n actualizada y confiable ‚Ä¢ TU AMIGO SOLIDARIO</div>
      </div>
    </div>
  </div>

  </script>

</body>
<script>
    const defaultConfig = {
      background_color: "#0052CC",
      secondary_surface_color: "#FFFFFF",
      text_color: "#1f2937",
      primary_action_color: "#0052CC",
      secondary_action_color: "#E6F2FF",
      font_family: "Segoe UI",
      font_size: 16,
      chat_title: "Asistente de la Coordinaci√≥n de cr√©ditos solidarios",
      chat_subtitle: "Grupal ‚Äî TU AMIGO SOLIDARIO",
      header_message: "üíñü§ù Tu trabajo abre oportunidades donde antes solo hab√≠a sue√±os. üå±üí´",
      footer_text: "Informaci√≥n actualizada y confiable ‚Ä¢ TU AMIGO SOLIDARIO",
      input_placeholder: "Escribe tu pregunta..."
    };

    const keywords = {
  ingresos: ['ingresos','comprobantes','ventas','evidencias','flujo','utilidad','actualizaci√≥n','actualizacion','estado de resultados','ganancias','facturaci√≥n','corte de caja','ingreso mensual','ingreso semanal','capacidad de pago','balance','movimientos','soporte de ingresos','actividad econ√≥mica','ventas diarias','registro de ventas','flujo de efectivo','utilidades netas','comprobaci√≥n'],

  igualacion: ['igualacion','igualaci√≥n','montos','nivelar','ajuste','correspondencia','equiparar','homologar','balancear','regular','redistribuir','adecuaci√≥n','alinear montos','ajuste de cr√©dito','nivelaci√≥n','equilibrar','igualar','actualizar montos','asignaci√≥n','asignaci√≥n de ciclo','monto por ciclo','ajuste grupal','asignacion de ciclo','monto similar','monto equivalente','recalcular','monto trabajado'],

  domicilio: ['vivienda','rentado','domicilio familiar','domicilio propio','vivienda rentada o prestada','domicilio prestado','identificar','rentada','diferenciar'],

  renovacion: ['renovaci√≥n','renovacion','anticipada','reactivar','renovar cr√©dito','nuevo ciclo','continuidad','siguiente cr√©dito','refinanciar','reenganche','renovaci√≥n grupal','renovaci√≥n individual','cr√©dito recurrente','nuevo pr√©stamo','recredito','reapertura','renovaci√≥n anticipada','extensi√≥n de cr√©dito','seguimiento','historial vigente','cr√©dito activo','recontrataci√≥n','nuevo desembolso','revisi√≥n de cr√©dito'],

  montos: ['70000','mayor a 70000','superiores a 70000','monto superior','monto mayor','monto m√°ximo','monto autorizado','monto permitido','monto solicitado','monto aprobado','monto total','incremento de monto','incremento hasta 100000','tope de cr√©dito','l√≠mite de cr√©dito','l√≠mite m√°ximo','capacidad m√°xima','cr√©dito alto','capital','importe','cantidad','valor del cr√©dito','nivel de cr√©dito','rango de cr√©dito'],

  adicional: ['adicional','extra','complementario','programa','cr√©dito adicional','segundo cr√©dito','cr√©dito paralelo','cr√©dito extra','financiamiento adicional','monto adicional','apoyo extra','cr√©dito complementario','extensi√≥n','refuerzo financiero','capital adicional','ampliaci√≥n','nuevo apoyo','cr√©dito alterno','adicional grupal','cr√©dito secundario','incremento adicional','l√≠nea adicional','financiamiento extra','apoyo econ√≥mico','monto complementario'],

  coordinacion: ['producto','productos','mixto','cr√©dito mixto','poder mujer','mujer','cr√©dito mujer','preferente','cr√©dito preferente','consumo','cr√©dito de consumo','simulador','simular','simulaci√≥n','tabla','plan','esquema','modalidad','tipo de cr√©dito','segmento','clasificaci√≥n','configuraci√≥n','condiciones','par√°metros','estructura','programa','pol√≠tica'],

  nuevos: ['nuevos','grupo','nuevo grupo','integrantes nuevos','alta de grupo','formaci√≥n de grupo','grupo nuevo','primer cr√©dito','garantia','nuevo ingreso','alta','registro de grupo','cobertura de cr√©dito','grupo solidario','integraci√≥n','requisitos de grupo','grupo inicial','creaci√≥n de grupo','nuevo ciclo','primer desembolso','seguro de cr√©dito','grupo reciente','socios nuevos','nuevo financiamiento'],

  sucursal: ['sucursal','cambio','traslado','movimiento','reubicaci√≥n','cambio de sucursal','transferencia','reasignaci√≥n','oficina','agencia','punto de atenci√≥n','dependencia','gesti√≥n en sucursal','cambio operativo','sucursal origen','sucursal destino','atenci√≥n','ubicaci√≥n','oficina regional','gesti√≥n local','movimiento de expediente','cambio administrativo','reasignar','nueva sucursal'],

  multas: ['multas','penalizaciones','recargos','sanciones','castigo','mora','intereses moratorios','cargo','penalidad','incumplimiento','atraso','falta de pago','multa por atraso','penalizaci√≥n','penalizacion','adeudo','deuda','intereses','cargo adicional','castigo financiero','penalizaci√≥n por atraso','omisi√≥n','mora crediticia'],

  expedientes: ['expediente','nuevo expediente','crear expediente','registro','archivo','carpeta','expediente grupal','expediente individual','alta de expediente','integraci√≥n','requisitos','control documental','archivo digital','validaci√≥n','revisi√≥n de expediente','apertura de expediente','carga documental','fotograf√≠a grupal','expediente de cr√©dito'],

  generalidades: ['fuera de sucursal','campo','desembolso','desemboloso en campo','entrega en campo'],

  esquema: [   // ‚úÖ AQU√ç ESTABA EL ERROR
    'esquema',
    'esquema de evaluaci√≥n',
    'evaluaci√≥n asesores',
    'evaluacion asesores',
    'incentivo',
    'incentivos',
    'bono',
    'bono mensual',
    'bono extraordinario',
    'parametros',
    'par√°metros',
    'condiciones incentivo',
    'indicadores'
  ],

  recuperacion: ['recuperacion','cobranza','gestion de recuperacion','etapa preventiva','etapa administrativa','etapa extrajudicial','mora','cartera vencida','atraso','gestor de recuperacion','recuperaci√≥n','gestiones'],

  comprobante: ['recibo','cfe','predial','comprobante de domicilio','direccion','direcci√≥n','hogar','casa','residencia','luz','fachada','evidencia fotografica'],

  adulto: ['mayor de 70 a√±os','mayores de 70 a√±os','adulto mayor','adultos mayores','3ra edad','tersera edad','tercera edad','edad avanzada','persona grande','personas grandes','abuelito','abuelita','mayor de 70','arriba de 70 a√±os','superan los 70','rebasan los 70'],

  incremento: ['incremento','socios antiguos','historial','sin cr√©dito vigente','inactivos','reactivaci√≥n','cliente antiguo','buen historial','historial positivo','socios acreimex','clientes recurrentes','reactivar socio','nuevo cr√©dito','incremento por historial','historial de pagos','clientes inactivos','reincorporaci√≥n','regreso a cr√©dito','evaluaci√≥n hist√≥rica','monto previo','capacidad de pago'],

  saldos: ['saldos','insolutos','renovaci√≥n de saldos','capital pendiente','saldo capital','adeudo','cr√©dito vencido','cr√©dito en atraso','regularizaci√≥n','saldos vencidos','renovar saldo','liquidaci√≥n parcial','capital insoluto','pago pendiente','saldo grupal','saldo adicional','restructura','reprogramaci√≥n','intenci√≥n de pago'],

  recurso: ['comprobaci√≥n','aplicaci√≥n','comprobacion','aplicacion','recurso','comprobar'],

  impulso: ['impulso','solidario','nuevo producto'],

  si: ['si','s√≠','claro','por supuesto','adelante','ok','vale'],

  no: ['no','nope','negativo','no gracias','paso']
};
    const farewellKeywords = ["adios","adi√≥s","bye","hasta luego","gracias","chao","es todo"];
    
    let conversationContext = null;

    function addMessage(content, isUser = false) {
      const messagesContainer = document.getElementById("chatMessages");
      const messageDiv = document.createElement("div");
      messageDiv.className = "message " + (isUser ? "user-message" : "bot-message");
      
      if (typeof content === 'string') {
        messageDiv.textContent = content;
      } else {
        messageDiv.appendChild(content);
      }
      
      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function createTable(headers, rows) {
      const table = document.createElement("table");
      const thead = document.createElement("thead");
      const headerRow = document.createElement("tr");
      
      headers.forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);
      table.appendChild(thead);
      
      const tbody = document.createElement("tbody");
      rows.forEach(rowData => {
        const tr = document.createElement("tr");
        rowData.forEach(cellData => {
          const td = document.createElement("td");
          td.textContent = cellData;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);
      
      return table;
    }

    function includesKeyword(message, list) {
      return list.some(kw => message.includes(kw));
    }

    function getResponse(input) {
      const lower = input.toLowerCase().trim();
// Manejar respuestas SI/NO seg√∫n el contexto
if (conversationContext && includesKeyword(lower, keywords.si)) {
  if (conversationContext === 'impulso_pregunta') {
    conversationContext = null;

    const container = document.createElement("div");

    // ESTILO GLOBAL DE LA TARJETA (FONDO CREMA Y L√çNEA AZUL cielo)
    container.style.backgroundColor = "#fdf5e8";
    container.style.borderLeft = "6px solid #6495ED";
    container.style.borderTop = "1px solid #e0e0e0";
    container.style.borderRight = "1px solid #e0e0e0";
    container.style.borderBottom = "1px solid #e0e0e0";
    container.style.borderRadius = "10px";
    container.style.padding = "25px";
    container.style.margin = "15px 0";
    container.style.fontFamily = "Arial, sans-serif";
    container.style.boxShadow = "0 2px 5px rgba(0,0,0,0.05)";

    // T√çTULO PRINCIPAL
    const title = document.createElement("h2");
    title.innerHTML = "POL√çTICAS DEL CR√âDITO IMPULSO SOLIDARIO ACR";
    title.style.color = "#0d214a";
    title.style.fontSize = "18px";
    title.style.marginTop = "0";
    title.style.marginBottom = "20px";
    title.style.fontWeight = "bold";
    title.style.textTransform = "uppercase";
    container.appendChild(title);

    const contentDiv = document.createElement("div");

    const politicas = [
      { texto: "<strong>Historial grupal o captaci√≥n:</strong> Contar con historial grupal en Cooperativa Acreimex o que los socios hayan sido captados a trav√©s de una pl√°tica informativa para cr√©dito en modalidad de grupo." },
      { texto: "<strong>Nivel de riesgo:</strong> √önicamente se podr√° otorgar a socios clasificados con nivel de riesgo <strong>bajo o medio</strong> de acuerdo con el an√°lisis del reporte de la Sociedad de Informaci√≥n Crediticia (SIC)." },
      { texto: "<strong>Socios sin historial grupal:</strong> Para socios sin historial grupal en Cooperativa Acreimex el tipo de vivienda deber√° ser <strong>propio o familiar</strong>." },
      { texto: "<strong>Socios con historial (m√≠nimo 3 cr√©ditos pagados):</strong> Para socios con historial en Cooperativa Acreimex con un m√≠nimo de <strong>3 cr√©ditos pagados</strong> en modalidad grupal y que, de acuerdo con las necesidades del socio, requiera un plazo o monto superior al otorgado en el cr√©dito grupal o que por situaciones internas del grupo no se cuente con el m√≠nimo de los 3 integrantes requeridos en la mesa directiva, debiendo cumplir con lo siguiente:<br><span style='margin-left: 15px; display: block;'>‚Ä¢ <strong>a)</strong> No haber reflejado atrasos de m√°s de 1 cuota en su √∫ltimo cr√©dito grupal.</span><span style='margin-left: 15px; display: block;'>‚Ä¢ <strong>b)</strong> Firma de un <strong>aval</strong>, no deber√° ser familiar del acreditado ni compartir el mismo domicilio.</span>" },
      { texto: "<strong>Tasa para socios con historial:</strong> Para socios con historial en Cooperativa Acreimex la tasa de inter√©s ser√° con relaci√≥n al monto solicitado." },
      { texto: "<strong>Socios prospectados sin historial:</strong> Socios sin historial grupal en Cooperativa Acreimex que hayan sido prospectados por el asesor de cr√©ditos con la intenci√≥n de solicitar un cr√©dito en modalidad grupal y que de acuerdo con el an√°lisis realizado a todos los integrantes no se haya podido formalizar la solicitud, deber√° cumplir con lo siguiente:<br><span style='margin-left: 15px; display: block;'>‚Ä¢ <strong>a)</strong> El cr√©dito se podr√° otorgar a un m√≠nimo de <strong>dos</strong> y hasta <strong>cuatro socios</strong> los cuales deber√°n ser obligados solidarios entre s√≠.</span><span style='margin-left: 15px; display: block;'>‚Ä¢ <strong>b)</strong> Los plazos, periodicidad y d√≠a de pago deber√°n ser los mismos para ambos acreditados.</span><span style='margin-left: 15px; display: block;'>‚Ä¢ <strong>c)</strong> Los montos para otorgar ser√°n de acuerdo con la tabla de ciclos del producto y deber√°n ser otorgados con el mismo plazo y periodicidad de su origen.</span>" },
      { texto: "<strong>Tasa para socios sin historial:</strong> Para socios sin historial grupal en Cooperativa Acreimex la tasa de inter√©s ser√° con base a la tabla de ciclos del producto." }
    ];

    politicas.forEach((p, index) => {
      const pDiv = document.createElement("div");
      pDiv.style.display = "flex";
      pDiv.style.marginBottom = "12px";
      pDiv.style.alignItems = "flex-start";
      pDiv.innerHTML = `
        <span style="color: #000; font-weight: bold; min-width: 25px;">${index + 1}.</span>
        <span style="font-size: 14.5px; color: #333; line-height: 1.5;">${p.texto}</span>
      `;
      contentDiv.appendChild(pDiv);
    });

    container.appendChild(contentDiv);

    // PIE DE P√ÅGINA
    const footer = document.createElement("p");
    footer.style.textAlign = "justify";
    footer.style.fontWeight = "bold";
    footer.style.color = "#1f3c73";
    footer.style.marginTop = "20px";
    footer.style.fontSize = "15px";
    footer.textContent = "¬øHay algo m√°s en lo que te pueda servir? üòä";
    container.appendChild(footer);

    return { type: 'html', content: container };
  }
}
     
      if (farewellKeywords.some(kw => lower === kw || lower.includes(kw))) {
        const h = new Date().getHours();
        const morning = ["üòä Gracias por comunicarte con Koco. ¬°Que tengas un excelente d√≠a! ü§ù","üåÖ Fue un gusto ayudarte ‚Äî que tu ma√±ana sea productiva.","‚òÄÔ∏è Gracias por usar Cr√©ditos Solidarios. ¬°√âxito en tu d√≠a!"];
        const afternoon = ["‚òÄÔ∏è Fue un gusto apoyarte, ¬°te deseo una tarde productiva!","‚òÄÔ∏è Gracias por comunicarte con Koco. ¬°Que tengas una excelente tarde! ü§ù","ü´∂ Gracias por tu tiempo ‚Äî que la tarde te sea favorable."];
        const night = ["üåô Descansa, gracias por confiar en Cr√©ditos Solidarios.","üåü Que tengas buenas noches ‚Äî Koco siempre est√° para ayudarte.","üò¥ Gracias por comunicarte. ¬°Hasta pronto y buenas noches!"];
        let messages;
        if (h >= 6 && h < 12) messages = morning;
        else if (h >= 12 && h < 18) messages = afternoon;
        else messages = night;
        return { type: 'text', content: messages[Math.floor(Math.random() * messages.length)] };
      }
// Detectar pregunta sobre Impulso Solidario
const impulsoDirecto = lower.includes('impulso') && lower.includes('solidario');
const esCalculadora = lower.includes('calculadora') || lower.includes('simular');

if (impulsoDirecto && !esCalculadora) {
  conversationContext = 'impulso_pregunta';

  const data = {
    titulo: "IMPULSO SOLIDARIO ACR",
    intro: "El producto <strong>IMPULSO SOLIDARIO ACR</strong> est√° dise√±ado para socios con historial grupal en la cooperativa y socios nuevos clasificados con nivel de riesgo bajo o medio que provengan de una pl√°tica informativa para cr√©dito en modalidad grupal, de la cual no se haya podido formalizar la solicitud debido a que algunos prospectos no clasificaron para el cr√©dito (no sujetos o riesgo alto).",
    pregunta: "1. ¬øEn qu√© supuestos le podemos realizar tr√°mite con este producto a un socio con historial grupal en la cooperativa?",
    secciones: [
      {
        encabezado: "SOCIOS CON HISTORIAL GRUPAL EN ACR:",
        items: [
          { letra: "‚Ä¢", texto: "Se puede ofertar a socios de grupos que se desintegran y que no completan los 3 integrantes de la mesa directiva, es decir: <strong>Cuando √∫nicamente quedan 2 integrantes y no logran conseguir a m√°s integrantes o estos no clasifican para el cr√©dito</strong>." },
          { letra: "‚Ä¢", texto: "Cuando un socio pide salirse de su grupo por conflictos internos o para solicitar un cr√©dito con un monto o plazo mayor, siempre y cuando no se rebasen los 12 meses y los $100,000.00." }
        ],
        objetivo: "Que nosotros les sigamos otorgando el financiamiento para <strong>que tu cartera de cr√©dito no pierda valor y socios</strong> por grupos desintegrados o por salidas de socios que quieren tener su propio cr√©dito por un plazo o monto mayor."
      },
      {
        encabezado: "SOCIOS NUEVOS:",
        items: [
          { letra: "‚Ä¢", texto: "Se puede otorgar a personas que estaban interesadas en formar un cr√©dito grupal, pero <strong>que no lograron formalizar debido a que algunos interesados no pasaron el filtro de la consulta de bur√≥ de cr√©dito</strong>." },
          { letra: "‚Ä¢", texto: "<strong>Aplica</strong> cuando √∫nicamente 4 prospectos o menos son considerados sujetos de cr√©dito con nivel de riesgo bajo o medio." },
          { letra: "‚Ä¢", texto: "En casos en los que 5 prospectos o m√°s pasan el filtro como sujetos a cr√©dito con nivel de riesgo bajo o medio, <strong>el tr√°mite se debe realizar con un producto en modalidad grupal</strong>." }
        ],
        objetivo: "Que de las pl√°ticas informativas que realices <strong>en las que no se hayan completado los integrantes</strong> para formar su grupo, <strong>tengas la oportunidad de otorgarle cr√©dito a los prospectos que si pasaron el filtro de bur√≥ de cr√©dito...</strong>"
      }
    ]
  };

  const seccionesHTML = data.secciones.map((sec, index) => `
    <div style="margin-top: ${index === 0 ? '0' : '25px'};">
      <p style="margin-bottom: 12px; font-weight: bold; color: #1f3c73; font-size: 15.5px;">
        ${sec.encabezado}
      </p>
      
      <div style="padding-left: 5px;">
        ${sec.items.map(item => `
          <div style="display: flex; margin-bottom: 10px; align-items: flex-start;">
            <span style="color: #000000; font-weight: bold; min-width: 25px;">${item.letra}</span>
            <span style="font-size: 14.5px; color: #333; line-height: 1.5;">${item.texto}</span>
          </div>
        `).join('')}
      </div>

      <div style="margin: 15px 0; padding: 15px; border-radius: 8px; background-color: #fffbcc; border: 1px solid #f0e68c;">
        <p style="margin: 0; font-size: 14px; line-height: 1.4; color: #000000;">
          <strong style="color: #f28511;">Objetivo principal:</strong> <em>${sec.objetivo}</em>
        </p>
      </div>
    </div>
  `).join('');

  const cardContainer = document.createElement("div");
  cardContainer.style.backgroundColor = "#fdf5e8"; // Fondo Crema
  cardContainer.style.borderLeft = "6px solid #6495ED"; // L√≠nea lateral Azul
  cardContainer.style.borderTop = "1px solid #e0e0e0";
  cardContainer.style.borderRight = "1px solid #e0e0e0";
  cardContainer.style.borderBottom = "1px solid #e0e0e0";
  cardContainer.style.borderRadius = "10px";
  cardContainer.style.padding = "25px";
  cardContainer.style.margin = "15px 0";
  cardContainer.style.fontFamily = "Arial, sans-serif";

  cardContainer.innerHTML = `
    <h2 style="color: #0d214a; font-size: 19px; margin-top: 0; margin-bottom: 20px; font-weight: bold; text-transform: uppercase;">
      ${data.titulo}
    </h2>
    <p style="font-size: 14.5px; color: #333; line-height: 1.6; margin-bottom: 20px;">${data.intro}</p>
    <p style="font-weight: bold; color: #1f3c73; font-size: 15.5px; border-bottom: 1px solid #e0e0e0; padding-bottom: 10px; margin-bottom: 15px;">
      ${data.pregunta}
    </p>
    ${seccionesHTML}
    <p style="margin-top: 25px; font-weight: bold; color: #1f3c73; text-align: justify; font-size: 15px;">
      ¬øDeseas conocer las pol√≠ticas para acceder a este cr√©dito?
    </p>
  `;

  return { type: 'html', content: cardContainer };
}
if (keywords.ingresos.some(kw => lower.includes(kw))) {
  const data = {
    titulo: "COMPROBANTE DE INGRESOS",
    secciones: [
      {
        encabezado: "1. Supuestos de actualizaci√≥n del comprobante de ingresos:",
        items: [
          { letra: "a)", texto: "Se deber√°n actualizar las evidencias siempre y cuando las deudas en el an√°lisis del SIC tengan un aumento mayor al 25 % de las deudas reportadas en el ciclo que finaliza (del mismo tipo de cr√©dito)." },
          { letra: "b)", texto: "Cuando el monto a solicitar rebase los $5,000.00 de aumento en comparaci√≥n con el monto m√°ximo otorgado por la cooperativa en cr√©dito grupal." },
          { letra: "c)", texto: "Se deben actualizar cada a√±o a partir de fecha atestada por el asesor o el personal operativo." }
        ],
        nota: "Para los grupos que paguen correctamente no aplica inciso A y B salvo causas o circunstancias que se justifiquen en el sistema."
      },
      {
        encabezado: "2. Para cr√©ditos adicionales:",
        items: [
          { letra: "a)", texto: "S√≥lo cuando el cr√©dito adicional anterior tenga m√°s de 1 cuota en atraso." }
        ]
      }
    ]
  };

  const seccionesHTML = data.secciones.map((sec, index) => `
    <div style="margin-top: ${index === 0 ? '0' : '25px'};">
      <p style="margin-bottom: 12px; font-weight: bold; color: #1f3c73; font-size: 15px;">
        ${sec.encabezado}
      </p>
      
      <div style="padding-left: 5px;">
        ${sec.items.map(item => `
          <div style="display: flex; margin-bottom: 10px; align-items: flex-start;">
            <span style="color: #000000; font-weight: bold; min-width: 30px;">${item.letra}</span>
            <span style="font-size: 14.5px; color: #333;">${item.texto}</span>
          </div>
        `).join('')}
      </div>

      ${sec.nota ? `
        <div style="margin: 15px 0; padding: 12px; border-radius: 8px; background-color: #FFFBCC; border: 1px solid #d0e0ff;">
          <p style="margin: 0; font-size: 13.5px; line-height: 1.4; color: #000000;">
            <strong style="color: #f28511;">Nota:</strong> <em>${sec.nota}</em>
          </p>
        </div>
      ` : ''}
    </div>
  `).join('');

  const cardContainer = document.createElement("div");
  // FONDO AMARILLO CREMA GLOBAL
  cardContainer.style.backgroundColor = "#fdf5e8"; 
  cardContainer.style.borderLeft = "6px solid #6495ED"; 
  cardContainer.style.borderTop = "1px solid #e0e0e0";
  cardContainer.style.borderRight = "1px solid #e0e0e0";
  cardContainer.style.borderBottom = "1px solid #e0e0e0";
  cardContainer.style.borderRadius = "8px";
  cardContainer.style.padding = "20px";
  cardContainer.style.margin = "15px 0";
  cardContainer.style.fontFamily = "Arial, sans-serif";

  cardContainer.innerHTML = `
    <h2 style="color: #0d214a; font-size: 18px; margin-top: 0; margin-bottom: 20px; font-weight: bold; text-transform: uppercase;">
      ${data.titulo}
    </h2>
    ${seccionesHTML}
  `;

  return { type: 'html', content: cardContainer };
}

if (keywords.esquema.some(kw => lower.includes(kw))) {
  const container = document.createElement("div");

  // --- ESTILOS DE TABLA (CENTRADO Y NEGRITAS) ---
  const tableStyle = `width:100%; border-collapse:collapse; font-family:Arial, sans-serif; font-size:12px; margin-top:10px; border:1px solid #000; background-color: white;`;
  const headerStyle = `background:#1f3c73; color:white; border:1px solid #000; padding:10px; text-align:center; font-weight:bold; text-transform:uppercase;`;
  const cellStyle = `border:1px solid #000; padding:8px; text-align:center; font-weight:bold; color:#333;`;

  // --- FUNCI√ìN DE CONSTRUCCI√ìN DE TARJETAS (ESTILO INGRESOS) ---
  const crearCardEvaluacion = (titulo, contenidoHtml) => {
    const card = document.createElement("div");
    card.style.cssText = `
      background-color: #fdf5e8;
      border-left: 6px solid #6495ED;
      border-top: 1px solid #e0e0e0;
      border-right: 1px solid #e0e0e0;
      border-bottom: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      font-family: Arial, sans-serif;
    `;
    if (titulo) {
      card.innerHTML = `<p style="margin-bottom: 15px; font-weight: bold; color: #1f3c73; font-size: 16px; text-transform: uppercase;">${titulo}</p>`;
    } else {
      card.innerHTML = '';
    }
    card.innerHTML += `<div style="font-size: 14px; color: #333; line-height: 1.6;">${contenidoHtml}</div>`;
    return card;
  };

  // T√çTULO PRINCIPAL
  const mainTitle = document.createElement("h2");
  mainTitle.style.cssText = "color: #1f3c73; font-size: 19px; font-weight: bold; text-transform: uppercase; margin-bottom: 20px; padding-left: 5px;";
  mainTitle.textContent = "Esquema de Evaluaci√≥n para Asesores de Cr√©dito y Recuperaci√≥n Solidarios.";
  container.appendChild(mainTitle);

  // 1. OBJETIVO
  container.appendChild(crearCardEvaluacion("OBJETIVO", `
    <p>Con el objetivo de ofrecer un servicio extraordinario a nuestros socios, se ajustan las pol√≠ticas del esquema de evaluaci√≥n para los Asesores de Cr√©dito y Recuperaci√≥n Solidarios, con la finalidad de mejorar la administraci√≥n de la cartera de cr√©dito y su desempe√±o en las sucursales, el cual entrar√° en vigor a partir del 01 de noviembre de 2025 bajo las siguientes:</p>
  `));

  // 2. CONDICIONES
  container.appendChild(crearCardEvaluacion("üîπ CONDICIONES PARA PARTICIPAR EN EL INCENTIVO", `
    <div style="padding-left: 5px;">
      <div style="display:flex; margin-bottom:8px;"><span style="min-width:30px; font-weight:bold;">a)</span><span>Haber cumplido el periodo de prueba.</span></div>
      <div style="display:flex; margin-bottom:8px;"><span style="min-width:30px; font-weight:bold;">b)</span><span>Administrar como m√≠nimo la cantidad de $1,300,001.00.</span></div>
      <div style="display:flex; margin-bottom:8px;"><span style="min-width:30px; font-weight:bold;">c)</span><span>Administrar como m√≠nimo la cantidad de 90 socios.</span></div>
      <div style="display:flex; margin-bottom:8px;"><span style="min-width:30px; font-weight:bold;">d)</span><span>Tener un √≠ndice de cartera vencida (4 cuotas acumuladas o m√°s) igual o menor al 5% del total de cartera administrada.</span></div>
      <div style="display:flex; margin-bottom:8px;"><span style="min-width:30px; font-weight:bold;">e)</span><span>Tener un √≠ndice de cartera vigente en 0 cuotas vencidas igual o mayor al 85% del total de cartera administrada.</span></div>
    </div>
  `));

  // 3. PAR√ÅMETROS A EVALUAR
  container.appendChild(crearCardEvaluacion("üîπ PAR√ÅMETROS A EVALUAR", `
    <p>El incentivo se conforma de los siguientes par√°metros:</p>
    <table style="${tableStyle}">
      <thead>
        <tr><th colspan="3" style="${headerStyle}">PAR√ÅMETROS DEL INCENTIVO</th></tr>
        <tr style="background:#2c4c8a; color:white;">
          <th style="border:1px solid #000; padding:8px;">PAR√ÅMETROS</th>
          <th style="border:1px solid #000; padding:8px;">CONDICI√ìN</th>
          <th style="border:1px solid #000; padding:8px;">MONTO DEL INCENTIVO</th>
        </tr>
      </thead>
      <tbody>
        <tr><td style="${cellStyle}">Cartera vigente en cero cuotas vencidas igual o mayor al 90%.</td><td style="${cellStyle}">Binario (s√≠/no)</td><td style="${cellStyle}">$1,000.00</td></tr>
        <tr><td style="${cellStyle}">Cartera vencida desde cuatro cuotas en adelante igual o menor a 5%.</td><td style="${cellStyle}">Binario (s√≠/no)</td><td style="${cellStyle}">$1,000.00</td></tr>
        <tr><td style="${cellStyle}">N√∫mero de cr√©ditos y monto de cr√©ditos desembolsados.</td><td style="${cellStyle}">De acuerdo con el tabulador</td><td style="${cellStyle}">Hasta $2,000.00</td></tr>
        <tr><td style="${cellStyle}">Acreditados nuevos.</td><td style="${cellStyle}">De acuerdo con el tabulador</td><td style="${cellStyle}">Hasta $1,500.00</td></tr>
        <tr><td style="${cellStyle}">Crecimiento de la cartera total administrada en comparaci√≥n con el cierre de ejercicio anterior.</td><td style="${cellStyle}">De acuerdo con el tabulador</td><td style="${cellStyle}">Hasta $1,500.00</td></tr>
        <tr style="background:#f2f2f2;"><td colspan="2" style="${cellStyle} text-align:right;">TOTAL</td><td style="${cellStyle}">$7,000.00</td></tr>
      </tbody>
    </table>
  `));

  // 4. CR√âDITOS Y MONTOS
  container.appendChild(crearCardEvaluacion("üîπ N√öMERO DE CR√âDITOS DESEMBOLSADOS Y MONTOS DESEMBOLSADOS.", `
    <table style="${tableStyle}">
      <thead>
        <tr style="${headerStyle}">
          <th style="border:1px solid #000; padding:8px;">N√öMERO DE CR√âDITOS DESEMBOLSADOS EN EL MES</th>
          <th style="border:1px solid #000; padding:8px;">MONTO GANADO</th>
          <th style="border:1px solid #000; padding:8px;">MONTO DE CR√âDITOS DESEMBOLSADOS EN EL MES</th>
          <th style="border:1px solid #000; padding:8px;">MONTO GANADO</th>
        </tr>
      </thead>
      <tbody>
        <tr><td style="${cellStyle}">De 26 a 35</td><td style="${cellStyle}">$200.00</td><td style="${cellStyle}">$500,000.00 - $1,000,000.00</td><td style="${cellStyle}">$200.00</td></tr>
        <tr><td style="${cellStyle}">De 36 a 45</td><td style="${cellStyle}">$350.00</td><td style="${cellStyle}">$1,000,000.01 - $1,500,000.00</td><td style="${cellStyle}">$350.00</td></tr>
        <tr><td style="${cellStyle}">De 46 a 55</td><td style="${cellStyle}">$500.00</td><td style="${cellStyle}">$1,500,001.00 - $2,000,000.00</td><td style="${cellStyle}">$500.00</td></tr>
        <tr><td style="${cellStyle}">De 56 a 65</td><td style="${cellStyle}">$650.00</td><td style="${cellStyle}">$2,000,001.00 - $2,500,000.00</td><td style="${cellStyle}">$650.00</td></tr>
        <tr><td style="${cellStyle}">De 65 a 75</td><td style="${cellStyle}">$800.00</td><td style="${cellStyle}">$2,500,001.00 - $3,000,001.00</td><td style="${cellStyle}">$800.00</td></tr>
        <tr><td style="${cellStyle}">De 75 o m√°s</td><td style="${cellStyle}">$1,000.00</td><td style="${cellStyle}">M√ÅS DE $3,000,001.00</td><td style="${cellStyle}">$1,000.00</td></tr>
      </tbody>
    </table>
  `));

  // 5. ACREDITADOS NUEVOS
  container.appendChild(crearCardEvaluacion("üîπ ACREDITADOS NUEVOS", `
    <table style="${tableStyle}">
      <thead><tr style="${headerStyle}"><th style="border:1px solid #000; padding:8px;">N√öMERO REQUERIDO DE ACREDITADOS NUEVOS</th><th style="border:1px solid #000; padding:8px;">MONTO GANADO</th></tr></thead>
      <tbody>
        <tr><td style="${cellStyle}">De 4 a 5</td><td style="${cellStyle}">$350.00</td></tr>
        <tr><td style="${cellStyle}">De 6 a 10</td><td style="${cellStyle}">$800.00</td></tr>
        <tr><td style="${cellStyle}">De 11 a 13</td><td style="${cellStyle}">$1,200.00</td></tr>
        <tr><td style="${cellStyle}">14 o m√°s</td><td style="${cellStyle}">$1,500.00</td></tr>
      </tbody>
    </table>
  `));

  // 6. CRECIMIENTO CARTERA
  container.appendChild(crearCardEvaluacion("üîπ CRECIMIENTO DE LA CARTERA TOTAL ADMINISTRADA", `
    <table style="${tableStyle}">
      <thead><tr style="${headerStyle}"><th style="border:1px solid #000; padding:8px;">MONTO DE CRECIMIENTO DE CARTERA AL CIERRE DE MES EN COMPARACI√ìN CON EL CIERRE DEL EJERCICIO ANTERIOR</th><th style="border:1px solid #000; padding:8px;">MONTO GANADO</th></tr></thead>
      <tbody>
        <tr><td style="${cellStyle}">$250,000 HASTA $500,000.00</td><td style="${cellStyle}">$300.00</td></tr>
        <tr><td style="${cellStyle}">$500,000.01 HASTA $750,000.00</td><td style="${cellStyle}">$700.00</td></tr>
        <tr><td style="${cellStyle}">$750,000.01 HASTA $1,000,000.00</td><td style="${cellStyle}">$1,100.00</td></tr>
        <tr><td style="${cellStyle}">MAYOR A $1,000,000.00</td><td style="${cellStyle}">$1,500.00</td></tr>
      </tbody>
    </table>
  `));

  // 7. BONO MENSUAL
  container.appendChild(crearCardEvaluacion("BONO MENSUAL POR LA CANTIDAD DE HASTA $1,000.00.", `
    <p>Adicional a los valores de incentivo generados, los asesores podr√°n ser acreedores al "BONO EXTRAORDINARIO MENSUAL‚Äù, el cual ser√° depositado en la primera catorcena del mes posterior al cierre de mes evaluado en el que hayan cumplido con lo siguiente:</p>
    <div style="padding-left: 5px; margin-bottom:15px;">
      <div style="display:flex; margin-bottom:5px;"><span style="min-width:30px; font-weight:bold;">a)</span><span>Cartera administrada a partir de $4,000,000.00.</span></div>
      <div style="display:flex; margin-bottom:5px;"><span style="min-width:30px; font-weight:bold;">b)</span><span>Porcentaje de 0 cuotas vencidas igual o mayor al 95%.</span></div>
      <div style="display:flex; margin-bottom:5px;"><span style="min-width:30px; font-weight:bold;">c)</span><span>Porcentaje de cartera vencida (4 cuotas acumuladas o m√°s) igual o menor al 2%.</span></div>
      <div style="display:flex; margin-bottom:5px;"><span style="min-width:30px; font-weight:bold;">d)</span><span>Crecimiento en la cartera administrada.</span></div>
    </div>
    <table style="${tableStyle}">
      <thead><tr style="${headerStyle}"><th style="border:1px solid #000; padding:8px;">Crecimiento</th><th style="border:1px solid #000; padding:8px;">Monto</th></tr></thead>
      <tbody>
        <tr><td style="${cellStyle}">$150,000,001 - $350,000,000</td><td style="${cellStyle}">$200.00</td></tr>
        <tr><td style="${cellStyle}">$350,000,000.01 - $600,000,000</td><td style="${cellStyle}">$650.00</td></tr>
        <tr><td style="${cellStyle}">Mayor a $600,000,001</td><td style="${cellStyle}">$1,000,000.00</td></tr>
      </tbody>
    </table>
  `));

  // 8. CARTERA INTERMEDIA
  container.appendChild(crearCardEvaluacion("INCENTIVO PARA ASESORES CON CARTERA ADMINISTRADA ENTRE $300,001.00 y $1,300,000.00.", `
    <p>Los asesores que administren una cartera de cr√©dito entre estos valores, se les otorgar√° un incentivo con base al crecimiento generado de acuerdo con la siguiente tabla y cumplimiento de los incisos correspondientes:</p>
    <table style="${tableStyle}">
      <thead><tr style="${headerStyle}"><th style="border:1px solid #000; padding:8px;">MONTO DE CRECIMIENTO DE CARTERA AL CIERRE DE MES EN COMPARACI√ìN CON EL CIERRE DEL EJERCICIO ANTERIOR</th><th style="border:1px solid #000; padding:8px;">MONTO GANADO</th></tr></thead>
      <tbody>
        <tr><td style="${cellStyle}">$250,000 HASTA $500,000.00</td><td style="${cellStyle}">$300.00</td></tr>
        <tr><td style="${cellStyle}">$500,000.01 HASTA $750,000.00</td><td style="${cellStyle}">$700.00</td></tr>
        <tr><td style="${cellStyle}">$750,000.01 HASTA $1,000,000.00</td><td style="${cellStyle}">$1,100.00</td></tr>
        <tr><td style="${cellStyle}">MAYOR A $1,000,001.00</td><td style="${cellStyle}">$1,500.00</td></tr>
      </tbody>
    </table>
  `));

  return { type: "html", content: container };
}
if (keywords.igualacion.some(kw => lower.includes(kw))) {
  const container = document.createElement("div");

  // --- CONTENEDOR TIPO CARD (ESTILO INSTITUCIONAL) ---
  const cardContainer = document.createElement("div");
  cardContainer.style.cssText = `
    background-color: #fdf5e8;
    border-left: 6px solid #6495ED;
    border-top: 1px solid #e0e0e0;
    border-right: 1px solid #e0e0e0;
    border-bottom: 1px solid #e0e0e0;
    border-radius: 8px;
    padding: 25px;
    margin: 15px 0;
    font-family: Arial, sans-serif;
  `;

  // --- CONSTRUCCI√ìN DEL CONTENIDO ---
  cardContainer.innerHTML = `
    <h2 style="color: #1f3c73; font-size: 19px; margin-top: 0; margin-bottom: 15px; font-weight: bold; text-transform: uppercase;">
      IGUALACI√ìN DE MONTOS
    </h2>
    
    <p style="font-size: 15px; color: #1f3c73; font-weight: bold; margin-bottom: 20px;">
      Cuando un socio solicite un monto mayor al correspondiente de acuerdo con la tabla de ciclos:
    </p>

    <div style="padding-left: 5px; margin-bottom: 20px;">
      <p style="font-weight: bold; color: #6495ED; margin-bottom: 15px;">POL√çTICAS:</p>
      
      <div style="display: flex; margin-bottom: 12px; align-items: flex-start;">
        <span style="min-width: 30px; font-weight: bold; color: #000000;">a)</span>
        <span style="font-weight: normal; color: #333;">El monto m√°ximo a solicitar debe aparecer en la columna CR√âDITO M√ÅXIMO del Bur√≥ de Cr√©dito o en la evidencia de cr√©dito grupal.</span>
      </div>

      <div style="display: flex; margin-bottom: 12px; align-items: flex-start;">
        <span style="min-width: 30px; font-weight: bold; color: #000000;">b)</span>
        <span style="font-weight: normal; color:#333;">La cuenta de referencia debe ser de un cr√©dito grupal, y el ciclo mas reciente se encuentre pagado o estar en sus √∫ltimos 4 pagos seg√∫n su plan de pagos.</span>
      </div>

      <div style="display: flex; margin-bottom: 12px; align-items: flex-start;">
        <span style="min-width: 30px; font-weight: bold; color: #000000;">c)</span>
        <span style="font-weight: normal; color: #333;">La cuenta de referencia debe estar calificada con MOP 01, o justificar que se encuentra al corriente.</span>
      </div>

      <div style="display: flex; margin-bottom: 12px; align-items: flex-start;">
        <span style="min-width: 30px; font-weight: bold; color: #000000;">d)</span>
        <span style="font-weight: normal; color: #333;">El ciclo m√°s reciente no debe rebasar m√°s de un a√±o desde la fecha del √∫ltimo pago hasta la fecha de consulta.</span>
      </div>
    </div>

    <div style="padding: 15px; background: #fff3cd; border: 1px solid #ffeeba; border-radius: 6px; font-size: 14px;">
      <strong style="font-size: 15px; display: block; margin-bottom: 8px; color: #f28511;">NOTA:</strong>
      <ul style="margin: 0; padding-left: 20px; font-weight: normal; color: #333;">
        <li>No aplica para cr√©ditos con menos de 5 integrantes.</li>
        <li style="margin-top: 5px;">No aplica para socios con vivienda prestada o rentada.</li>
      </ul>
    </div>
  `;

  container.appendChild(cardContainer);
  return { type: 'html', content: container };
}

// ===============================
// FUNCIONES AUXILIARES
// ===============================

function createCard(title, contentHTML, color = "#f59e0b") {
  const card = document.createElement("div");
  card.style.padding = "14px";
  card.style.background = "#fff7ed";
  card.style.borderRadius = "8px";
  card.style.marginBottom = "12px";
  card.style.borderLeft = `4px solid ${color}`;

  card.innerHTML = `
    <div style="font-weight:bold; margin-bottom:8px; color:#92400e;">
      ${title}
    </div>
    <div style="font-size:14px; line-height:1.5;">
      ${contentHTML}
    </div>
  `;

  return card;
}

function createAdminTable() {
  const wrapper = document.createElement("div");

  wrapper.innerHTML = `
    <table style="width:100%; border-collapse:collapse; font-family:Arial; font-size:13px;  text-align: justify;">
      <thead>
        <tr style="background:#1f3c73; color:white;">
          <th colspan="6" style="border:1px solid #000; padding:6px;">
            ETAPA DE COBRANZA ADMINISTRATIVA<br>
            CR√âDITOS GRUPALES SEMANALES, CATORCENALES Y QUINCENALES
          </th>
        </tr>
	<tr style="background:#2f5aa8; color:white;">
          <th style="border:1px solid #000; padding:6px;">CUOTAS EN ATRASO</th>
          <th style="border:1px solid #000; padding:6px;">LLAMADAS, SMS, WHATSAPP</th>
          <th style="border:1px solid #000; padding:6px;">FORMATO CARTA INVITACI√ìN</th>
          <th style="border:1px solid #000; padding:6px;">FORMATO REQUERIMIENTO DE PAGO</th>
          <th style="border:1px solid #000; padding:6px;">FOTOGRAF√çAS GEO</th>
          <th style="border:1px solid #000; padding:6px;">NOTIFICACI√ìN</th>
        </tr>
      </thead>
      <tbody>
        <tr>
          <td style="border:1px solid #000; padding:6px;">CUOTA 1</td>
          <td style="border:1px solid #000;">2</td>
          <td style="border:1px solid #000;">1</td>
          <td style="border:1px solid #000;">1</td>
          <td style="border:1px solid #000;"></td>
          <td style="border:1px solid #000;"></td>
        </tr>
        <tr>
          <td style="border:1px solid #000; padding:6px;">CUOTA 2</td>
          <td style="border:1px solid #000;">2</td>
          <td style="border:1px solid #000;"></td>
          <td style="border:1px solid #000;">2</td>
          <td style="border:1px solid #000;">2</td>
          <td style="border:1px solid #000;"></td>
        </tr>
        <tr>
          <td style="border:1px solid #000; padding:6px;">CUOTA 3</td>
          <td style="border:1px solid #000;">2</td>
          <td style="border:1px solid #000;"></td>
          <td style="border:1px solid #000;">1</td>
          <td style="border:1px solid #000;">2</td>
          <td style="border:1px solid #000;">1</td>
        </tr>
      </tbody>
    </table>
  `;

  return wrapper;
}

// ===============================
// BLOQUE PRINCIPAL
// ===============================
   
if (keywords.recuperacion.some(kw => lower.includes(kw))) {
  const container = document.createElement("div");

  // --- ESTILOS DE TABLA Y CONTENEDORES ---
  const tableStyle = `width:100%; border-collapse:collapse; font-family:Arial; font-size:12px; margin-top:10px; border:1px solid #000; background-color: white;`;
  const headerStyle = `background:#1f3c73; color:white; border:1px solid #000; padding:8px; text-align:center; font-weight:bold;`;
  const cellStyle = `border:1px solid #000; padding:6px; text-align:center; font-weight:normal; color:#333;`;

  // --- FUNCI√ìN PARA CREAR BLOQUES DE DISE√ëO ---
  const crearBloqueRecuperacion = (titulo, contenidoHtml) => {
    const div = document.createElement("div");
    div.style.cssText = `
      background-color: #fdf5e8;
      border-left: 6px solid #6495ED;
      border-top: 1px solid #e0e0e0;
      border-right: 1px solid #e0e0e0;
      border-bottom: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 20px;
      font-family: Arial, sans-serif;
    `;
    
    let html = "";
    if (titulo) {
      html += `<p style="margin-bottom: 15px; font-weight: bold; color: #1f3c73; font-size: 16px; text-transform: uppercase;">${titulo}</p>`;
    }
    html += `<div style="font-size: 14px; color: #333; line-height: 1.6;">${contenidoHtml}</div>`;
    div.innerHTML = html;
    return div;
  };

  // T√çTULO PRINCIPAL (AZUL MARINO)
  const mainTitle = document.createElement("h2");
  mainTitle.style.cssText = "color: #1f3c73; font-size: 19px; font-weight: bold; text-transform: uppercase; margin-bottom: 20px;";
  mainTitle.textContent = "GESTI√ìN DE RECUPERACI√ìN(COBRANZA).";
  container.appendChild(mainTitle);

  // 1. OBJETIVO (TEXTO EN NEGRITA NEGRA)
  container.appendChild(crearBloqueRecuperacion("OBJETIVO.", `
    <p style="font-weight: bold; margin-bottom: 15px; color: #000;">Con la finalidad de generar empat√≠a y compromiso moral con los integrantes del grupo, el Asesor de Cr√©dito y Recuperaci√≥n Grupal cuidar√° en todo momento el buen desempe√±o de sus actividades, priorizando las siguientes:</p>
    <div style="padding-left: 5px;">
      <div style="display:flex; margin-bottom:8px;"><span style="min-width:30px; font-weight:bold; color:#000;">a)</span><span style="font-weight:normal; color:#000;">Reuniones informativas con los grupos.</span></div>
      <div style="display:flex; margin-bottom:8px;"><span style="min-width:30px; font-weight:bold; color:#000;">b)</span><span style="font-weight:normal; color:#000;">La integraci√≥n de los expedientes de manera √°gil.</span></div>
      <div style="display:flex; margin-bottom:8px;"><span style="min-width:30px; font-weight:bold; color:#000;">c)</span><span style="font-weight:normal; color:#000;">Disminuir los tiempos de entrega del recurso.</span></div>
      <div style="display:flex; margin-bottom:8px;"><span style="min-width:30px; font-weight:bold; color:#000;">d)</span><span style="font-weight:normal; color:#000;">Responsabilizar a los integrantes del grupo del compromiso solidario.</span></div>
      <div style="display:flex; margin-bottom:8px;"><span style="min-width:30px; font-weight:bold; color:#000;">e)</span><span style="font-weight:normal; color:#000;">Incentivar el ahorro.</span></div>
      <div style="display:flex; margin-bottom:8px;"><span style="min-width:30px; font-weight:bold; color:#000;">f)</span><span style="font-weight:normal; color:#000;">Obligar el pago puntual, generando la cultura de pago.</span></div>
    </div>
  `));

  // 2. ETAPA PREVENTIVA
  container.appendChild(crearBloqueRecuperacion("üîπ Recuperaci√≥n Etapa Preventiva.", `
    <p style="font-weight: normal; color:#000;">El Asesor de Cr√©dito y Recuperaci√≥n Grupal deber√° realizar llamadas telef√≥nicas, env√≠o de mensajes de texto SMS o WhatsApp a todos los integrantes del grupo, mencionando la fecha pr√≥xima de pago, debiendo realizar esta actividad cuando el cr√©dito se encuentre en 0 d√≠as y con al menos dos d√≠as de anticipaci√≥n a su fecha de pago.</p>
  `));

  // 3. ETAPA ADMINISTRATIVA
  const tablaAdmin = `
    <p style="font-weight: normal; margin-bottom:10px; color:#000;">En todas y cada una de las etapas gestionadas por el Asesor de Cr√©dito y Recuperaci√≥n Grupal, est√° obligado a digitalizar las evidencias de las gestiones realizadas en el sistema inform√°tico y de manera f√≠sica al expediente de cr√©dito grupal cuando aplique, siendo requerido al menos lo siguiente:</p>
    <table style="${tableStyle}">
      <thead>
        <tr style="${headerStyle}"><th colspan="6">ETAPA DE COBRANZA ADMINISTRATIVA<br>CR√âDITOS GRUPALES SEMANALES, CATORCENALES Y QUINCENALES</th></tr>
        <tr style="background:#2f5aa8; color:white;">
          <th style="border:1px solid #000; padding:6px;">CUOTAS EN ATRASO</th>
          <th style="border:1px solid #000; padding:6px;">LLAMADAS, SMS, WHATSAPP</th>
          <th style="border:1px solid #000; padding:6px;">FORMATO CARTA INVITACI√ìN</th>
          <th style="border:1px solid #000; padding:6px;">FORMATO REQUERIMIENTO DE PAGO</th>
          <th style="border:1px solid #000; padding:6px;">FOTOGRAF√çAS GEO</th>
          <th style="border:1px solid #000; padding:6px;">NOTIFICACI√ìN</th>
        </tr>
      </thead>
      <tbody>
        <tr><td style="${cellStyle}">CUOTA 1</td><td style="${cellStyle}">2</td><td style="${cellStyle}">1</td><td style="${cellStyle}">1</td><td style="${cellStyle}"></td><td style="${cellStyle}"></td></tr>
        <tr><td style="${cellStyle}">CUOTA 2</td><td style="${cellStyle}">2</td><td style="${cellStyle}"></td><td style="${cellStyle}">2</td><td style="${cellStyle}">2</td><td style="${cellStyle}"></td></tr>
        <tr><td style="${cellStyle}">CUOTA 3</td><td style="${cellStyle}">2</td><td style="${cellStyle}"></td><td style="${cellStyle}">1</td><td style="${cellStyle}">2</td><td style="${cellStyle}">1</td></tr>
      </tbody>
    </table>
  `;
  container.appendChild(crearBloqueRecuperacion("üîπ Recuperaci√≥n en Etapa Administrativa.", tablaAdmin));

  // 4. RECUPERACI√ìN EXTRAJUDICIAL (CON MARK)
  container.appendChild(crearBloqueRecuperacion("<mark>üîπ Recuperaci√≥n Extrajudicial.</mark>", `
    <p style="font-weight: bold; color: #1f3c73; margin-bottom: 10px;">Comprende de la quinta cuota hasta que el cr√©dito cuente con 89 d√≠as de mora.</p>
    <div style="padding-left: 5px;">
      <div style="display:flex; margin-bottom:10px;"><span style="min-width:30px; font-weight:bold; color:#000;">a)</span><span style="font-weight:normal; color:#000;">En esta etapa el Gerente de Sucursal, Asesor de Cr√©dito y/o Gestor de Recuperaci√≥n, intensificar√°n las gestiones de cobranza a los socios, realiz√°ndolas de manera permanente evitando el pase a cartera vencida del cr√©dito.</span></div>
      <div style="display:flex; margin-bottom:10px;"><span style="min-width:30px; font-weight:bold; color:#000;">b)</span><span style="font-weight:normal; color:#000;">De no tener resultado en la acci√≥n anterior, el Gestor de Recuperaci√≥n seguir√° realizando la recuperaci√≥n de los cr√©ditos de manera individual, exigiendo la liquidaci√≥n total del cr√©dito o, en su caso, realizar un convenio de pago que no exceda un plazo m√°ximo de 3 d√≠as h√°biles, caso contrario solicitar√° la autorizaci√≥n a la Coordinaci√≥n de Recuperaci√≥n Extrajudicial.</span></div>
      <div style="display:flex; margin-bottom:10px;"><span style="min-width:30px; font-weight:bold; color:#000;">c)</span><span style="font-weight:normal; color:#000;">El Asesor de Cr√©dito y Recuperaci√≥n Grupal, Gestor de Recuperaci√≥n y/o Gerente de Sucursal en todo momento evitar√°n, por los medios necesarios y a su alcance, que el o los cr√©ditos asignados pasen a cartera vencida.</span></div>
      <div style="display:flex; margin-bottom:10px;"><span style="min-width:30px; font-weight:bold; color:#000;">d)</span><span style="font-weight:normal; color:#000;">Durante esta etapa se podr√°n utilizar las garant√≠as l√≠quidas para cubrir la primera cuota vencida del cr√©dito, previa autorizaci√≥n de la Gerencia de Recuperaci√≥n.</span></div>
      <div style="display:flex; margin-bottom:10px;"><span style="min-width:30px; font-weight:bold; color:#000;">e)</span><span style="font-weight:normal; color:#000;">En esta etapa se podr√°n aceptar bienes en daci√≥n en pago respetando en todo momento lo establecido en el presente manual, para liquidaci√≥n o abono parcial del cr√©dito grupal o disposici√≥n.</span></div>
      <div style="display:flex; margin-bottom:10px;"><span style="min-width:30px; font-weight:bold; color:#000;">f)</span><span style="font-weight:normal; color:#000;">En esta etapa se podr√°n utilizar los documentos ‚ÄúRequerimiento de pago extrajudicial‚Äù o ‚ÄúRequerimiento de pago extrajudicial grupal individual‚Äù.</span></div>
    </div>
  `));

  // 5. VENCIMIENTO DEL CR√âDITO (CON MARK)
  container.appendChild(crearBloqueRecuperacion("<mark>üîπ Vencimiento del cr√©dito.</mark>", `
    <p style="font-weight: bold; color: #1f3c73; margin-bottom: 10px;">Comprende de 90 a 150 d√≠as de mora.</p>
    <div style="padding-left: 5px;">
      <div style="display:flex; margin-bottom:10px;"><span style="min-width:30px; font-weight:bold; color:#000;">a)</span><span style="font-weight:normal; color:#000;">cuando el Gestor de Recuperaci√≥n identifique en esta etapa, grupos que tengan la voluntad de liquidar sus adeudos pendientes y estos no sean atribuibles a la negativa de pago, propondr√°n la renovaci√≥n del cr√©dito al Gerente de la sucursal, cumpliendo con las pol√≠ticas establecidas en el Manual de Cr√©dito aplicando el pago sostenido del cr√©dito.</span></div>
      <div style="display:flex; margin-bottom:10px;"><span style="min-width:30px; font-weight:bold; color:#000;">b)</span><span style="font-weight:normal; color:#000;">Podr√° realizar un convenio de pago que no exceda un plazo m√°ximo de tres d√≠as h√°biles, analizando el saldo total del cr√©dito, en caso de convenir a un mayor plazo solicitar√° la autorizaci√≥n a la Coordinaci√≥n de Recuperaci√≥n Extrajudicial.</span></div>
      <div style="display:flex; margin-bottom:10px;"><span style="min-width:30px; font-weight:bold; color:#000;">c)</span><span style="font-weight:normal; color:#000;">En esta etapa se podr√°n utilizar el documento ‚ÄúRequerimiento previo a juicio grupal".</span></div>
      <div style="display:flex; margin-bottom:10px;"><span style="min-width:30px; font-weight:bold; color:#000;">d)</span><span style="font-weight:normal; color:#000;">En esta etapa se podr√°n aceptar bienes en daci√≥n en pago respetando en todo momento lo establecido en el presente manual, para liquidaci√≥n o abono parcial del cr√©dito grupal o disposici√≥n.</span></div>
      <div style="display:flex; margin-bottom:10px;"><span style="min-width:30px; font-weight:bold; color:#000;">e)</span><span style="font-weight:normal; color:#000;">Cuando se hayan agotado todas las gestiones de cobranza el Gestor de Recuperaci√≥n, Gerente de Sucursal o Coordinador de Recuperaci√≥n Extrajudicial, con base al an√°lisis de la situaci√≥n actual del acreditado, podr√° proponer alguna estrategia para la liquidaci√≥n, cancelaci√≥n o renuncia del cobro del cr√©dito grupal o disposici√≥n, apeg√°ndose en todo momento a los lineamientos establecidos en el presente manual.</span></div>
      <div style="display:flex; margin-bottom:10px;"><span style="min-width:30px; font-weight:bold; color:#000;">f)</span><span style="font-weight:normal; color:#000;">Una vez cumplidos los 150 d√≠as de morosidad y la cuenta no tenga movimientos de dep√≥sitos y/o pagos, el Gestor de Recuperaci√≥n (cuando aplique) podr√° dictaminar la incobrabilidad de recuperaci√≥n del cr√©dito, por la falta de solvencia econ√≥mica, localizaci√≥n de los socios, deudores solidarios, etc., siempre y cuando cumpla con todas las evidencias de cobranza digitalizadas en el sistema inform√°tico, el Coordinador de Recuperaci√≥n Extrajudicial solicitar√° al Gestor de Recuperaci√≥n, Gerente de Sucursal, Subgerente de Sucursal o Ejecutivo de Servicios el dictamen de cada integrante del grupo.</span></div>
      <div style="display:flex; margin-bottom:10px;"><span style="min-width:30px; font-weight:bold; color:#000;">g)</span><div style="font-weight:normal; color:#000;">Para turnar a Recuperaci√≥n Judicial considerar:
        <ul style="margin: 5px 0 0 0; padding-left: 20px; color: #000;">
          <li>1. Saldo capital del cr√©dito grupal (igual o mayor a $25,000.00).</li>
          <li>2. Localizaci√≥n del socio y/o deudores solidarios.</li>
          <li>3. Solvencia econ√≥mica de socio y/o deudores solidarios.</li>
          <li>4. Tipo de garant√≠as que respaldan el cr√©dito.</li>
          <li>5. Existencia de bienes susceptibles de embargo.</li>
        </ul>
      </div></div>
      <div style="display:flex; margin-top:10px;"><span style="min-width:30px; font-weight:bold; color:#000;">h)</span><span style="font-weight:normal; color:#000;">El dictamen deber√° digitalizarse e integrarse al expediente f√≠sico.</span></div>
    </div>
  `));

  return { type: "html", content: container };
}

if (keywords.renovacion.some(kw => lower.includes(kw))) {
  const container = document.createElement("div");

  // --- FUNCI√ìN PARA CREAR BLOQUES DE DISE√ëO ---
  const crearBloqueRenovacion = (titulo, contenidoHtml) => {
    const div = document.createElement("div");
    div.style.cssText = `
      background-color: #fdf5e8;
      border-left: 6px solid #6495ED;
      border-top: 1px solid #e0e0e0;
      border-right: 1px solid #e0e0e0;
      border-bottom: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 20px;
      font-family: Arial, sans-serif;
    `;
    
    let html = "";
    if (titulo) {
      html += `<p style="margin-bottom: 15px; font-weight: bold; color: #1f3c73; font-size: 16px; text-transform: uppercase;">${titulo}</p>`;
    }
    html += `<div style="font-size: 14px; color: #000; line-height: 1.6;">${contenidoHtml}</div>`;
    div.innerHTML = html;
    return div;
  };

  // T√çTULO PRINCIPAL (AZUL MARINO)
  const mainTitle = document.createElement("h2");
  mainTitle.style.cssText = "color: #1f3c73; font-size: 19px; font-weight: bold; text-transform: uppercase; margin-bottom: 20px;";
  mainTitle.textContent = "RENOVACI√ìN DE CR√âDITOS EN MODALIDAD GRUPAL";
  container.appendChild(mainTitle);

  // CONTENIDO EN P√ÅRRAFOS (SIN TABLA)
  const contenidoPoliticas = `
    <p style="margin-bottom: 12px;"><strong>1.</strong> Los grupos en primer ciclo no pueden renovarse, excepto en los siguientes casos: grupos nuevos por separaci√≥n de integrantes o asignaci√≥n de ciclos para igualar montos (validar con Coordinaci√≥n).</p>
    <p style="margin-bottom: 12px;"><strong>2.</strong> A partir del segundo ciclo se permite la renovaci√≥n cuando el grupo lleve pagado el 80% de las cuotas del plan de pagos.</p>
    <p style="margin-bottom: 0;"><strong>3.</strong> NO aplica renovaci√≥n si el cr√©dito adicional de alg√∫n integrante est√° en atraso.</p>
  `;
  
  container.appendChild(crearBloqueRenovacion("Pol√≠ticas", contenidoPoliticas));

  // NOTA IMPORTANTE
  const note = document.createElement("div");
  note.style.cssText = `
    margin-top: 12px;
    padding: 15px;
    background: #fff3cd;
    border-radius: 6px;
    font-size: 14px;
    color: #000;
    border: 1px solid #ffeeba;
  `;
  note.innerHTML = `<strong>Importante:</strong> Validar casos especiales con la <mark>COORDINACI√ìN DE CR√âDITOS SOLIDARIOS</mark> por correo electr√≥nico.`;
  container.appendChild(note);

  return { type: 'html', content: container };
}

      if (keywords.saldos.some(kw => lower.includes(kw))) {
  const container = document.createElement("div");

  // --- FUNCI√ìN PARA CREAR BLOQUES DE DISE√ëO ---
  const crearBloqueSaldos = (titulo, contenidoHtml) => {
    const div = document.createElement("div");
    div.style.cssText = `
      background-color: #fdf5e8;
      border-left: 6px solid #6495ED;
      border-top: 1px solid #e0e0e0;
      border-right: 1px solid #e0e0e0;
      border-bottom: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 20px;
      font-family: Arial, sans-serif;
    `;
    
    let html = "";
    if (titulo) {
      html += `<p style="margin-bottom: 15px; font-weight: bold; color: #1f3c73; font-size: 16px; text-transform: uppercase;">${titulo}</p>`;
    }
    html += `<div style="font-size: 14px; color: #000; line-height: 1.6;">${contenidoHtml}</div>`;
    div.innerHTML = html;
    return div;
  };

  // T√çTULO PRINCIPAL (AZUL MARINO)
  const mainTitle = document.createElement("h2");
  mainTitle.style.cssText = "color: #1f3c73; font-size: 19px; font-weight: bold; text-transform: uppercase; margin-bottom: 20px;";
  mainTitle.textContent = "SALDOS INSOLUTOS ‚Äì RENOVACI√ìN DE CR√âDITO GRUPAL";
  container.appendChild(mainTitle);

 // CONTENIDO DEL CUERPO ORGANIZADO EN PUNTOS
  const contenidoSaldos = `
    <ul style="margin: 0; padding-left: 20px; color: #000; list-style-type: disc;">
      <li style="margin-bottom: 12px;">
        Cuando el cr√©dito grupal se encuentre en <strong>atraso o con estatus vencido</strong> y los socios tengan 
        intenci√≥n de pago, podr√°n solicitar la <strong>renovaci√≥n del cr√©dito</strong> con un m√≠nimo de <strong>tres integrantes</strong>.
      </li>
      <li style="margin-bottom: 12px;">
        Esta renovaci√≥n cubrir√° los <strong>saldos de capital pendientes</strong> del grupo y se podr√°n incluir los saldos 
        de capital del cr√©dito adicional grupal que tengan los integrantes.
      </li>
      <li style="margin-bottom: 0;">
        El cr√©dito ser√° <strong>sesionado por el Comit√© de Cr√©dito</strong> y se apegar√° a lo establecido en las 
        pol√≠ticas generales de clasificaci√≥n de cartera, tramit√°ndose con el <strong>mismo producto crediticio</strong>.
      </li>
    </ul>
  `;
  
  container.appendChild(crearBloqueSaldos(null, contenidoSaldos));

 // NOTA INFORMATIVA (FONDO #fff3cd, PALABRA "Nota" EN NARANJA #f28511)
  const note = document.createElement("div");
  note.style.cssText = `
    margin-top: 12px;
    padding: 15px;
    background: #fff3cd;
    border-radius: 6px;
    font-size: 14px;
    color: #000;
    border: 1px solid #d6d8db;
  `;
  note.innerHTML = `<strong> <span style="color: #f28511;">Nota:</span></strong> Esta acci√≥n se considera una <em>renovaci√≥n de saldos insolutos</em>, ya que los montos pendientes se trasladan al nuevo cr√©dito sin perder el seguimiento del capital original.`;
  container.appendChild(note);

  return { type: 'html', content: container };
}

   
if (keywords.expedientes.some(kw => lower.includes(kw))) {
  const container = document.createElement("div");

  // --- FUNCI√ìN PARA CREAR BLOQUES DE DISE√ëO ---
  const crearBloqueExpedientes = (titulo, contenidoHtml) => {
    const div = document.createElement("div");
    div.style.cssText = `
      background-color: #fdf5e8;
      border-left: 6px solid #6495ED;
      border-top: 1px solid #e0e0e0;
      border-right: 1px solid #e0e0e0;
      border-bottom: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 20px;
      font-family: Arial, sans-serif;
    `;
    
    let html = "";
    if (titulo) {
      html += `<p style="margin-bottom: 15px; font-weight: bold; color: #1f3c73; font-size: 16px; text-transform: uppercase;">${titulo}</p>`;
    }
    html += `<div style="font-size: 14px; color: #000; line-height: 1.6;">${contenidoHtml}</div>`;
    div.innerHTML = html;
    return div;
  };

  // T√çTULO PRINCIPAL (AZUL MARINO)
  const mainTitle = document.createElement("h2");
  mainTitle.style.cssText = "color: #1f3c73; font-size: 19px; font-weight: bold; text-transform: uppercase; margin-bottom: 20px;";
  mainTitle.textContent = "CREACI√ìN DE EXPEDIENTES";
  container.appendChild(mainTitle);

  // INTRODUCCI√ìN Y LISTA EN PUNTOS
  const contenidoExpedientes = `
    <p style="margin-bottom: 15px; color: #000;">Para crear un nuevo expediente grupal, se deben seguir los siguientes pasos y cumplir con los requisitos:</p>
    <ul style="margin: 0; padding-left: 20px; color: #000; list-style-type: disc;">
      <li style="margin-bottom: 10px;">Se integrar√° un expediente a nombre del grupo y otro por cada integrante individual.</li>
      <li style="margin-bottom: 10px;">La fotograf√≠a grupal deber√° estar digitalizada antes del desembolso y debe actualizarse cuando se agreguen o eliminen integrantes.</li>
      <li style="margin-bottom: 10px;">Cada integrante del grupo deber√° ahorrar durante la vida del cr√©dito; este monto ser√° acordado con el Asesor de Cr√©dito y Recuperaci√≥n o el personal operativo asignado a la sucursal.</li>
      <li style="margin-bottom: 10px;">Reunir toda la documentaci√≥n requerida del socio o grupo.</li>
      <li style="margin-bottom: 10px;">Registrar los datos del socio o grupo en el sistema de la cooperativa.</li>
      <li style="margin-bottom: 10px;">Adjuntar comprobantes de domicilio, ingresos y cualquier otra evidencia necesaria.</li>
      <li style="margin-bottom: 10px;">Verificar que la informaci√≥n est√© completa y correcta antes de guardar el expediente.</li>
      <li style="margin-bottom: 0;">Enviar el expediente para revisi√≥n y aprobaci√≥n por el √°rea correspondiente.</li>
    </ul>
  `;

  container.appendChild(crearBloqueExpedientes(null, contenidoExpedientes));

  return { type: "html", content: container };
}
      
if (keywords.incremento.some(kw => lower.includes(kw))) {
  const container = document.createElement("div");

  // --- FUNCI√ìN PARA CREAR BLOQUES DE DISE√ëO ---
  const crearBloqueIncremento = (titulo, contenidoHtml) => {
    const div = document.createElement("div");
    div.style.cssText = `
      background-color: #fdf5e8;
      border-left: 6px solid #6495ED;
      border-top: 1px solid #e0e0e0;
      border-right: 1px solid #e0e0e0;
      border-bottom: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 20px;
      font-family: Arial, sans-serif;
    `;
    
    let html = "";
    if (titulo) {
      html += `<p style="margin-bottom: 15px; font-weight: bold; color: #1f3c73; font-size: 16px; text-transform: uppercase;">${titulo}</p>`;
    }
    html += `<div style="font-size: 14px; color: #000; line-height: 1.6;">${contenidoHtml}</div>`;
    div.innerHTML = html;
    return div;
  };

  // T√çTULO PRINCIPAL (AZUL MARINO)
  const mainTitle = document.createElement("h2");
  mainTitle.style.cssText = "color: #1f3c73; font-size: 19px; font-weight: bold; text-transform: uppercase; margin-bottom: 20px;";
  mainTitle.textContent = "INCREMENTO DE CR√âDITO PARA SOCIOS ANTIGUOS";
  container.appendChild(mainTitle);

  // CONTENIDO EN PUNTOS
  const contenidoIncremento = `
    <ul style="margin: 0; padding-left: 20px; color: #000; list-style-type: disc;">
      <li style="margin-bottom: 15px;">
        <strong>Socios antiguos con buen historial de pagos:</strong> Aquellos que hayan reducido sus montos de cr√©dito, cambiado de grupo o estado inactivo por menos de dos a√±os, podr√°n acceder a un incremento en su siguiente cr√©dito tomando como base el monto m√°s alto recibido y su nueva capacidad de pago, de acuerdo con la tabla de incrementos.
      </li>
      <li style="margin-bottom: 0;">
        <strong>Socios con historial positivo pero inactivos m√°s de dos a√±os:</strong> Se realizar√° el tr√°mite de cr√©dito considerando su historial y capacidad de pago, siguiendo estrictamente el Proceso de Cr√©dito (PDC).
      </li>
    </ul>
  `;

  container.appendChild(crearBloqueIncremento(null, contenidoIncremento));

  return { type: 'html', content: container };
}

if (keywords.domicilio.some(kw => lower.includes(kw))) {
  const container = document.createElement("div");

  // --- ESTILOS DE TABLA ---
  const tableStyle = `width:100%; border-collapse:collapse; font-family:Arial; font-size:13px; margin-top:10px; border:1px solid #000; background-color: white;`;
  const headerStyle = `background:#1f3c73; color:white; border:1px solid #000; padding:10px; text-align:center; font-weight:bold;`;
  const cellStyle = `border:1px solid #000; padding:8px; text-align:center; color:#000;`;

  // --- FUNCI√ìN PARA CREAR BLOQUES DE DISE√ëO ---
  const crearBloqueVivienda = (titulo, contenidoHtml) => {
    const div = document.createElement("div");
    div.style.cssText = `
      background-color: #fdf5e8;
      border-left: 6px solid #6495ED;
      border-top: 1px solid #e0e0e0;
      border-right: 1px solid #e0e0e0;
      border-bottom: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 20px;
      font-family: Arial, sans-serif;
    `;
    
    let html = "";
    if (titulo) {
      html += `<p style="margin-bottom: 15px; font-weight: bold; color: #1f3c73; font-size: 16px; text-transform: uppercase;">${titulo}</p>`;
    }
    html += `<div style="font-size: 14px; color: #000; line-height: 1.6;">${contenidoHtml}</div>`;
    div.innerHTML = html;
    return div;
  };

  // T√çTULO PRINCIPAL (AZUL MARINO)
  const mainTitle = document.createElement("h2");
  mainTitle.style.cssText = "color: #1f3c73; font-size: 19px; font-weight: bold; text-transform: uppercase; margin-bottom: 20px;";
  mainTitle.textContent = "POLITICAS DE TIPO DE VIVIENDA";
  container.appendChild(mainTitle);

  // 1. CLASIFICACI√ìN DE VIVIENDAS
  const contenidoClasificacion = `
    <p style="font-weight: bold; margin-bottom: 10px;">üìã C√≥mo clasificamos las viviendas:</p>
    <ul style="margin: 0; padding-left: 20px; color: #000; list-style-type: disc;">
      <li style="margin-bottom: 8px;"><strong>Parentescos v√°lidos para vivienda familiar:</strong> Hermanos, padres, hijos, abuelos, nietos, suegros, cu√±ados.</li>
      <li style="margin-bottom: 0;"><strong>Parentescos v√°lidos para vivienda propia:</strong> A nombre del socio, c√≥nyuge o concubino(a).</li>
    </ul>
  `;
  container.appendChild(crearBloqueVivienda(null, contenidoClasificacion));

  // NOTA 1: ACTUALIZACI√ìN PROPIA/FAMILIAR
  const note1 = document.createElement("div");
  note1.style.cssText = "margin-bottom:20px;padding:15px;background:#fff3cd;border-radius:6px;font-size:14px;color:#000;border:1px solid #ffeeba;";
  note1.innerHTML = `<strong> <span style="color: #f28511;">Nota:</span> ¬øCu√°ndo se actualizan?</strong><br>Socios con domicilio propio o familiar actualizar√°n su comprobante cada a√±o o cuando cambien de domicilio.`;
  container.appendChild(note1);

  // 2. VIVIENDA RENTADA O PRESTADA (TABLA)
  const contenidoTabla = `
    <p style="font-weight: bold; margin-bottom: 10px;">Personas con vivienda rentada o prestada:</p>
    <p style="margin-bottom: 15px;">Tabla de integrantes con propiedad rentada o prestada por cada grupo:</p>
    <table style="${tableStyle}">
      <thead>
        <tr style="${headerStyle}">
          <th>Total Integrantes</th>
          <th>Integrantes con vivienda rentada/prestada</th>
          <th>Integrantes con vivienda propia/familiar</th>
        </tr>
      </thead>
      <tbody>
        <tr><td style="${cellStyle}">5</td><td style="${cellStyle}">2</td><td style="${cellStyle}">3</td></tr>
        <tr><td style="${cellStyle}">10</td><td style="${cellStyle}">4</td><td style="${cellStyle}">6</td></tr>
        <tr><td style="${cellStyle}">15</td><td style="${cellStyle}">6</td><td style="${cellStyle}">9</td></tr>
        <tr><td style="${cellStyle}">20</td><td style="${cellStyle}">8</td><td style="${cellStyle}">12</td></tr>
      </tbody>
    </table>
  `;
  container.appendChild(crearBloqueVivienda(null, contenidoTabla));

  // NOTA 2: ACTUALIZACI√ìN RENTADA
  const note2 = document.createElement("div");
  note2.style.cssText = "margin-bottom:20px;padding:15px;background:#fff3cd;border-radius:6px;font-size:14px;color:#000;border:1px solid #ffeeba;";
  note2.innerHTML = `<strong> <span style="color: #f28511;">Nota:</span> ¬øCu√°ndo se actualizan?</strong><br>Socios que rentan o habitan vivienda prestada actualizar√°n su comprobante cada tr√°mite.`;
  container.appendChild(note2);

  // 3. POL√çTICAS DE INCORPORACI√ìN
  const contenidoPol√≠ticas = `
    <p style="font-weight: bold; font-size: 16px; margin-bottom: 15px;">Pol√≠ticas para la incorporaci√≥n de integrantes que viven en vivienda prestada o rentada</p>
    <ol style="margin: 0; padding-left: 20px; color: #000; line-height: 1.8;">
      <li style="margin-bottom: 10px;"><strong>Renovaciones sin atrasos:</strong> En renovaciones de grupos que no hayan presentado atrasos de m√°s de una cuota, se podr√°n agregar m√°s integrantes que viven en vivienda prestada o rentada, siempre y cuando <mark>su n√∫mero sea igual o inferior al 50 % del total de integrantes.</mark></li>
      <li style="margin-bottom: 10px;"><strong>Monto m√°ximo:</strong><br>El monto m√°ximo a otorgar ser√° la cantidad de <mark>$70,000.00</mark> por integrante nuevo que renta.</li>
      <li style="margin-bottom: 0;"><strong>Socios con historial:</strong><br>Para socios que hayan trabajado en la cooperativa un monto mayor a $70,000.00 se le podr√° respetar el monto en la renovaci√≥n o cr√©ditos posteriores.</li>
    </ol>
  `;
  container.appendChild(crearBloqueVivienda(null, contenidoPol√≠ticas));

  // NOTA FINAL: IMPORTANTE
  const finalNote = document.createElement("div");
  finalNote.style.cssText = "margin-top:15px;padding:15px;background:#fff3cd;border-radius:6px;font-size:14px;color:#000;border:1px solid #ffeeba;";
  finalNote.innerHTML = `<strong><span style="color: #f28511;">Importante:</span></strong> Esta pol√≠tica busca mitigar el riesgo manteniendo equilibrio entre integrantes con vivienda propia/familiar y quienes rentan.`;
  container.appendChild(finalNote);

  return { type: "html", content: container };
}
     
if (keywords.comprobante.some(kw => lower.includes(kw))) {
  const container = document.createElement("div");

  // --- FUNCI√ìN PARA CREAR BLOQUES DE DISE√ëO ---
  const crearBloqueComprobante = (titulo, contenidoHtml) => {
    const div = document.createElement("div");
    div.style.cssText = `
      background-color: #fdf5e8;
      border-left: 6px solid #6495ED;
      border-top: 1px solid #e0e0e0;
      border-right: 1px solid #e0e0e0;
      border-bottom: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 20px;
      font-family: Arial, sans-serif;
    `;
    
    let html = "";
    if (titulo) {
      html += `<p style="margin-bottom: 15px; font-weight: bold; color: #1f3c73; font-size: 16px; text-transform: uppercase;">${titulo}</p>`;
    }
    html += `<div style="font-size: 14px; color: #000; line-height: 1.6;">${contenidoHtml}</div>`;
    div.innerHTML = html;
    return div;
  };

  // T√çTULO PRINCIPAL (AZUL MARINO)
  const mainTitle = document.createElement("h2");
  mainTitle.style.cssText = "color: #1f3c73; font-size: 19px; font-weight: bold; text-transform: uppercase; margin-bottom: 20px;";
  mainTitle.textContent = "COMPROBANTE DE DOMICILIO";
  container.appendChild(mainTitle);

  // 1. REQUISITOS GENERALES (INCISOS EN NEGRO)
  const contenidoRequisitos = `
    <p style="font-weight: bold; margin-bottom: 10px;">1. Requisitos generales del comprobante de domicilio:</p>
    <div style="padding-left: 5px;">
      <div style="display:flex; margin-bottom:8px;"><span style="min-width:30px; font-weight:bold; color:#000;">a)</span><span style="color:#000;">El comprobante deber√° tener una antig√ºedad m√°xima de tres meses a partir de su fecha de emisi√≥n.</span></div>
      <div style="display:flex; margin-bottom:8px;"><span style="min-width:30px; font-weight:bold; color:#000;">b)</span><span style="color:#000;">La direcci√≥n deber√° coincidir con la registrada en el sistema.</span></div>
      <div style="display:flex; margin-bottom:8px;"><span style="min-width:30px; font-weight:bold; color:#000;">c)</span><span style="color:#000;">Si el comprobante no est√° a nombre del socio o aval, se deber√° especificar la relaci√≥n o parentesco con el titular.</span></div>
    </div>
  `;
  container.appendChild(crearBloqueComprobante(null, contenidoRequisitos));

  // 2. TIPOS DE COMPROBANTES (PUNTOS EN NEGRO)
  const contenidoTipos = `
    <p style="font-weight: bold; margin-bottom: 10px;">2. Tipos de comprobantes de domicilio aceptados:</p>
    <ul style="margin: 0; padding-left: 20px; color: #000; list-style-type: disc;">
      <li style="margin-bottom: 5px;">Recibo de suministro de energ√≠a el√©ctrica o comprobante CFEm√°tico.</li>
      <li style="margin-bottom: 5px;">Recibo o estado de cuenta del servicio de agua.</li>
      <li style="margin-bottom: 5px;">Recibo de gas natural.</li>
      <li style="margin-bottom: 5px;">Boleta predial del a√±o en curso.</li>
      <li style="margin-bottom: 5px;">Recibo de servicios de telecomunicaciones fija.</li>
      <li style="margin-bottom: 5px;">Estado de cuenta bancario (no n√≥mina).</li>
      <li style="margin-bottom: 0;">Constancia de Origen y Vecindad expedida por autoridad competente con visto bueno correspondiente.</li>
    </ul>
  `;
  container.appendChild(crearBloqueComprobante(null, contenidoTipos));

  // NOTA INFORMATIVA
  const note = document.createElement("div");
  note.style.cssText = `
    margin-top: 14px;
    padding: 15px;
    background: #fff3cd;
    border-radius: 6px;
    font-size: 14px;
    color: #000;
    border: 1px solid #ffeeba;
  `;
  note.innerHTML = `
    <strong> <span style="color: #f28511;">Nota:</span></strong> 
    Cuando la direcci√≥n registrada no coincida con el comprobante, se deber√° anotar la leyenda 
    <em>"Corrobor√© domicilio"</em> y detallar la direcci√≥n correcta en el margen del documento.
    <br><br>
    Si varios integrantes presentan el mismo comprobante pero habitan viviendas distintas, deber√°n
    anexar fotograf√≠as de la fachada y del acceso principal de cada vivienda. No se consideran
    viviendas distintas las construcciones en segundos niveles de la misma casa.
  `;
  container.appendChild(note);

  return { type: 'html', content: container };
}
   
if (keywords.recurso.some(kw => lower.includes(kw))) {
  const container = document.createElement("div");

  // --- FUNCI√ìN PARA CREAR BLOQUES DE DISE√ëO ---
  const crearBloqueRecurso = (titulo, contenidoHtml) => {
    const div = document.createElement("div");
    div.style.cssText = `
      background-color: #fdf5e8;
      border-left: 6px solid #6495ED;
      border-top: 1px solid #e0e0e0;
      border-right: 1px solid #e0e0e0;
      border-bottom: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 20px;
      font-family: Arial, sans-serif;
    `;
    
    let html = "";
    if (titulo) {
      html += `<p style="margin-bottom: 15px; font-weight: bold; color: #1f3c73; font-size: 16px; text-transform: uppercase;">${titulo}</p>`;
    }
    html += `<div style="font-size: 14px; color: #000; line-height: 1.6;">${contenidoHtml}</div>`;
    div.innerHTML = html;
    return div;
  };

  // T√çTULO PRINCIPAL (AZUL MARINO)
  const mainTitle = document.createElement("h2");
  mainTitle.style.cssText = "color: #1f3c73; font-size: 19px; font-weight: bold; text-transform: uppercase; margin-bottom: 20px;";
  mainTitle.textContent = "COMPROBACI√ìN CR√âDITO COMERCIAL";
  container.appendChild(mainTitle);

  // CONTENIDO EN LISTA (CON MARKS RESPETADOS)
  const contenidoRecurso = `
    <ul style="margin: 0; padding-left: 20px; color: #000; list-style-type: disc;">
      <li style="line-height: 1.8;">
        Todo cr√©dito con finalidad comercial de 
        <mark><strong>grupos nuevos (1er. 2do. y 3er ciclo) se deber√° verificar</strong></mark> 
        la comprobaci√≥n de la aplicaci√≥n del recurso (de manera f√≠sica o con autenticador digital) 
        <mark><strong>dentro de los 30 d√≠as</strong></mark> naturales posteriores al desembolso en cr√©ditos de 
        <mark><strong>montos mayores de $50,000.00 (cincuenta mil pesos 00/100 M. N.).</strong></mark>
      </li>
    </ul>
  `;

  container.appendChild(crearBloqueRecurso(null, contenidoRecurso));

  return { type: 'html', content: container };
}    

if (keywords.montos.some(kw => lower.includes(kw))) {
  const container = document.createElement("div");

  // --- FUNCI√ìN PARA CREAR BLOQUES DE DISE√ëO ---
  const crearBloqueMontos = (titulo, contenidoHtml) => {
    const div = document.createElement("div");
    div.style.cssText = `
      background-color: #fdf5e8;
      border-left: 6px solid #6495ED;
      border-top: 1px solid #e0e0e0;
      border-right: 1px solid #e0e0e0;
      border-bottom: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 20px;
      font-family: Arial, sans-serif;
    `;
    
    let html = "";
    if (titulo) {
      html += `<p style="margin-bottom: 15px; font-weight: bold; color: #1f3c73; font-size: 16px; text-transform: uppercase;">${titulo}</p>`;
    }
    html += `<div style="font-size: 14px; color: #000; line-height: 1.6;">${contenidoHtml}</div>`;
    div.innerHTML = html;
    return div;
  };

  // T√çTULO PRINCIPAL (AZUL MARINO)
  const mainTitle = document.createElement("h2");
  mainTitle.style.cssText = "color: #1f3c73; font-size: 19px; font-weight: bold; text-transform: uppercase; margin-bottom: 20px;";
  mainTitle.textContent = "TR√ÅMITE DE MONTOS SUPERIORES A $70,000.00";
  container.appendChild(mainTitle);

  // CONTENIDO EN PUNTOS
  const contenidoMontos = `
    <p style="font-weight: bold; margin-bottom: 10px; color: #000;">Requisitos para montos superiores a $70,000:</p>
    <ul style="margin: 0; padding-left: 20px; color: #000; list-style-type: disc;">
      <li style="line-height: 1.8;">
        Debe contar con un historial en el reporte de bur√≥ de al menos tres cr√©ditos iguales o superiores al monto a solicitar, calificados con <strong>MOP 01</strong>, o bien, el monto asignado deber√° corresponder al n√∫mero de ciclo actual.
      </li>
    </ul>
  `;

  container.appendChild(crearBloqueMontos(null, contenidoMontos));

  // NOTA INFORMATIVA (FONDO #fff3cd, PALABRA "Nota" EN NARANJA #f28511)
  const note = document.createElement("div");
  note.style.cssText = `
    margin-top: 12px;
    padding: 15px;
    background: #fff3cd; 
    border-radius: 6px;
    font-size: 14px;
    color: #000;
    border: 1px solid #ffeeba;
  `;
  note.innerHTML = `<strong><span style="color: #f28511;">Nota:</span></strong> Los socios con historial grupal en la cooperativa que hayan pagado tres ciclos con un monto de $70,000.00 sin atrasos podr√°n incrementar su monto hasta $100,000.00.`;
  container.appendChild(note);

  return { type: 'html', content: container };
} 

if (keywords.adicional.some(kw => lower.includes(kw))) {
  const container = document.createElement("div");

  // --- ESTILOS DE TABLA ---
  const tableStyle = `width:100%; border-collapse:collapse; font-family:Arial; font-size:13px; margin-top:10px; border:1px solid #000; background-color: white;`;
  const headerStyle = `background:#1f3c73; color:white; border:1px solid #000; padding:10px; text-align:center; font-weight:bold;`;
  const cellStyle = `border:1px solid #000; padding:8px; text-align:center; color:#000;`;

  // --- FUNCI√ìN PARA CREAR BLOQUES DE DISE√ëO ---
  const crearBloqueAdicional = (titulo, contenidoHtml) => {
    const div = document.createElement("div");
    div.style.cssText = `
      background-color: #fdf5e8;
      border-left: 6px solid #6495ED;
      border-top: 1px solid #e0e0e0;
      border-right: 1px solid #e0e0e0;
      border-bottom: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 20px;
      font-family: Arial, sans-serif;
    `;
    
    let html = "";
    if (titulo) {
      html += `<p style="margin-bottom: 15px; font-weight: bold; color: #1f3c73; font-size: 16px; text-transform: uppercase;">${titulo}</p>`;
    }
    html += `<div style="font-size: 14px; color: #000; line-height: 1.6;">${contenidoHtml}</div>`;
    div.innerHTML = html;
    return div;
  };

  // T√çTULO PRINCIPAL (AZUL MARINO)
  const mainTitle = document.createElement("h2");
  mainTitle.style.cssText = "color: #1f3c73; font-size: 19px; font-weight: bold; text-transform: uppercase; margin-bottom: 20px;";
  mainTitle.textContent = "CR√âDITO GRUPAL ADICIONAL";
  container.appendChild(mainTitle);

  // 1. CARACTER√çSTICAS Y TABLA
  const contenidoCaracteristicas = `
    <p style="font-weight: bold; margin-bottom: 10px;">üìã Caracter√≠sticas del cr√©dito adicional grupal:</p>
    <ul style="margin: 0 0 20px 0; padding-left: 20px; color: #000; list-style-type: disc;">
      <li>Monto: de $3,000.00 hasta $25,000.00</li>
      <li>Tasa de inter√©s anual natural: 32%</li>
      <li>Tasa de inter√©s moratoria anual: 36%</li>
      <li>Plazo: de 6 a 18 meses</li>
      <li>Periodicidad: semanal, Catorcenal, Quincenal o Mensual</li>
      <li>Garant√≠a: del 10 % del monto solicitado</li>
      <li>Cobertura del cr√©dito: 1 % del monto solicitado</li>
    </ul>
    <p style="font-weight: bold; margin-bottom: 8px;">Tabla de referencia:</p>
    <table style="${tableStyle}">
      <thead>
        <tr style="${headerStyle}">
          <th>Rango de Montos</th>
          <th>Plazo M√°ximo</th>
        </tr>
      </thead>
      <tbody>
        <tr><td style="${cellStyle}">$3,000 a $5,000</td><td style="${cellStyle}">6 meses</td></tr>
        <tr><td style="${cellStyle}">$5,001 a $15,000</td><td style="${cellStyle}">12 meses</td></tr>
        <tr><td style="${cellStyle}">$15,001 a $25,000</td><td style="${cellStyle}">18 meses</td></tr>
      </tbody>
    </table>
  `;
  container.appendChild(crearBloqueAdicional(null, contenidoCaracteristicas));

  // NOTA 1
  const note1 = document.createElement("div");
  note1.style.cssText = "margin-bottom:20px;padding:15px;background:#fff3cd;border-radius:6px;font-size:14px;color:#000;border:1px solid #ffeeba;";
  note1.innerHTML = `<strong> <span style="color: #f28511;">Nota:</span></strong> Se necesitar√° la autorizaci√≥n de todo el grupo por medio de una carta de consentimiento (no es necesario que el solicitante la firme) la cual tiene una vigencia de 30 d√≠as.`;
  container.appendChild(note1);

  // 2. POL√çTICAS
  const contenidoPoliticas = `
    <p style="font-weight: bold; margin-bottom: 10px;">üìå Pol√≠ticas:</p>
    <div style="padding-left: 5px; color: #000;">
      <p style="margin-bottom: 8px;"><strong>a)</strong> A partir del tercer ciclo siempre y cuando el grupo lleve un mes de pagos puntuales (4 semanas, 2 catorcenas o quincenas) de acuerdo con su plan de pago.</p>
      <p style="margin-bottom: 8px;"><strong>b)</strong> El socio deber√° estar trabajando o haber pagado un cr√©dito grupal con monto igual o mayor a $6,000.00</p>
      <p style="margin-bottom: 8px;"><strong>c)</strong> Como cr√©dito adicional el socio tendr√° acceso al 50 % del monto trabajado en el ciclo o el monto m√°s alto con el que haya trabajado en cr√©ditos grupales. Teniendo como m√≠nimo $3,000.00 y un m√°ximo de $25,000.00 previamente validado con su capacidad de pago.</p>
      <p style="margin-bottom: 8px;"><strong>d)</strong> En caso de solicitar un cr√©dito adicional mayor de $15,001.00 se necesita haber pagado un monto igual a $15,000.00 sin haberse atrasado m√°s de un pago, con excepci√≥n de los convenios de colaboraci√≥n (agua, etc.).</p>
      <p style="margin-bottom: 8px;"><strong>e)</strong> No se otorgar√° el cr√©dito adicional grupal si el grupo se encuentra en atrasos.</p>
      <p style="margin-bottom: 0;"><strong>f)</strong> Se podr√° renovar una vez pagado el 50 % del monto otorgado.</p>
    </div>
  `;
  container.appendChild(crearBloqueAdicional(null, contenidoPoliticas));

  // 3. PROGRAMA AGUA
  const contenidoAgua = `
    <p style="font-weight: bold; margin-bottom: 10px;">üíß Programa: Agua y Saneamiento</p>
    <p style="margin-bottom: 10px;">Pol√≠ticas de cr√©ditos destinados a la mejora de sistemas de almacenamiento, saneamiento y cuidado del agua:</p>
    <ul style="margin: 0; padding-left: 20px; color: #000; list-style-type: none;">
      <li style="margin-bottom: 8px;">1. Socios con cr√©dito grupal activo o grupos nuevos en la cooperativa</li>
      <li style="margin-bottom: 8px;">2. Los productos participantes son: cr√©dito adicional grupal y grupal consumo-avance</li>
      <li style="margin-bottom: 0;">3. Finalidades del cr√©dito:</li>
      <li style="padding-left: 15px; margin-top: 5px;">‚Ä¢ Compra de tinacos, biodigestores y/o calentadores solares</li>
      <li style="padding-left: 15px;">‚Ä¢ Construcci√≥n o remodelaci√≥n de sanitario</li>
      <li style="padding-left: 15px;">‚Ä¢ Mobiliario y accesorios (tazas, regaderas, llaves, etc.)</li>
      <li style="padding-left: 15px;">‚Ä¢ Conexi√≥n (plomer√≠a, tuber√≠as o drenaje)</li>
      <li style="padding-left: 15px;">‚Ä¢ Construcci√≥n de letrinas, fosas s√©pticas, cisternas o tanques para almacenar agua dom√©stica</li>
      <li style="padding-left: 15px;">‚Ä¢ Compra e instalaci√≥n de motobomba dom√©stica o filtros de purificaci√≥n de agua</li>
      <li style="padding-left: 15px;">‚Ä¢ Construcci√≥n o finalizaci√≥n de pozo profundo</li>
    </ul>
  `;
  container.appendChild(crearBloqueAdicional(null, contenidoAgua));

  // NOTA FINAL (IMPORTANTE)
  const finalNote = document.createElement("div");
  finalNote.style.cssText = "margin-top:15px;padding:15px;background:#fff3cd;border-radius:6px;font-size:14px;color:#000;border:1px solid #ffeeba;";
  finalNote.innerHTML = `<strong> <span style="color: #f28511;">Importante:</span></strong> Consulta con tu asesor para m√°s detalles sobre programas especiales y con venios de colaboraci√≥n.`;
  container.appendChild(finalNote);

  return { type: 'html', content: container };
}

if (keywords.nuevos.some(kw => lower.includes(kw))) {
  const container = document.createElement("div");

  // --- FUNCI√ìN PARA CREAR BLOQUES DE DISE√ëO ---
  const crearBloqueGruposNuevos = (titulo, contenidoHtml) => {
    const div = document.createElement("div");
    div.style.cssText = `
      background-color: #fdf5e8;
      border-left: 6px solid #6495ED;
      border-top: 1px solid #e0e0e0;
      border-right: 1px solid #e0e0e0;
      border-bottom: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 20px;
      font-family: Arial, sans-serif;
    `;
    
    let html = "";
    if (titulo) {
      html += `<p style="margin-bottom: 15px; font-weight: bold; color: #1f3c73; font-size: 16px; text-transform: uppercase;">${titulo}</p>`;
    }
    html += `<div style="font-size: 14px; color: #000; line-height: 1.6;">${contenidoHtml}</div>`;
    div.innerHTML = html;
    return div;
  };

  // T√çTULO PRINCIPAL (AZUL MARINO)
  const mainTitle = document.createElement("h2");
  mainTitle.style.cssText = "color: #1f3c73; font-size: 19px; font-weight: bold; text-transform: uppercase; margin-bottom: 20px;";
  mainTitle.textContent = "GRUPOS NUEVOS";
  container.appendChild(mainTitle);

  // CONTENIDO: REQUISITOS Y LISTA NUMERADA
  const contenidoGrupos = `
    <p style="font-weight: bold; margin-bottom: 10px;">REQUISITOS PARA FORMAR UN GRUPO</p>
    <ul style="margin-bottom: 15px; padding-left: 20px;">
      <li>Todos los integrantes deber√°n ser socios de la cooperativa.</li>
    </ul>
    
    <ol style="margin: 0; padding-left: 20px; color: #000;">
      <li style="margin-bottom: 12px;">
        <strong>N√∫mero de integrantes:</strong><br>
        El grupo deber√° contar con un m√≠nimo de <mark>5 integrantes</mark>.
      </li>
      <li style="margin-bottom: 12px;">
        <strong>Rango de edad:</strong><br>
        Desde los <mark>18</mark> hasta los <mark>70 a√±os</mark> (0 d√≠as).
      </li>
      <li style="margin-bottom: 12px;">
        <strong>Integrantes que rentan:</strong><br>
        M√°ximo <mark>2 personas</mark> con vivienda rentada o prestada.
      </li>
      <li style="margin-bottom: 12px;">
        <strong>Distancia:</strong><br>
        La distancia entre viviendas o puntos de trabajo debe ser ‚â§ <mark>5 km</mark>.
      </li>
      <li style="margin-bottom: 12px;">
        <strong>Comprobante de ingresos:</strong><br>
        Todos los integrantes deben contar con ingresos propios.
      </li>
      <li style="margin-bottom: 12px;">
        <strong>Garant√≠as y protecci√≥n:</strong>
        <ul style="margin-top:6px; padding-left: 20px; list-style-type: circle;">
          <li>Garant√≠a m√≠nima equivalente al <mark>10%</mark> del monto del cr√©dito, la cual podr√° ser depositada o retenida en su totalidad.</li>
          <li>Protecci√≥n del <mark>1 %</mark> por cr√©dito ($10 por cada $1,000.00).</li>
        </ul>
      </li>
      <li style="margin-bottom: 12px;">
        <strong>Sujeto a cr√©dito:</strong><br>
        Los integrantes deber√°n contar con clasificaci√≥n de riesgo <mark>bajo o medio</mark>.
      </li>
      <li style="margin-bottom: 0;">
        <strong>Integrantes por domicilio:</strong><br>
        M√°ximo <mark>2 integrantes</mark> podr√°n vivir en el mismo domicilio.
      </li>
    </ol>
  `;

  container.appendChild(crearBloqueGruposNuevos(null, contenidoGrupos));

  // NOTA INFORMATIVA (CON "Nota" EN NARANJA)
  const note = document.createElement("div");
  note.style.cssText = `
    margin-top: 15px;
    padding: 15px;
    background: #fff3cd;
    border-radius: 6px;
    font-size: 14px;
    color: #000;
    border: 1px solid #ffeeba;
  `;
  note.innerHTML = `
    <strong> <span style="color: #f28511;">Nota</span> ‚Äì Finalidad del cr√©dito:</strong>
    <ul style="margin-top:8px; padding-left: 20px;">
      <li style="margin-bottom: 5px;"><strong>Finalidad comercial:</strong> Aplica cuando todos los integrantes cuentan con actividad comercial.</li>
      <li style="margin-bottom: 5px;">Si alg√∫n integrante percibe ingresos por n√≥mina, pero comprueba que el cr√©dito ser√° destinado a un negocio, se considerar√° finalidad comercial.</li>
      <li>Si no se justifica la inversi√≥n, el cr√©dito se otorgar√° como producto de finalidad de consumo.</li>
    </ul>
  `;
  container.appendChild(note);

  return { type: 'html', content: container };
}     

if (keywords.generalidades.some(kw => lower.includes(kw))) {
  const container = document.createElement("div");

  // --- FUNCI√ìN PARA CREAR BLOQUES DE DISE√ëO ---
  const crearBloqueDesembolso = (titulo, contenidoHtml) => {
    const div = document.createElement("div");
    div.style.cssText = `
      background-color: #fdf5e8;
      border-left: 6px solid #6495ED;
      border-top: 1px solid #e0e0e0;
      border-right: 1px solid #e0e0e0;
      border-bottom: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 20px;
      font-family: Arial, sans-serif;
    `;
    
    let html = "";
    if (titulo) {
      html += `<p style="margin-bottom: 15px; font-weight: bold; color: #1f3c73; font-size: 16px; text-transform: uppercase;">${titulo}</p>`;
    }
    html += `<div style="font-size: 14px; color: #000; line-height: 1.6;">${contenidoHtml}</div>`;
    div.innerHTML = html;
    return div;
  };

  // T√çTULO PRINCIPAL (AZUL MARINO)
  const mainTitle = document.createElement("h2");
  mainTitle.style.cssText = "color: #1f3c73; font-size: 19px; font-weight: bold; text-transform: uppercase; margin-bottom: 20px;";
  mainTitle.textContent = "DESEMBOLSO FUERA DE SUCURSAL";
  container.appendChild(mainTitle);

  // CONTENIDO DEL CUERPO
  const contenidoCuerpo = `
    <p style="font-weight: bold; margin-bottom: 12px; color: #1f3c73;">üí∞ DESEMBOLSO EN CAMPO</p>
    <p style="margin-bottom: 10px;"><strong>DE LA ENTREGA DEL CR√âDITO FUERA DE SUCURSAL:</strong></p>
    <p style="margin-bottom: 12px;">Los desembolsos fuera de sucursal s√≥lo aplican para grupos con un valor de <strong>$60,000.00 o superior.</strong></p>
    <ul style="margin: 0; padding-left: 20px; color: #000; list-style-type: disc;">
      <li style="margin-bottom: 8px;">Se env√≠a el formato <mark>"desembolso fuera de sucursal"</mark> para visto bueno a la coordinaci√≥n de cr√©ditos solidarios.</li>
      <li style="margin-bottom: 8px;">Una vez que se tenga el visto bueno, mesa de control permitir√° el desembolso en el sistema entendiendose que el pagar√©, contrato y plan de pagos no cuentan con las firmas de los socios.</li>
      <li style="margin-bottom: 8px;">Una vez permitido el desembolso por mesa de control se expide el cheque a nombre del socio por la cantidad a entregar.</li>
      <li style="margin-bottom: 8px;">El asesor es el responsable de recabar y cotejar las firmas.</li>
      <li style="margin-bottom: 8px;">La documenaci√≥n firmada se debe entregar a mesa de control el mismo d√≠a de la entrega del cr√©dito.</li>
      <li style="margin-bottom: 8px;">En caso de haber un error u omision se deber√°n realizar las correciones a m√°s tardar un d√≠a h√°bil despues de haber realizado el desembolso.</li>
      <li style="margin-bottom: 0;">En caso de que el desembolso en campo no se realice, se debe notificar de inmediato al gerente de sucursal para reversar los movimientos, en caso de no avisar inmediatamente el asesor ser√° el responsable de los costos generados.</li>
    </ul>
  `;

  container.appendChild(crearBloqueDesembolso(null, contenidoCuerpo));

  return { type: 'html', content: container };
}

if (keywords.adulto.some(kw => lower.includes(kw))) {
  const container = document.createElement("div");

  // --- FUNCI√ìN PARA CREAR BLOQUES DE DISE√ëO ---
  const crearBloqueAdultos = (titulo, contenidoHtml) => {
    const div = document.createElement("div");
    div.style.cssText = `
      background-color: #fdf5e8;
      border-left: 6px solid #6495ED;
      border-top: 1px solid #e0e0e0;
      border-right: 1px solid #e0e0e0;
      border-bottom: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 20px;
      font-family: Arial, sans-serif;
    `;
    
    let html = "";
    if (titulo) {
      html += `<p style="margin-bottom: 15px; font-weight: bold; color: #1f3c73; font-size: 16px; text-transform: uppercase;">${titulo}</p>`;
    }
    html += `<div style="font-size: 14px; color: #000; line-height: 1.6;">${contenidoHtml}</div>`;
    div.innerHTML = html;
    return div;
  };

  // T√çTULO PRINCIPAL (AZUL MARINO)
  const mainTitle = document.createElement("h2");
  mainTitle.style.cssText = "color: #1f3c73; font-size: 19px; font-weight: bold; text-transform: uppercase; margin-bottom: 20px;";
  mainTitle.textContent = "M√ÅS DE 70 A√ëOS";
  container.appendChild(mainTitle);

  // CONTENIDO DEL BLOQUE
  const contenidoCuerpo = `
    <p style="font-weight: bold; margin-bottom: 12px; color: #1f3c73;">üë¥ POL√çTICAS PARA ADULTOS MAYORES</p>
    <p style="margin-bottom: 10px;"><strong>POL√çTICAS PARA SOCIOS DE 70 A 80 A√ëOS:</strong></p>
    <p style="margin-bottom: 12px;">Los socios que se encuentren en un rango <strong>de 70 a 80 a√±os</strong> se le otorgar√°n los cr√©ditos de acuerdo con los siguientes criterios:</p>
    <ul style="margin: 0; padding-left: 20px; color: #000; list-style-type: disc;">
      <li style="margin-bottom: 8px;">No haber reflejado atrasos de m√°s de una cuota en su √∫ltimo ciclo trabajado dentro de la Cooperativa Acreimex.</li>
      <li style="margin-bottom: 0;">El monto para otorgar al integrante en este rango de edad ser√° de acuerdo con la tabla de ciclos de cada producto, y hasta $50,000.00 (cincuenta mil pesos 00/100 M. N.).</li>
    </ul>
  `;

  container.appendChild(crearBloqueAdultos(null, contenidoCuerpo));

  // NOTA INFORMATIVA
  const note = document.createElement("div");
  note.style.cssText = `
    margin-top: 12px;
    padding: 15px;
    background: #fff3cd;
    border-radius: 6px;
    font-size: 14px;
    color: #000;
    border: 1px solid #ffeeba;
  `;
  note.innerHTML = `<strong> <span style="color: #f28511;">Nota:</span></strong> Cuando la persona est√© trabajando un monto mayor a $50,000.00 y requiera el mismo monto, se podr√° mandar a comit√© de cr√©dito, siempre y cuando no se hayan reflejado atrasos en su √∫ltimo cr√©dito.`;
  container.appendChild(note);

  return { type: 'html', content: container };
}      

if (keywords.multas.some(kw => lower.includes(kw))) {
  const container = document.createElement("div");

  // --- ESTILOS DE TABLA ---
  const tableStyle = `width:100%; border-collapse:collapse; font-family:Arial; font-size:13px; margin-top:10px; border:1px solid #000; background-color: white;`;
  const headerStyle = `background:#1f3c73; color:white; border:1px solid #000; padding:10px; text-align:center; font-weight:bold;`;
  const cellStyle = `border:1px solid #000; padding:8px; text-align:center; color:#000;`;

  // --- FUNCI√ìN PARA CREAR BLOQUES DE DISE√ëO ---
  const crearBloquePenalizaciones = (titulo, contenidoHtml) => {
    const div = document.createElement("div");
    div.style.cssText = `
      background-color: #fdf5e8;
      border-left: 6px solid #6495ED;
      border-top: 1px solid #e0e0e0;
      border-right: 1px solid #e0e0e0;
      border-bottom: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 20px;
      font-family: Arial, sans-serif;
    `;
    
    let html = "";
    if (titulo) {
      html += `<p style="margin-bottom: 15px; font-weight: bold; color: #1f3c73; font-size: 16px; text-transform: uppercase;">${titulo}</p>`;
    }
    html += `<div style="font-size: 14px; color: #000; line-height: 1.6;">${contenidoHtml}</div>`;
    div.innerHTML = html;
    return div;
  };

  // T√çTULO PRINCIPAL (AZUL MARINO)
  const mainTitle = document.createElement("h2");
  mainTitle.style.cssText = "color: #1f3c73; font-size: 19px; font-weight: bold; text-transform: uppercase; margin-bottom: 20px;";
  mainTitle.textContent = "PENALIZACIONES";
  container.appendChild(mainTitle);

  // 1. INTRODUCCI√ìN Y POL√çTICAS POR CUOTAS
  const contenidoPenalIntro = `
    <p style="font-weight: bold; color: #dc2626; margin-bottom: 12px;"><strong>‚ö†Ô∏è PENALIZACIONES POR ATRASOS</p>
    <p style="font-weight: 500; margin-bottom: 15px;">Las penalizaciones se aplican seg√∫n el n√∫mero de cuotas vencidas acumuladas:</strong></p>
    
    <div style="margin-bottom: 15px; padding-left: 10px; border-left: 3px solid #f59e0b;">
      <p style="color: #92400e; font-weight: bold; margin-bottom: 5px;">üîπ 2 CUOTAS ACUMULADAS VENCIDAS</p>
      <p>NO pueden acceder a un incremento de monto.</p>
    </div>

    <div style="padding-left: 10px; border-left: 3px solid #dc2626;">
      <p style="color: #991b1b; font-weight: bold; margin-bottom: 8px;">üî¥ 4 CUOTAS ACUMULADAS VENCIDAS</p>
      <ul style="margin: 0; padding-left: 20px; list-style-type: disc;">
        <li style="margin-bottom: 6px;"><strong>Primero:</strong> Se solicita la reasignaci√≥n de tasa del ciclo uno de acuerdo con el producto, a la <mark>Coordinaci√≥n de Cr√©ditos Solidarios</mark>.</li>
        <li style="margin-bottom: 6px;"><strong>Segundo:</strong> El monto asignado ser√° el √∫ltimo monto de cuant√≠a menor en el que no se hayan atrasado m√°s de una cuota.</li>
        <li><strong>Tercero:</strong> Los montos m√°ximos a otorgar deber√°n tener una proporcionalidad de 50% entre los integrantes.</li>
      </ul>
    </div>
  `;
  container.appendChild(crearBloquePenalizaciones(null, contenidoPenalIntro));

  // 2. TABLA DE D√çAS DE ATRASO
  const contenidoTabla = `
    <p style="font-weight: bold; margin-bottom: 10px;">Tabla de dias de atraso:</p>
    <table style="${tableStyle}">
      <thead>
        <tr style="${headerStyle}">
          <th>Periodicidad</th>
          <th>2 cuotas vencidas</th>
          <th>3 cuotas vencidas</th>
          <th>4 cuotas vencidas</th>
        </tr>
      </thead>
      <tbody>
        <tr><td style="${cellStyle}">Semanal</td><td style="${cellStyle}">7 d√≠as</td><td style="${cellStyle}">15 d√≠as</td><td style="${cellStyle}">21 d√≠as</td></tr>
        <tr><td style="${cellStyle}">Catorcenal</td><td style="${cellStyle}">14 d√≠as</td><td style="${cellStyle}">28 d√≠as</td><td style="${cellStyle}">42 d√≠as</td></tr>
        <tr><td style="${cellStyle}">Quincenal</td><td style="${cellStyle}">15 d√≠as</td><td style="${cellStyle}">30 d√≠as</td><td style="${cellStyle}">45 d√≠as</td></tr>
      </tbody>
    </table>
  `;
  container.appendChild(crearBloquePenalizaciones(null, contenidoTabla));

  // NOTA INFORMATIVA
  const warningNote = document.createElement("div");
  warningNote.style.cssText = `
    margin-top: 15px;
    padding: 15px;
    background: #fff3cd;
    border-radius: 6px;
    font-size: 14px;
    color: #000;
    border: 1px solid #ffeeba;
  `;
  warningNote.innerHTML = `<strong> <span style="color: #f28511;">Nota importante:</span></strong> Las penalizaciones buscan incentivar el pago puntual y hacer conciencia de que existe una consecuencia en caso de atrasos.`;
  container.appendChild(warningNote);

  return { type: 'html', content: container };
}      

if (keywords.sucursal.some(kw => lower.includes(kw))) {
  const container = document.createElement("div");

  // --- FUNCI√ìN PARA CREAR BLOQUES DE DISE√ëO ---
  const crearBloqueSucursal = (titulo, contenidoHtml) => {
    const div = document.createElement("div");
    div.style.cssText = `
      background-color: #fdf5e8;
      border-left: 6px solid #6495ED;
      border-top: 1px solid #e0e0e0;
      border-right: 1px solid #e0e0e0;
      border-bottom: 1px solid #e0e0e0;
      border-radius: 8px;
      padding: 25px;
      margin-bottom: 20px;
      font-family: Arial, sans-serif;
    `;
    
    let html = "";
    if (titulo) {
      html += `<p style="margin-bottom: 15px; font-weight: bold; color: #1f3c73; font-size: 16px; text-transform: uppercase;">${titulo}</p>`;
    }
    html += `<div style="font-size: 14px; color: #000; line-height: 1.6;">${contenidoHtml}</div>`;
    div.innerHTML = html;
    return div;
  };

  // T√çTULO PRINCIPAL (AZUL MARINO)
  const mainTitle = document.createElement("h2");
  mainTitle.style.cssText = "color: #1f3c73; font-size: 19px; font-weight: bold; text-transform: uppercase; margin-bottom: 20px;";
  mainTitle.textContent = "CAMBIO DE SUCURSAL";
  container.appendChild(mainTitle);

  // CONTENIDO DEL BLOQUE
  const contenidoCuerpo = `
    <p style="font-weight: 500; margin-bottom: 15px;"><strong>Para realizar el cambio de sucursal, el socio deber√° cumplir con las siguientes pol√≠ticas y lineamientos:</strong></p>
    <ul style="margin: 0; padding-left: 20px; color: #000; list-style-type: disc;">
      <li style="margin-bottom: 10px;">El socio deber√° solicitar el cambio de sucursal de manera formal, indicando el motivo de la solicitud.</li>
      <li style="margin-bottom: 10px;">El socio no deber√° presentar adeudos vencidos al momento de solicitar el cambio.</li>
      <li style="margin-bottom: 10px;">La solicitud estar√° sujeta a revisi√≥n y autorizaci√≥n por parte de la sucursal de origen y la sucursal destino.</li>
      <li style="margin-bottom: 10px;">Se deber√° verificar que el expediente del socio est√© completo y actualizado.</li>
      <li style="margin-bottom: 10px;">El cambio de sucursal podr√° realizarse por cambio de domicilio, trabajo o causa debidamente justificada.</li>
      <li style="margin-bottom: 10px;">La sucursal destino deber√° contar con la capacidad operativa para recibir al socio.</li>
      <li style="margin-bottom: 10px;">Una vez autorizado, el expediente f√≠sico y digital ser√° transferido a la nueva sucursal.</li>
      <li style="margin-bottom: 0;">El cambio de sucursal no modifica las condiciones del cr√©dito, ahorro u otros productos contratados.</li>
    </ul>
  `;

  container.appendChild(crearBloqueSucursal(null, contenidoCuerpo));

  return { type: 'html', content: container };
}

 if (keywords.coordinacion.some(kw => lower.includes(kw))) {
        const container = document.createElement("div");
        const title = document.createElement("strong");
        title.textContent = "SIMULADOR DE PAGOS-CR√âDITOS SOLIDARIOS";
        container.appendChild(title);
        container.appendChild(document.createElement("br"));
        container.appendChild(document.createElement("br"));

        const closeBtn = document.createElement("button");
        closeBtn.textContent = "‚úñ";
        closeBtn.style.cssText = "float:right;background:red;border:none;cursor:pointer;color:white;font-size:24px;padding:10px 15px;border-radius:6px;";
        closeBtn.addEventListener("click", () => { container.remove(); });
        container.appendChild(closeBtn);
        
        // Calculadora
        const calcCard = document.createElement("div");
        calcCard.style.cssText = "background:white;padding:20px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);margin-bottom:15px;";
       
        // Producto
        const prodRow = document.createElement("div");
        prodRow.style.marginBottom = "12px";
        prodRow.innerHTML = `<label style="display:block;margin-bottom:5px;font-weight:600;">Producto:</label>`;
        const prodSelect = document.createElement("select");
        prodSelect.id = "producto";
        prodSelect.style.cssText = "width:100%;padding:8px;border-radius:6px;border:1px solid #d1d5db;";
        prodSelect.innerHTML = `
          <option value="poder">Poder de Mujer</option>
          <option value="mixto">Grupal Mixto</option>
          <option value="preferente">Grupal Preferente</option>
          <option value="consumo">Consumo avance</option>
          <option value="impulso">Impulso solidario</option>
        `;
        prodRow.appendChild(prodSelect);
        calcCard.appendChild(prodRow);
        
        // Ciclo
        const cicloRow = document.createElement("div");
        cicloRow.style.marginBottom = "12px";
        cicloRow.innerHTML = `<label style="display:block;margin-bottom:5px;font-weight:600;">Ciclo:</label>`;
        const cicloSelect = document.createElement("select");
        cicloSelect.id = "ciclo";
        cicloSelect.style.cssText = "width:100%;padding:8px;border-radius:6px;border:1px solid #d1d5db;";
        cicloRow.appendChild(cicloSelect);
        calcCard.appendChild(cicloRow);
        
        // Monto
        const montoRow = document.createElement("div");
        montoRow.style.marginBottom = "12px";
        montoRow.innerHTML = `<label style="display:block;margin-bottom:5px;font-weight:600;">Monto solicitado (por integrante $):</label>`;
        const montoInput = document.createElement("input");
        montoInput.type = "number";
        montoInput.id = "monto";
        montoInput.placeholder = "Ej: 3000";
        montoInput.min = "0";
        montoInput.style.cssText = "width:100%;padding:8px;border-radius:6px;border:1px solid #d1d5db;";
        montoRow.appendChild(montoInput);
        calcCard.appendChild(montoRow);
        
        // Periodicidad
        const perRow = document.createElement("div");
        perRow.style.marginBottom = "12px";
        perRow.innerHTML = `<label style="display:block;margin-bottom:5px;font-weight:600;">Periodicidad:</label>`;
        const perSelect = document.createElement("select");
        perSelect.id = "periodicidad";
        perSelect.style.cssText = "width:100%;padding:8px;border-radius:6px;border:1px solid #d1d5db;";
        perRow.appendChild(perSelect);
        calcCard.appendChild(perRow);
        
        // N√∫mero de pagos
        const pagosRow = document.createElement("div");
        pagosRow.style.marginBottom = "12px";
        pagosRow.innerHTML = `<label style="display:block;margin-bottom:5px;font-weight:600;">N√∫mero de pagos:</label>`;
        const pagosSelect = document.createElement("select");
        pagosSelect.id = "numPagos";
        pagosSelect.style.cssText = "width:100%;padding:8px;border-radius:6px;border:1px solid #d1d5db;";
        pagosRow.appendChild(pagosSelect);
        calcCard.appendChild(pagosRow);
        
        // Resultados peque√±os
        const miniResults = document.createElement("div");
        miniResults.style.cssText = "display:flex;gap:10px;margin-top:12px;";
        
        const pago1000Div = document.createElement("div");
        pago1000Div.style.flex = "1";
        pago1000Div.innerHTML = `<label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Pago por cada $1,000:</label>`;
        const pago1000Input = document.createElement("input");
        pago1000Input.id = "pago1000";
        pago1000Input.readOnly = true;
        pago1000Input.style.cssText = "width:100%;padding:8px;border-radius:6px;border:1px solid #d1d5db;background:#f9fafb;";
        pago1000Div.appendChild(pago1000Input);
        
        const tasaDiv = document.createElement("div");
        tasaDiv.style.flex = "1";
        tasaDiv.innerHTML = `<label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Tasa del ciclo:</label>`;
        const tasaInput = document.createElement("input");
        tasaInput.id = "tasaCiclo";
        tasaInput.readOnly = true;
        tasaInput.style.cssText = "width:100%;padding:8px;border-radius:6px;border:1px solid #d1d5db;background:#f9fafb;";
        tasaDiv.appendChild(tasaInput);
        
        miniResults.appendChild(pago1000Div);
        miniResults.appendChild(tasaDiv);
        calcCard.appendChild(miniResults);
        
        // Resultado principal
        const resultBox = document.createElement("div");
        resultBox.id = "resultadoBox";
        resultBox.style.cssText = "background:#f0f9ff;padding:15px;border-radius:8px;margin-top:15px;border:2px solid #bfdbfe;";
        
        const resLinea1 = document.createElement("div");
        resLinea1.id = "resLinea1";
        resLinea1.textContent = "Ingrese datos para ver resultados";
        resLinea1.style.cssText = "font-size:14px;color:#64748b;";
        resultBox.appendChild(resLinea1);
        
        const resLinea2 = document.createElement("div");
        resLinea2.id = "resLinea2";
        resLinea2.style.cssText = "color:#1e293b;font-weight:600;margin-top:5px;";
        resultBox.appendChild(resLinea2);
        
        const resLinea3 = document.createElement("div");
        resLinea3.id = "resLinea3";
        resLinea3.style.cssText = "color:#1e293b;margin-top:3px;";
        resultBox.appendChild(resLinea3);
        
        const errorDiv = document.createElement("div");
        errorDiv.id = "error";
        errorDiv.style.cssText = "display:none;color:#dc2626;margin-top:8px;font-size:13px;";
        resultBox.appendChild(errorDiv);
        
        calcCard.appendChild(resultBox);
        
        // Bot√≥n generar ficha
        const fichaBtn = document.createElement("button");
        fichaBtn.textContent = "Generar ficha descriptiva";
        fichaBtn.style.cssText = "width:100%;margin-top:10px;padding:10px;background:#2563eb;color:white;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:all 0.2s;";
        fichaBtn.addEventListener("mouseover", () => { fichaBtn.style.background = "#1d4ed8"; });
        fichaBtn.addEventListener("mouseout", () => { fichaBtn.style.background = "#2563eb"; });
        fichaBtn.addEventListener("click", () => { generarFicha(); });
        calcCard.appendChild(fichaBtn);
        
        const noteCalc = document.createElement("div");
        noteCalc.style.cssText = "margin-top:10px;padding:10px;background:#fff3cd;border-radius:6px;font-size:12px;";
        noteCalc.innerHTML = "<strong>Nota:</strong> Si existe un 'monto por cada $1,000' en la tabla se utilizar√°. Si no, se usar√° el monto base del producto.";
        calcCard.appendChild(noteCalc);

        container.appendChild(calcCard);
        
        // Botones de tablas
        const tablesSection = document.createElement("div");
        tablesSection.style.cssText = "margin-top:20px;padding-top:15px;border-top:2px solid #e5e7eb;";
        
        const tablesTitle = document.createElement("h4");
        tablesTitle.textContent = "Tablas por Ciclo";
        tablesTitle.style.marginTop = "0";
        tablesSection.appendChild(tablesTitle);
        
        const btnContainer = document.createElement("div");
        btnContainer.style.cssText = "display:flex;flex-wrap:wrap;gap:10px;margin-top:10px;";
        
        const tableButtons = [
          { text: "Ver tabla Mixto", id: "mixto" },
          { text: "Ver tabla Consumo", id: "consumo" },
          { text: "Ver tabla Impulso", id: "impulso" },
          { text: "Ver tabla Poder", id: "poder" },
          { text: "Ver tabla Preferente", id: "preferente" }
        ];
        
        tableButtons.forEach(btn => {
          const button = document.createElement("button");
          button.textContent = btn.text;
          button.style.cssText = "padding:8px 16px;background:#e0f2fe;border:1px solid #0ea5e9;border-radius:6px;cursor:pointer;font-size:13px;font-weight:500;transition:all 0.2s;";
          button.addEventListener("mouseover", () => {
            button.style.background = "#0ea5e9";
            button.style.color = "white";
          });
          button.addEventListener("mouseout", () => {
            button.style.background = "#e0f2fe";
            button.style.color = "inherit";
          });
          button.addEventListener("click", () => { mostrarTablaCompleta(btn.id); });
          btnContainer.appendChild(button);
        });
        
        tablesSection.appendChild(btnContainer);
        container.appendChild(tablesSection);
        
        const infoNote = document.createElement("div");
        infoNote.style.cssText = "margin-top:15px;padding:12px;background:#d1ecf1;border-radius:6px;font-size:13px;";
        infoNote.innerHTML = "<strong>üí° Importante:</strong> Esta herramienta te permite simular cr√©ditos de: Poder de Mujer, Grupal Mixto, Grupal Preferente, Consumo Avance e Impulso Solidario. Selecciona el producto, el ciclo y el monto para conocer los resultados.";
        container.appendChild(infoNote);

        const closeReminder = document.createElement("div");
        closeReminder.style.cssText = "margin-top:15px;padding:15px;background:#f87171;border-radius:6px;font-size:16px;font-weight:600;color:white;text-align:center;";
        closeReminder.innerHTML = "‚ö†Ô∏è No olvides cerrar la herramienta del simulador con el bot√≥n ‚úñ antes de continuar.";
        container.appendChild(closeReminder);
        
        // Inicializar calculadora despu√©s de agregar al DOM
        setTimeout(() => { initCalculadora(); }, 100);
        
        return { type: 'html', content: container };
      }

      return { type: 'text', content: "No entend√≠ tu consulta ü§î. Intenta de nuevo: üí∞(INGRESOS) üíµ(IGUALACION DE MONTOS) üè†(DOMICILIO) üîÑ(RENOVACIONES) üìù(ADICIONAL) üë•(GRUPOS NUEVOS) üè¢(SUCURSAL) ‚ö†Ô∏è(PENALIZACIONES) üèòÔ∏è(VIVIENDA RENTADA) üìä(RENOVACION DE SALDOS INSOLUTOS) üìÅ(DESEMBOLSO EN CAMPO) üìÇ(EXPEDIENTES) üí∞(MONTOS + DE 70000) üí∏(INCREMENTO SOCIOS ANTIGUOS) üë¥(ADULTOS MAYORES) üßÆ(CALCULADORA)?" };
    }

    function handleSend() {
      const input = document.getElementById("messageInput");
      const message = input.value.trim();
      
      if (!message) return;
      
      addMessage(message, true);
      input.value = "";
      
      setTimeout(() => {
        const response = getResponse(message);
        if (response.type === 'text') {
          addMessage(response.content, false);
        } else {
          addMessage(response.content, false);
        }
      }, 500);
    }

    document.getElementById("sendBtn").addEventListener("click", handleSend);
    document.getElementById("messageInput").addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        handleSend();
      }
    });

    // Welcome message
    setTimeout(() => {
      const advisors = ["koco bot", "koco"];
      const advisor = advisors[Math.floor(Math.random() * advisors.length)];
      const hour = new Date().getHours();
      let greeting = "¬°Hola!";
      if (hour >= 6 && hour < 12) greeting = "¬°Buenos d√≠as! üåÖ";
      else if (hour >= 12 && hour < 18) greeting = "¬°Buenas tardes! ‚òÄÔ∏è";
      else greeting = "¬°Buenas noches! üåô";

      const welcomeContainer = document.createElement("div");
      const greetingDiv = document.createElement("div");
      greetingDiv.style.fontWeight = "600";
      greetingDiv.style.marginBottom = "6px";
      greetingDiv.textContent = greeting;
      
      const messageDiv = document.createElement("div");
      messageDiv.innerHTML = `Gracias por comunicarte a la Coordinaci√≥n de Cr√©ditos Solidarios. Te atiende <strong>${advisor}</strong>. ¬øEn qu√© te puedo servir?`;
      
      welcomeContainer.appendChild(greetingDiv);
      welcomeContainer.appendChild(messageDiv);
      
      addMessage(welcomeContainer, false);
    }, 500);

    // Helper functions
    function $(id){ return document.getElementById(id); }
    function formatNumber(n){ return Number(n).toLocaleString('en-US'); }

    // Calculadora logic
    function initCalculadora() {
      const productoSelect = $("producto");
      const cicloSelect = $("ciclo");
      const montoInput = $("monto");
      const periodicidadSelect = $("periodicidad");
      const numPagosSelect = $("numPagos");
      
      if (!productoSelect || !cicloSelect) return;
      
      productoSelect.addEventListener("change", onProductoChange);
      cicloSelect.addEventListener("change", onCicloChange);
      periodicidadSelect.addEventListener("change", onPeriodicidadChange);
      numPagosSelect.addEventListener("change", calcular);
      montoInput.addEventListener("input", calcular);
      
      onProductoChange();
    }

    const productos = {
      mixto: {
        name: "Grupal Mixto",
        basePor1000: 68.41,
        ciclos: [
          { id:1, min:3000, max:10000, minDias:110, maxDias:187, periodos:["semanal","catorcenal","quincenal"], tasa:48 },
          { id:2, min:3000, max:15000, minDias:110, maxDias:187, periodos:["semanal","catorcenal","quincenal"], tasa:48 },
          { id:3, min:3000, max:20000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:42 },
          { id:4, min:3000, max:30000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:42 },
          { id:5, min:3000, max:40000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:6, min:3000, max:50000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:7, min:3000, max:60000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:30 },
          { id:8, min:3000, max:100000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:30 }
        ]
      },
      consumo: {
        name: "Consumo Avance",
        basePor1000: 68.41,
        ciclos: [
          { id:1, min:3000, max:10000, minDias:110, maxDias:187, periodos:["semanal","catorcenal","quincenal"], tasa:48 },
          { id:2, min:3000, max:15000, minDias:110, maxDias:187, periodos:["semanal","catorcenal","quincenal"], tasa:48 },
          { id:3, min:3000, max:20000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:42 },
          { id:4, min:3000, max:30000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:42 },
          { id:5, min:3000, max:40000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:6, min:3000, max:50000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:7, min:3000, max:60000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:30 },
          { id:8, min:3000, max:100000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:30 }
        ]
      },
      impulso: {
        name: "Impulso Solidario",
        basePor1000: 68.41,
        ciclos: [
          { id:1, min:3000, max:10000, minDias:110, maxDias:187, periodos:["semanal","catorcenal","quincenal"], tasa:48 },
          { id:2, min:3000, max:15000, minDias:110, maxDias:187, periodos:["semanal","catorcenal","quincenal"], tasa:48 },
          { id:3, min:3000, max:20000, minDias:110, maxDias:187, periodos:["semanal","catorcenal","quincenal"], tasa:48 },
          { id:4, min:3000, max:30000, minDias:110, maxDias:365, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:5, min:3000, max:40000, minDias:110, maxDias:365, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:6, min:3000, max:50000, minDias:110, maxDias:365, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:7, min:3000, max:60000, minDias:110, maxDias:365, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:8, min:3000, max:70000, minDias:110, maxDias:365, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:9, min:3000, max:80000, minDias:110, maxDias:365, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:10, min:3000, max:90000, minDias:110, maxDias:365, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:11, min:3000, max:100000, minDias:110, maxDias:365, periodos:["semanal","catorcenal","quincenal"], tasa:36 }
        ]
      },
      poder: {
        name: "Poder de Mujer",
        basePor1000: 67.65,
        ciclos: [
          { id:1, min:3000, max:10000, minDias:110, maxDias:187, periodos:["semanal","catorcenal","quincenal"], tasa:42 },
          { id:2, min:3000, max:15000, minDias:110, maxDias:187, periodos:["semanal","catorcenal","quincenal"], tasa:42 },
          { id:3, min:3000, max:20000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:4, min:3000, max:30000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:5, min:3000, max:40000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:33 },
          { id:6, min:3000, max:50000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:33 },
          { id:7, min:3000, max:60000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:30 },
          { id:8, min:3000, max:100000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:30 }
        ]
      },
      preferente: {
        name: "Grupal Preferente",
        basePor1000: 56.28,
        ciclos: [
          { id:1, min:3000, max:20000, minDias:110, maxDias:115, periodos:["semanal"], tasa:24 },
          { id:2, min:3000, max:25000, minDias:110, maxDias:115, periodos:["semanal"], tasa:24 },
          { id:3, min:3000, max:30000, minDias:110, maxDias:171, periodos:["semanal"], tasa:24 },
          { id:4, min:3000, max:40000, minDias:110, maxDias:171, periodos:["semanal","catorcenal","quincenal"], tasa:24 },
          { id:5, min:3000, max:50000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:24 },
          { id:6, min:3000, max:55000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:24 },
          { id:7, min:3000, max:60000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:24 },
          { id:8, min:3000, max:100000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:24 }
        ]
      }
    };

    const montosPor1000 = {
      poder:{
        16:{periodicidad:"semanal",monto:67.65},
        8:{periodicidad:"catorcenal",monto:135.90},
        "8_q":{periodicidad:"quincenal",monto:136.70},
        20:{periodicidad:"semanal",monto:55.10},
        10:{periodicidad:"catorcenal",monto:110.65},
        "10_q":{periodicidad:"quincenal",monto:111.40},
        24:{periodicidad:"semanal",monto:46.70},
        12:{periodicidad:"catorcenal",monto:93.85},
        "12_q":{periodicidad:"quincenal",monto:94.60}
      },
      mixto:{
        16:{periodicidad:"semanal",monto:68.41},
        8:{periodicidad:"catorcenal",monto:137.39},
        "8_q":{periodicidad:"quincenal",monto:138.27},
        20:{periodicidad:"semanal",monto:55.78},
        10:{periodicidad:"catorcenal",monto:112.11},
        "10_q":{periodicidad:"quincenal",monto:112.98},
        24:{periodicidad:"semanal",monto:47.40},
        12:{periodicidad:"catorcenal",monto:95.26},
        "12_q":{periodicidad:"quincenal",monto:96.11}
      },
      preferente:{
        16:{periodicidad:"semanal",monto:56.28},
        8:{periodicidad:"catorcenal",monto:112.96},
        "8_q":{periodicidad:"quincenal",monto:113.75},
        20:{periodicidad:"semanal",monto:45.88},
        10:{periodicidad:"catorcenal",monto:92.20},
        "10_q":{periodicidad:"quincenal",monto:92.98},
        24:{periodicidad:"semanal",monto:39.02},
        12:{periodicidad:"catorcenal",monto:78.35},
        "12_q":{periodicidad:"quincenal",monto:79.11}
      },
      impulso:{
        16:{periodicidad:"semanal",monto:68.41},
        8:{periodicidad:"catorcenal",monto:137.39},
        "8_q":{periodicidad:"quincenal",monto:138.27},
        20:{periodicidad:"semanal",monto:55.78},
        10:{periodicidad:"catorcenal",monto:112.11},
        "10_q":{periodicidad:"quincenal",monto:112.98},
        24:{periodicidad:"semanal",monto:47.40},
        12:{periodicidad:"catorcenal",monto:95.26},
        "12_q":{periodicidad:"quincenal",monto:96.11}
      },
      consumo:{
        16:{periodicidad:"semanal",monto:68.41},
        8:{periodicidad:"catorcenal",monto:137.39},
        "8_q":{periodicidad:"quincenal",monto:138.27},
        20:{periodicidad:"semanal",monto:55.78},
        10:{periodicidad:"catorcenal",monto:112.11},
        "10_q":{periodicidad:"quincenal",monto:112.98},
        24:{periodicidad:"semanal",monto:47.40},
        12:{periodicidad:"catorcenal",monto:95.26},
        "12_q":{periodicidad:"quincenal",monto:96.11}
      }
    };

    function llenarCiclos(prodKey){
      const sel = $('ciclo');
      sel.innerHTML = '';
      productos[prodKey].ciclos.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c.id;
        opt.text = `Ciclo ${c.id} ‚Äî $${formatNumber(c.min)} - $${formatNumber(c.max)} ‚Äî ${c.minDias}-${c.maxDias} d√≠as ‚Äî ${c.tasa}%`;
        sel.appendChild(opt);
      });
    }

    function llenarPeriodicidades(prodKey, cicloId){
      const sel = $('periodicidad');
      sel.innerHTML = '';
      const ciclo = productos[prodKey].ciclos.find(x => x.id == cicloId);
      ciclo.periodos.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p;
        opt.text = p.charAt(0).toUpperCase() + p.slice(1);
        sel.appendChild(opt);
      });
    }

    function generarOpcionesPagos(ciclo, periodicidad){
      let periodDays = 7;
      if (periodicidad === 'catorcenal') periodDays = 14;
      if (periodicidad === 'quincenal') periodDays = 15;
      const minPagos = Math.ceil(ciclo.minDias / periodDays);
      const maxPagos = Math.ceil(ciclo.maxDias / periodDays);

      const comunes = { semanal:[16,20,24,28,32,40], catorcenal:[8,10,12,14,20], quincenal:[8,10,12,14,20] };
      const listaComunes = (comunes[periodicidad] || []).filter(n => n >= minPagos && n <= maxPagos);
      if (listaComunes.length) return listaComunes;

      const arr = [];
      for (let n = minPagos; n <= maxPagos && arr.length < 20; n++) arr.push(n);
      return arr;
    }

    function onProductoChange(){
      const prod = $('producto').value;
      llenarCiclos(prod);
      llenarPeriodicidades(prod, $('ciclo').value);
      onPeriodicidadChange();
      calcular();
    }

    function onCicloChange(){
      const prod = $('producto').value;
      const ciclo = $('ciclo').value;
      llenarPeriodicidades(prod, ciclo);
      onPeriodicidadChange();
      calcular();
    }

    function onPeriodicidadChange(){
      const prod = $('producto').value;
      const cicloId = Number($('ciclo').value);
      const periodo = $('periodicidad').value;
      const ciclo = productos[prod].ciclos.find(c => c.id === cicloId);
      const opciones = generarOpcionesPagos(ciclo, periodo);
      const sel = $('numPagos');
      sel.innerHTML = '';
      opciones.forEach(n => {
        const o = document.createElement('option'); 
        o.value = n; 
        o.text = n + ' pagos'; 
        sel.appendChild(o);
      });
      calcular();
    }

    function buscarMontoPor1000(prodKey, numPagos, periodicidad){
      const map = montosPor1000[prodKey];
      if (!map) return null;
      if (periodicidad === 'quincenal'){
        const q = map[numPagos + '_q']; 
        if (q) return q.monto;
      }
      const v = map[numPagos];
      if (v && v.periodicidad === periodicidad) return v.monto;
      return null;
    }

    // Funci√≥n PAGO de Excel
    function PAGO(tasa, nper, vp) {
      if (tasa === 0) return vp / nper;
      return (tasa * vp) / (1 - Math.pow(1 + tasa, -nper));
    }

    function diasPorPeriodicidad(periodicidad){
      if (periodicidad === "semanal") return 7;
      if (periodicidad === "catorcenal") return 14;
      if (periodicidad === "quincenal") return 15;
      if (periodicidad === "mensual") return 30;
      return 0;
    }

    function calcular(){
      const prodKey = $('producto').value;
      const prod = productos[prodKey];
      const cicloId = Number($('ciclo').value);
      const ciclo = prod.ciclos.find(c => c.id === cicloId);

      const monto = parseFloat($('monto').value);
      if (!monto || monto <= 0){
        $('resLinea1').textContent = 'Ingrese datos para ver resultados';
        $('resLinea2').textContent = ''; 
        $('resLinea3').textContent = '';
        $('error').style.display = 'none';
        $('pago1000').value = '';
        $('tasaCiclo').value = ciclo.tasa + '%';
        return;
      }

      if (monto < ciclo.min || monto > ciclo.max){
        $('error').style.display = 'block';
        $('error').textContent = `El monto debe estar entre $${formatNumber(ciclo.min)} y $${formatNumber(ciclo.max)} para este ciclo (por integrante).`;
        $('resLinea1').textContent = 'Monto fuera de rango'; 
        $('resLinea2').textContent = ''; 
        $('resLinea3').textContent = '';
        $('pago1000').value = '';
        $('tasaCiclo').value = ciclo.tasa + '%';
        return;
      } else {
        $('error').style.display = 'none';
      }

      const periodicidad = $('periodicidad').value;
      const numPagos = Number($('numPagos').value);
      const tasaAnual = ciclo.tasa / 100;
      const aplicaIVA = true;
      const iva = 0.16;
      const diasPeriodo = diasPorPeriodicidad(periodicidad);
      
      $('tasaCiclo').value = ciclo.tasa + '%';

      const tasaPeriodo = ((tasaAnual * (1 + (aplicaIVA ? iva : 0))) / 360) * diasPeriodo;
      const cuota = Math.abs(PAGO(tasaPeriodo, numPagos, -monto));
      const total = cuota * numPagos;

      const cuotaPor1000 = Math.abs(PAGO(tasaPeriodo, numPagos, -1000));
      $('pago1000').value = `$ ${cuotaPor1000.toFixed(2)} por $1,000`;

      $('resLinea1').textContent = `Monto por cuota: $${formatNumber(cuota.toFixed(2))} (con IVA incluido)`;
      $('resLinea2').textContent = `N√∫mero de pagos: ${numPagos}. Total a pagar: $${formatNumber(total.toFixed(2))}.`;
      $('resLinea3').textContent = `Periodicidad: ${periodicidad}. Tasa del ciclo: ${ciclo.tasa}%.`;
    }

    function generarFicha(){
      const prodKey = $('producto').value;
      const prod = productos[prodKey];
      const cicloId = Number($('ciclo').value);
      const ciclo = prod.ciclos.find(c => c.id === cicloId);
      const monto = parseFloat($('monto').value);
      
      if (!monto || monto <= 0){ 
        const container = document.createElement("div");
        container.style.cssText = "padding:12px;background:#fee2e2;border-radius:8px;color:#dc2626;";
        container.textContent = "Ingrese un monto v√°lido";
        addMessage(container, false);
        return; 
      }
      
      if (monto < ciclo.min || monto > ciclo.max){ 
        const container = document.createElement("div");
        container.style.cssText = "padding:12px;background:#fee2e2;border-radius:8px;color:#dc2626;";
        container.textContent = `Monto fuera de rango. Debe estar entre $${formatNumber(ciclo.min)} y $${formatNumber(ciclo.max)}.`;
        addMessage(container, false);
        return; 
      }
      
      const periodicidad = $('periodicidad').value;
      const numPagos = Number($('numPagos').value);
      const tasaAnual = ciclo.tasa / 100;
      const aplicaIVA = true;
      const iva = 0.16;
      const diasPeriodo = diasPorPeriodicidad(periodicidad);
      
      const tasaPeriodo = ((tasaAnual * (1 + (aplicaIVA ? iva : 0))) / 360) * diasPeriodo;
      const cuota = Math.abs(PAGO(tasaPeriodo, numPagos, -monto));
      const total = cuota * numPagos;
      const cuotaPor1000 = Math.abs(PAGO(tasaPeriodo, numPagos, -1000));
      
      const container = document.createElement("div");
      container.style.cssText = "background:white;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.15);";
      
      // Contenedor exterior (el borde sutil redondeado de la card)
      const fichaWrapper = document.createElement("div");
      fichaWrapper.style.cssText = "background:white; padding:15px; border-radius:10px; border:1px solid #e0e7ff; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1); margin-top:15px;";

      // T√≠tulo con el icono de la hoja
      const tituloFicha = document.createElement("div");
      tituloFicha.innerHTML = `üìã <span style="color:#3b82f6; font-size:14px; font-family: sans-serif;">Ficha Descriptiva - ${prod.name}</span>`;
      tituloFicha.style.cssText = "margin-bottom:12px; font-weight: 500;";
      fichaWrapper.appendChild(tituloFicha);
      
      // La Tabla Estilo "Ficha de Mujer"
      const table = document.createElement("table");
      table.style.cssText = "width:100%; border-collapse: collapse; border: 2px solid #333; font-family: sans-serif; font-size: 14px;";

      // Encabezado Azul Fuerte
      const thead = document.createElement("thead");
      thead.innerHTML = `
        <tr style="background-color: #1e40af; color: white;">
          <th style="padding: 10px; border: 1px solid #333; text-align: center; width: 50%;">Campo</th>
          <th style="padding: 10px; border: 1px solid #333; text-align: center; width: 50%;">Valor</th>
        </tr>
      `;
      table.appendChild(thead);

      // Cuerpo de la tabla con l√≠neas negras marcadas
      const datosFicha = [
        ["Producto", prod.name],
        ["Ciclo", ciclo.id.toString()],
        ["Monto solicitado (por integrante)", `$${formatNumber(monto.toFixed(2))}`],
        ["Rango ciclo", `$${formatNumber(ciclo.min)} - $${formatNumber(ciclo.max)}`],
        ["Periodicidad", periodicidad.charAt(0).toUpperCase() + periodicidad.slice(1)],
        ["N√∫mero de pagos", numPagos.toString()],
        ["Tasa anual", `${ciclo.tasa}%`],
        ["Tasa periodo (con IVA)", `${(tasaPeriodo * 100).toFixed(4)}%`],
        ["Pago por $1,000", `$${cuotaPor1000.toFixed(2)}`],
        ["Monto por cuota", `$${formatNumber(cuota.toFixed(2))}`],
        ["Total a pagar", `$${formatNumber(total.toFixed(2))}`]
      ];

      const tbody = document.createElement("tbody");
      datosFicha.forEach(([campo, valor]) => {
        const tr = document.createElement("tr");
        tr.style.backgroundColor = "white";
        
        const tdCampo = document.createElement("td");
        tdCampo.textContent = campo;
        tdCampo.style.cssText = "padding: 8px; border: 1px solid #333; text-align: center; color: #4b5563;";
        
        const tdValor = document.createElement("td");
        tdValor.textContent = valor;
        tdValor.style.cssText = "padding: 8px; border: 1px solid #333; text-align: center; color: #111827;";
        
        tr.appendChild(tdCampo);
        tr.appendChild(tdValor);
        tbody.appendChild(tr);
      });

      table.appendChild(tbody);
      fichaWrapper.appendChild(table);
      
      container.appendChild(fichaWrapper);

      // Opciones despu√©s de simular
      const opcionesDiv = document.createElement("div");
      opcionesDiv.style.cssText = "margin-top:20px;padding-top:15px;border-top:2px solid #e5e7eb;";
      
      const opcionesTitulo = document.createElement("div");
      opcionesTitulo.textContent = "¬øQu√© deseas hacer ahora?";
      opcionesTitulo.style.cssText = "margin-bottom:12px;font-weight:600;color:#1e293b;";
      opcionesDiv.appendChild(opcionesTitulo);
      
      const botonesContainer = document.createElement("div");
      botonesContainer.style.cssText = "display:flex;flex-wrap:wrap;gap:10px;";
      
// Bot√≥n ver tabla completa con el nuevo estilo azul
      const btnTabla = document.createElement("button");
      btnTabla.textContent = `üìä Ver tabla completa de ${prod.name}`;
      btnTabla.style.cssText = "flex:1;min-width:200px;padding:10px 16px;background:#6495ED;color:white;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:all 0.2s;";
      
      // Efectos visuales de Hover coherentes con el azul solicitado
      btnTabla.addEventListener("mouseover", () => { 
        btnTabla.style.background = "#6495ED"; 
      });
      btnTabla.addEventListener("mouseout", () => { 
        btnTabla.style.background = "#6495ED"; 
      });
      
      btnTabla.addEventListener("click", () => { 
        mostrarTablaCompleta(prodKey); 
      });
      
      // Construcci√≥n final de la interfaz
      botonesContainer.appendChild(btnTabla);
      opcionesDiv.appendChild(botonesContainer);
      container.appendChild(opcionesDiv);

      // Agrega todo el contenedor (Ficha + Opciones) al chat
      addMessage(container, false);
    }

  function mostrarTablaCompleta(producto) {
    const tablasCompletas = {
        mixto: {
            titulo: "TABLA DE CICLOS GRUPAL MIXTO",
            headers: ["CICLO", "MIN", "MAX", "MIN D√çAS", "MAX D√çAS", "PERIODICIDAD", "TASA"],
            filas: [
                ["1", "$3,000", "$10,000", "110", "187", "Semanal/Catorcenal/Quincenal", "48%"],
                ["2", "$3,000", "$15,000", "110", "187", "Semanal/Catorcenal/Quincenal", "48%"],
                ["3", "$3,000", "$20,000", "110", "307", "Semanal/Catorcenal/Quincenal", "42%"],
                ["4", "$3,000", "$30,000", "110", "307", "Semanal/Catorcenal/Quincenal", "42%"],
                ["5", "$3,000", "$40,000", "110", "307", "Semanal/Catorcenal/Quincenal", "36%"],
                ["6", "$3,000", "$50,000", "110", "307", "Semanal/Catorcenal/Quincenal", "36%"],
                ["7", "$3,000", "$60,000", "110", "307", "Semanal/Catorcenal/Quincenal", "30%"],
                ["8", "$3,000", "$70,000 - $100,000", "110", "307", "Semanal/Catorcenal/Quincenal", "30%"]
            ]
        },
        consumo: {
            titulo: "TABLA DE CICLOS CONSUMO AVANCE",
            headers: ["CICLO", "MIN", "MAX", "MIN D√çAS", "MAX D√çAS", "PERIODICIDAD", "TASA"],
            filas: [
                ["1", "$3,000", "$10,000", "110", "187", "Semanal/Catorcenal/Quincenal", "48%"],
                ["2", "$3,000", "$15,000", "110", "187", "Semanal/Catorcenal/Quincenal", "48%"],
                ["3", "$3,000", "$20,000", "110", "307", "Semanal/Catorcenal/Quincenal", "42%"],
                ["4", "$3,000", "$30,000", "110", "307", "Semanal/Catorcenal/Quincenal", "42%"],
                ["5", "$3,000", "$40,000", "110", "307", "Semanal/Catorcenal/Quincenal", "36%"],
                ["6", "$3,000", "$50,000", "110", "307", "Semanal/Catorcenal/Quincenal", "36%"],
                ["7", "$3,000", "$60,000", "110", "307", "Semanal/Catorcenal/Quincenal", "30%"],
                ["8", "$3,000", "$70,000 - $100,000", "110", "307", "Semanal/Catorcenal/Quincenal", "30%"]
            ]
        },
        impulso: {
            titulo: "TABLA DE CICLOS IMPULSO SOLIDARIO",
            headers: ["CICLO", "MIN", "MAX", "PLAZO", "PERIODICIDAD", "TASA"],
            filas: [
                ["1", "$3,000", "$10,000", "4 MESES", "Semanal/Catorcenal/Quincenal", "48%"],
                ["2", "$3,000", "$15,000", "4 MESES", "Semanal/Catorcenal/Quincenal", "48%"],
                ["3", "$3,000", "$20,000", "4 MESES", "Semanal/Catorcenal/Quincenal", "48%"],
                ["4", "$3,000", "$30,000", "12 MESES", "Semanal/Catorcenal/Quincenal", "36%"],
                ["5", "$3,000", "$40,000", "12 MESES", "Semanal/Catorcenal/Quincenal", "36%"],
                ["6", "$3,000", "$50,000", "12 MESES", "Semanal/Catorcenal/Quincenal", "36%"],
                ["7", "$3,000", "$60,000", "12 MESES", "Semanal/Catorcenal/Quincenal", "36%"],
                ["8", "$3,000", "$70,000", "12 MESES", "Semanal/Catorcenal/Quincenal", "36%"],
                ["9", "$3,000", "$80,000", "12 MESES", "Semanal/Catorcenal/Quincenal", "36%"],
                ["10", "$3,000", "$90,000", "12 MESES", "Semanal/Catorcenal/Quincenal", "36%"],
                ["11", "$3,000", "$100,000", "12 MESES", "Semanal/Catorcenal/Quincenal", "36%"]
            ]
        },
        poder: {
            titulo: "TABLA DE CICLOS PODER DE MUJER",
            headers: ["CICLO", "MIN", "MAX", "MIN D√çAS", "MAX D√çAS", "PERIODICIDAD", "TASA"],
            filas: [
                ["1", "$3,000", "$10,000", "110", "187", "Semanal/Catorcenal/Quincenal", "42%"],
                ["2", "$3,000", "$15,000", "110", "187", "Semanal/Catorcenal/Quincenal", "42%"],
                ["3", "$3,000", "$20,000", "110", "307", "Semanal/Catorcenal/Quincenal", "36%"],
                ["4", "$3,000", "$30,000", "110", "307", "Semanal/Catorcenal/Quincenal", "36%"],
                ["5", "$3,000", "$40,000", "110", "307", "Semanal/Catorcenal/Quincenal", "33%"],
                ["6", "$3,000", "$50,000", "110", "307", "Semanal/Catorcenal/Quincenal", "33%"],
                ["7", "$3,000", "$60,000", "110", "307", "Semanal/Catorcenal/Quincenal", "30%"],
                ["8", "$3,000", "$70,000 - $100,000", "110", "307", "Semanal/Catorcenal/Quincenal", "30%"]
            ]
        },
        preferente: {
            titulo: "TABLA DE CICLOS GRUPAL PREFERENTE",
            headers: ["CICLO", "MIN", "MAX", "MIN D√çAS", "MAX D√çAS", "PERIODICIDAD", "TASA"],
            filas: [
                ["1", "$3,000", "$20,000", "110", "115", "Semanal", "24%"],
                ["2", "$3,000", "$25,000", "110", "115", "Semanal", "24%"],
                ["3", "$3,000", "$30,000", "110", "171", "Semanal", "24%"],
                ["4", "$3,000", "$40,000", "110", "171", "Semanal/Catorcenal/Quincenal", "24%"],
                ["5", "$3,000", "$50,000", "110", "307", "Semanal/Catorcenal/Quincenal", "24%"],
                ["6", "$3,000", "$55,000", "110", "307", "Semanal/Catorcenal/Quincenal", "24%"],
                ["7", "$3,000", "$60,000", "110", "307", "Semanal/Catorcenal/Quincenal", "24%"],
                ["8", "$3,000", "$70,000 - $100,000", "110", "307", "Semanal/Catorcenal/Quincenal", "24%"]
            ]
        }
    };

    const tablaData = tablasCompletas[producto];
    if (!tablaData) return;

    // --- DISE√ëO VISUAL ---
    const wrapper = document.createElement("div");
    wrapper.style.cssText = "background-color: #e3f2fd; padding: 20px; border-radius: 12px; font-family: sans-serif; border: 1px solid #bbdefb;";

    const tituloDoc = document.createElement("div");
    tituloDoc.textContent = tablaData.titulo;
    tituloDoc.style.cssText = "color: #1e40af; font-weight: bold; font-size: 16px; margin-bottom: 15px; text-transform: uppercase;";
    wrapper.appendChild(tituloDoc);

    const table = document.createElement("table");
    table.style.cssText = "width: 100%; border-collapse: collapse; border: 1.5px solid #000; background-color: #fff; font-size: 12px;";

    // Header Azul Fuerte con texto blanco (Estilo Imagen 3)
    const thead = document.createElement("thead");
    const headerRow = document.createElement("tr");
    headerRow.style.backgroundColor = "#1e40af";

    tablaData.headers.forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        th.style.cssText = "color: white; padding: 12px 5px; border: 1px solid #000; font-weight: bold; text-align: center;";
        headerRow.appendChild(th);
    });
    thead.appendChild(headerRow);
    table.appendChild(thead);

    // Cuerpo con bordes negros marcados
    const tbody = document.createElement("tbody");
    tablaData.filas.forEach(fila => {
        const tr = document.createElement("tr");
        fila.forEach(celda => {
            const td = document.createElement("td");
            td.textContent = celda;
            td.style.cssText = "padding: 10px 5px; border: 1px solid #000; text-align: center; color: #000; font-weight: 500;";
            tr.appendChild(td);
        });
        tbody.appendChild(tr);
    });
    table.appendChild(tbody);

    wrapper.appendChild(table);
    addMessage(wrapper, false);
}
    async function onConfigChange(config) {
      const baseSize = config.font_size || defaultConfig.font_size;
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'Tahoma, Geneva, Verdana, sans-serif';

      // Apply colors
      const header = document.getElementById("chatHeader");
      header.style.background = `linear-gradient(135deg, ${config.background_color || defaultConfig.background_color}, ${config.primary_action_color || defaultConfig.primary_action_color})`;

      const chatMessages = document.getElementById("chatMessages");
      chatMessages.style.background = config.secondary_surface_color || defaultConfig.secondary_surface_color;

      const userMessages = document.querySelectorAll(".user-message");
      userMessages.forEach(msg => {
        msg.style.background = config.primary_action_color || defaultConfig.primary_action_color;
      });

      const botMessages = document.querySelectorAll(".bot-message");
      botMessages.forEach(msg => {
        msg.style.background = config.secondary_action_color || defaultConfig.secondary_action_color;
        msg.style.borderColor = config.secondary_surface_color || defaultConfig.secondary_surface_color;
        msg.style.color = config.text_color || defaultConfig.text_color;

	// üëá AGREGA ESTO
  msg.style.maxWidth = "100%";
  msg.style.width = "100%";
});
 
      const sendBtn = document.getElementById("sendBtn");
      sendBtn.style.background = config.primary_action_color || defaultConfig.primary_action_color;

      const input = document.getElementById("messageInput");
      input.style.color = config.text_color || defaultConfig.text_color;

      // Apply fonts
      document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
      document.body.style.fontSize = `${baseSize}px`;

      const title = document.getElementById("chatTitle");
      title.style.fontSize = `${baseSize * 1.5}px`;
      title.textContent = config.chat_title || defaultConfig.chat_title;

      const subtitle = document.getElementById("chatSubtitle");
      subtitle.style.fontSize = `${baseSize * 0.9375}px`;
      subtitle.textContent = config.chat_subtitle || defaultConfig.chat_subtitle;

      const headerMessage = document.getElementById("headerMessage");
      headerMessage.style.fontSize = `${baseSize * 0.9375}px`;
      headerMessage.textContent = config.header_message || defaultConfig.header_message;

      const footerText = document.getElementById("footerText");
      footerText.style.fontSize = `${baseSize * 0.875}px`;
      footerText.textContent = config.footer_text || defaultConfig.footer_text;

      input.placeholder = config.input_placeholder || defaultConfig.input_placeholder;

      sendBtn.style.fontSize = `${baseSize * 0.9375}px`;
    }


    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.secondary_surface_color || defaultConfig.secondary_surface_color,
              set: (value) => {
                config.secondary_surface_color = value;
                window.elementSdk.setConfig({ secondary_surface_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.primary_action_color || defaultConfig.primary_action_color,
              set: (value) => {
                config.primary_action_color = value;
                window.elementSdk.setConfig({ primary_action_color: value });
              }
            },
            {
              get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
              set: (value) => {
                config.secondary_action_color = value;
                window.elementSdk.setConfig({ secondary_action_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ["chat_title", config.chat_title || defaultConfig.chat_title],
          ["chat_subtitle", config.chat_subtitle || defaultConfig.chat_subtitle],
          ["header_message", config.header_message || defaultConfig.header_message],
          ["footer_text", config.footer_text || defaultConfig.footer_text],
          ["input_placeholder", config.input_placeholder || defaultConfig.input_placeholder]
        ])
      });
    }
  </script>
 <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-app.js";
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/10.0.0/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAA8pgcb4RWWcA7stNmqnrAgfpgTZnlo_c",
      authDomain: "chat-solidario.firebaseapp.com",
      projectId: "chat-solidario",
      storageBucket: "chat-solidario.firebasestorage.app",
      messagingSenderId: "135166703419",
      appId: "1:135166703419:web:a68dd015787ee60894a91e"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    // CONTROL DE ACCESO
    onAuthStateChanged(auth, (user) => {
      if (user) {
        document.getElementById('pantalla-login').style.display = 'none';
        document.getElementById('contenido-pwa').style.display = 'block';
      } else {
        document.getElementById('pantalla-login').style.display = 'flex';
        document.getElementById('contenido-pwa').style.display = 'none';
      }
    });

    // BOT√ìN LOGUEAR
    document.getElementById('btnEntrar').onclick = () => {
      const email = document.getElementById('loginEmail').value;
      const pass = document.getElementById('loginPass').value;
      signInWithEmailAndPassword(auth, email, pass).catch(err => alert("Acceso denegado"));
    };

    // BOT√ìN SALIR
    document.getElementById('btnSalir').onclick = () => signOut(auth);
  </script>

  <script>
    if ("serviceWorker" in navigator) {
      navigator.serviceWorker.register("/ACREIMEX-CHAT/service-worker.js")
      .then(reg => console.log("SW cargado con √©xito"));
    }
  </script>
<script>
if ("serviceWorker" in navigator) {
  navigator.serviceWorker.register("/ACREIMEX-CHAT/service-worker.js")
    .then(registration => {

      registration.onupdatefound = () => {
        const newWorker = registration.installing;

        newWorker.onstatechange = () => {
          if (newWorker.state === "installed" && navigator.serviceWorker.controller) {

            const updateBanner = document.createElement("div");
            updateBanner.innerHTML = `
              <div style="
                position: fixed;
                bottom: 20px;
                left: 50%;
                transform: translateX(-50%);
                background: #0f172a;
                color: white;
                padding: 15px 20px;
                border-radius: 12px;
                box-shadow: 0 5px 20px rgba(0,0,0,0.3);
                z-index: 9999;
                font-family: sans-serif;
              ">
                üîÑ Nueva versi√≥n disponible
                <button id="updateBtn" style="
                  margin-left: 15px;
                  padding: 6px 12px;
                  border: none;
                  background: #22c55e;
                  color: white;
                  border-radius: 8px;
                  cursor: pointer;
                ">Actualizar</button>
              </div>
            `;
            document.body.appendChild(updateBanner);

            document.getElementById("updateBtn").addEventListener("click", () => {
              window.location.reload();
            });
          }
        };
      };
    });
}
</script>
</body>
</html>