<!doctype html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <link rel="manifest" href="manifest.json">
  <link rel="icon" href="icon-192.png">
  <meta name="theme-color" content="#ff6b35">
  <title>Chatbot Koco Acreimex </title>

  <!-- STYLES -->
  <style>
    :root {
      --primary: #1e40af;
      --accent: #2563eb;
      --muted: #64748b;
      --bg: #f8f9fa;
      --card-bg: #fff;
    }
    body {
      box-sizing: border-box;
      margin: 0;
      padding: 20px;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: linear-gradient(135deg, #1e40af 0%, #2563eb 100%);
      color: #333;
      min-height: 100vh;
    }
   
    .wrap { max-width: 1100px; margin: 0 auto; }

    ..chat-container {
  background: var(--card-bg);
  border-radius: 15px;
  box-shadow: 0 10px 30px rgba(0,0,0,0.2);
  overflow: hidden;
  display: grid;
  grid-template-columns: 1fr;
  gap: 0;
}

    .chat-header {
      background: linear-gradient(135deg, var(--primary), var(--accent));
      color: white;
      padding: 18px 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .chat-header h1 { margin: 0; font-size: 20px; font-weight: 600; }
    .chat-header p { margin: 0; font-size: 13px; opacity: 0.95; }

    .chat-messages {
      height: 420px;
      overflow-y: auto;
      padding: 18px;
      background: #f8f9fa;
    }

    .message {
      margin-bottom: 14px;
      padding: 12px 16px;
      border-radius: 14px;
      max-width: 78%;
      animation: fadeIn 0.2s ease-in;
      line-height: 1.4;
    }
    .bot-message { background: #e3f2fd; border: 1px solid #bbdefb; margin-right: auto; }
    .user-message { background: #0a84f0; color: white; margin-left: auto; text-align: right; }

    .chat-input-container {
      padding: 16px;
      background: white;
      border-top: 1px solid #e0e0e0;
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .chat-input { flex:1; padding:12px 16px; border-radius: 25px; border: 2px solid #e0e0e0; font-size: 15px; outline:none; }
    .chat-input:focus { border-color: var(--primary); }

    .send-btn {
      background: var(--primary);
      color: white;
      border: none;
      border-radius: 10px;
      padding: 10px 14px;
      cursor: pointer;
      font-weight: 700;
    }
    
    .footer { background: #f8fafc; color: var(--muted); text-align:center; padding:10px; font-size:12px; border-top:1px solid #e2e8f0; }

    /* Modal */
    .modal { display:none; position: fixed; z-index: 1200; left:0; top:0; width:100%; height:100%; background: rgba(0,0,0,0.45); }
    .modal-content { background:#fff; margin: 5% auto; padding:0; border-radius:10px; width:92%; max-width: 900px; max-height:80%; overflow-y:auto; box-shadow:0 10px 40px rgba(0,0,0,.35); }
    .modal-header { background: var(--primary); color:white; padding:16px; border-radius:10px 10px 0 0; position:relative; }
    .modal-header h2 { margin:0; font-size:18px; }
    .close { position:absolute; right:18px; top:50%; transform:translateY(-50%); color:white; font-size:26px; cursor:pointer; }

    .modal-body { padding:16px; line-height:1.5; color:#25303b; }

    .button-group { display:flex; gap:10px; flex-wrap:wrap; margin:12px 0; }
    .info-button { background: var(--primary); color:white; border:none; padding:10px 16px; border-radius:6px; cursor:pointer; }

    .table-container{ overflow-x:auto; margin:10px 0; }
    table{ width:100%; border-collapse:collapse; margin-bottom:12px; }
    th,td{ border:1px solid #e6eef8; padding:10px; text-align:center; }
    th{ background:var(--primary); color:white; }

    @keyframes fadeIn { from {opacity:0; transform:translateY(6px);} to {opacity:1; transform:none;} }


    /* Calculator styles inside modal */
    .calc-grid { display:grid; grid-template-columns: 1fr 1fr; gap:12px; }
    .calc-card { background:#fff; padding:12px; border-radius:8px; border:1px solid #eef4ff; }
    .calc-row { margin-bottom:10px; }
    .calc-row label{ display:block; font-weight:600; margin-bottom:6px; font-size:13px; }
    .calc-row input, .calc-row select { width:100%; padding:8px; border-radius:6px; border:1px solid #dbe6ff; }
    .result-box { background:#f0f7ff; padding:10px; border-radius:8px; border-left:4px solid var(--primary); margin-top:8px; }
    .note { background:#fff3cd; border:1px solid #ffeaa7; padding:10px; border-radius:6px; margin-top:10px; }
    @media (max-width:980px){
      .chat-container{ grid-template-columns: 1fr; }
      .right-pane{ order:;}
    }
 </style>
  <style>@view-transition { navigation: auto; }</style>
  <script src="/_sdk/data_sdk.js" type="text/javascript"></script>
  <script src="https://cdn.tailwindcss.com" type="text/javascript"></script>
 </head>
 <body>
  <div class="wrap">
    <div class="chat-container" role="application" aria-label="Asistente Cr√©ditos Solidarios - Koco">
      <div class="left-pane">
        <div class="chat-header">
          <div>
            <h1 id="company-title">Asistente de la Coordinaci√≥n de cr√©ditos solidarios</h1>
            <p id="company-sub">KOCO SOLIDARIO</p>
          </div>
          <div style="text-align:right;min-width:150px"><big id="footer-message-small">üíñü§ù Tu trabajo abre oportunidades donde antes solo hab√≠a sue√±os. üå±üí´</big></div>
        </div>

        <div class="chat-messages" id="chatMessages" aria-live="polite"></div>

        <div class="chat-input-container">
          <input id="messageInput" class="chat-input" type="text" placeholder="Escribe tu pregunta..." maxlength="500" aria-label="Escribe tu consulta">
          <button id="sendBtn" class="send-btn" type="button" aria-label="Enviar mensaje">‚û§</button>
        </div>

        <div class="footer">Informaci√≥n actualizada y confiable ‚Ä¢ TU AMIGO SOLIDARIO</div>
      </div>
  <script>
    const defaultConfig = {
      background_color: "#0052CC",
      secondary_surface_color: "#FFFFFF",
      text_color: "#1f2937",
      primary_action_color: "#0052CC",
      secondary_action_color: "#E6F2FF",
      font_family: "Segoe UI",
      font_size: 16,
      chat_title: "Asistente de la Coordinaci√≥n de cr√©ditos solidarios",
      chat_subtitle: "Grupal ‚Äî TU AMIGO SOLIDARIO",
      header_message: "üíñü§ù Tu trabajo abre oportunidades donde antes solo hab√≠a sue√±os. üå±üí´",
      footer_text: "Informaci√≥n actualizada y confiable ‚Ä¢ TU AMIGO SOLIDARIO",
      input_placeholder: "Escribe tu pregunta..."
    };

    const keywords = {
      ingresos: ['ingresos','comprobantes','ventas','evidencias','flujo','utilidad','actualizaci√≥n','actualizacion','estado de resultados','ganancias','facturaci√≥n','corte de caja','ingreso mensual','ingreso semanal','capacidad de pago','balance','movimientos','soporte de ingresos','actividad econ√≥mica','ventas diarias','registro de ventas','flujo de efectivo','utilidades netas','comprobaci√≥n'],
      igualacion: ['igualacion','igualaci√≥n','montos','nivelar','ajuste','correspondencia','equiparar','homologar','balancear','regular','redistribuir','adecuaci√≥n','alinear montos','ajuste de cr√©dito','nivelaci√≥n','equilibrar','igualar','actualizar montos','asignaci√≥n','asignaci√≥n de ciclo','monto por ciclo','ajuste grupal','asignacion de ciclo','monto similar','monto equivalente','recalcular','monto trabajado'],
      domicilio: ['vivienda','rentado','domicilio familiar','domicilio propio','vivienda rentada o prestada','domicilio prestado','identificar','rentada','diferenciar'],
      renovacion: ['renovaci√≥n','renovacion','anticipada','reactivar','renovar cr√©dito','nuevo ciclo','continuidad','siguiente cr√©dito','refinanciar','reenganche','renovaci√≥n grupal','renovaci√≥n individual','cr√©dito recurrente','nuevo pr√©stamo','recredito','reapertura','renovaci√≥n anticipada','extensi√≥n de cr√©dito','seguimiento','historial vigente','cr√©dito activo','recontrataci√≥n','nuevo desembolso','revisi√≥n de cr√©dito'],
      montos: ['70000','mayor a 70000','superiores a 70000','monto superior','monto mayor','monto m√°ximo','monto autorizado','monto permitido','monto solicitado','monto aprobado','monto total','incremento de monto','incremento hasta 100000','tope de cr√©dito','l√≠mite de cr√©dito','l√≠mite m√°ximo','capacidad m√°xima','cr√©dito alto','capital','importe','cantidad','valor del cr√©dito','nivel de cr√©dito','rango de cr√©dito'],
      adicional: ['adicional','extra','complementario','programa','cr√©dito adicional','segundo cr√©dito','cr√©dito paralelo','cr√©dito extra','financiamiento adicional','monto adicional','apoyo extra','cr√©dito complementario','extensi√≥n','refuerzo financiero','capital adicional','ampliaci√≥n','nuevo apoyo','cr√©dito alterno','adicional grupal','cr√©dito secundario','incremento adicional','l√≠nea adicional','financiamiento extra','apoyo econ√≥mico','monto complementario'],
      coordinacion: ['producto','productos','mixto','cr√©dito mixto','poder mujer','mujer','cr√©dito mujer','preferente','cr√©dito preferente','consumo','cr√©dito de consumo','simulador','simular','simulaci√≥n','tabla','plan','esquema','modalidad','tipo de cr√©dito','segmento','clasificaci√≥n','configuraci√≥n','condiciones','par√°metros','estructura','programa','pol√≠tica'],
      nuevos: ['nuevos','grupo','nuevo grupo','integrantes nuevos','alta de grupo','formaci√≥n de grupo','grupo nuevo','primer cr√©dito','garantia','nuevo ingreso','alta','registro de grupo','cobertura de cr√©dito','grupo solidario','integraci√≥n','requisitos de grupo','grupo inicial','creaci√≥n de grupo','nuevo ciclo','primer desembolso','seguro de cr√©dito','grupo reciente','socios nuevos','nuevo financiamiento'],
      sucursal: ['sucursal','cambio','traslado','movimiento','reubicaci√≥n','cambio de sucursal','transferencia','reasignaci√≥n','oficina','agencia','punto de atenci√≥n','dependencia','gesti√≥n en sucursal','cambio operativo','sucursal origen','sucursal destino','atenci√≥n','ubicaci√≥n','oficina regional','gesti√≥n local','movimiento de expediente','cambio administrativo','reasignar','nueva sucursal'],
      multas: ['multas','penalizaciones','recargos','sanciones','castigo','mora','intereses moratorios','cargo','penalidad','incumplimiento','atraso','falta de pago','multa por atraso','recargo por mora','sanci√≥n econ√≥mica','adeudo','deuda','intereses','cargo adicional','castigo financiero','penalizaci√≥n por atraso','omisi√≥n','mora crediticia'],
      expedientes: ['expediente','nuevo expediente','crear expediente','registro','archivo','documentaci√≥n','carpeta','expediente grupal','expediente individual','alta de expediente','integraci√≥n','documentos','requisitos','control documental','archivo digital','validaci√≥n','revisi√≥n de expediente','apertura de expediente','carga documental','fotograf√≠a grupal','expediente de cr√©dito'],
      generalidades: ['fuera de sucursal','campo','desembolso','desemboloso en campo','entrega en campo','campo'],
      comprobante: ['recibo','cfe','predial','comprobante de domicilio','direccion','direcci√≥n','hogar','casa','residencia','luz','fachada','evidencia fotografica'],
      adulto: ['mayor de 70 a√±os','mayores de 70 a√±os','adulto mayor','adultos mayores','3ra edad','tersera edad','tercera edad','edad avanzada','persona grande','personas grandes','abuelito','abuelita','mayor de 70','arriba de 70 a√±os','superan los 70','rebasan los 70'],
      incremento: ['incremento','socios antiguos','historial','sin cr√©dito vigente','inactivos','reactivaci√≥n','cliente antiguo','buen historial','historial positivo','socios acreimex','clientes recurrentes','reactivar socio','nuevo cr√©dito','incremento por historial','historial de pagos','clientes inactivos','reincorporaci√≥n','regreso a cr√©dito','evaluaci√≥n hist√≥rica','monto previo','capacidad de pago'],
      saldos: ['saldos','insolutos','renovaci√≥n de saldos','capital pendiente','saldo capital','adeudo','cr√©dito vencido','cr√©dito en atraso','regularizaci√≥n','saldos vencidos','renovar saldo','liquidaci√≥n parcial','capital insoluto','pago pendiente','saldo grupal','saldo adicional','restructura','reprogramaci√≥n','intenci√≥n de pago'],
recurso: ['comprobaci√≥n','aplicaci√≥n','comprobacion','aplicacion','recurso','comprobar'],
      impulso: ['impulso','solidario','nuevo producto'],
      si: ['si','s√≠','claro','por supuesto','adelante','ok','vale'],
      no: ['no','nope','negativo','no gracias','paso']
    };

    const farewellKeywords = ["adios","adi√≥s","bye","hasta luego","gracias","chao","es todo"];
    
    let conversationContext = null;

    function addMessage(content, isUser = false) {
      const messagesContainer = document.getElementById("chatMessages");
      const messageDiv = document.createElement("div");
      messageDiv.className = "message " + (isUser ? "user-message" : "bot-message");
      
      if (typeof content === 'string') {
        messageDiv.textContent = content;
      } else {
        messageDiv.appendChild(content);
      }
      
      messagesContainer.appendChild(messageDiv);
      messagesContainer.scrollTop = messagesContainer.scrollHeight;
    }

    function createTable(headers, rows) {
      const table = document.createElement("table");
      const thead = document.createElement("thead");
      const headerRow = document.createElement("tr");
      
      headers.forEach(h => {
        const th = document.createElement("th");
        th.textContent = h;
        headerRow.appendChild(th);
      });
      thead.appendChild(headerRow);
      table.appendChild(thead);
      
      const tbody = document.createElement("tbody");
      rows.forEach(rowData => {
        const tr = document.createElement("tr");
        rowData.forEach(cellData => {
          const td = document.createElement("td");
          td.textContent = cellData;
          tr.appendChild(td);
        });
        tbody.appendChild(tr);
      });
      table.appendChild(tbody);
      
      return table;
    }

    function includesKeyword(message, list) {
      return list.some(kw => message.includes(kw));
    }

    function getResponse(input) {
      const lower = input.toLowerCase().trim();
      
      // Manejar respuestas SI/NO seg√∫n el contexto
      if (conversationContext && includesKeyword(lower, keywords.si)) {
        if (conversationContext === 'impulso_pregunta') {
          conversationContext = null;
          const container = document.createElement("div");
          const title = document.createElement("strong");
          title.textContent = "POL√çTICAS DEL CR√âDITO IMPULSO SOLIDARIO ACR";
          container.appendChild(title);
          container.appendChild(document.createElement("br"));
          container.appendChild(document.createElement("br"));
          
          const list = document.createElement("ol");
          list.style.lineHeight = "1.9";
          list.style.marginLeft = "20px";
          
          const items = [
            "<strong>Historial grupal o captaci√≥n:</strong> Contar con historial grupal en Cooperativa Acreimex o que los socios hayan sido captados a trav√©s de una pl√°tica informativa para cr√©dito en modalidad de grupo.",
            
            "<strong>Nivel de riesgo:</strong> √önicamente se podr√° otorgar a socios clasificados con nivel de riesgo <mark>bajo o medio</mark> de acuerdo con el an√°lisis del reporte de la Sociedad de Informaci√≥n Crediticia (SIC).",
            
            "<strong>Socios sin historial grupal:</strong> Para socios sin historial grupal en Cooperativa Acreimex el tipo de vivienda deber√° ser <mark>propio o familiar</mark>.",
            
            "<strong>Socios con historial (m√≠nimo 3 cr√©ditos pagados):</strong> Para socios con historial en Cooperativa Acreimex con un m√≠nimo de <mark>3 cr√©ditos pagados</mark> en modalidad grupal y que, de acuerdo con las necesidades del socio, requiera un plazo o monto superior al otorgado en el cr√©dito grupal o que por situaciones internas del grupo no se cuente con el m√≠nimo de los 3 integrantes requeridos en la mesa directiva, debiendo cumplir con lo siguiente:<br>‚Ä¢ <strong>a)</strong> No haber reflejado atrasos de m√°s de 1 cuota en su √∫ltimo cr√©dito grupal.<br>‚Ä¢ <strong>b)</strong> Firma de un <mark>aval</mark>, no deber√° ser familiar del acreditado ni compartir el mismo domicilio.",
            
            "<strong>Tasa para socios con historial:</strong> Para socios con historial en Cooperativa Acreimex la tasa de inter√©s ser√° con relaci√≥n al monto solicitado.",
            
            "<strong>Socios prospectados sin historial:</strong> Socios sin historial grupal en Cooperativa Acreimex que hayan sido prospectados por el asesor de cr√©ditos con la intenci√≥n de solicitar un cr√©dito en modalidad grupal y que de acuerdo con el an√°lisis realizado a todos los integrantes no se haya podido formalizar la solicitud, deber√° cumplir con lo siguiente:<br>‚Ä¢ <strong>a)</strong> El cr√©dito se podr√° otorgar a un m√≠nimo de <mark>dos</mark> y hasta <mark>cuatro socios</mark> los cuales deber√°n ser obligados solidarios entre s√≠.<br>‚Ä¢ <strong>b)</strong> Los plazos, periodicidad y d√≠a de pago deber√°n ser los mismos para ambos acreditados.<br>‚Ä¢ <strong>c)</strong> Los montos para otorgar ser√°n de acuerdo con la tabla de ciclos del producto y deber√°n ser otorgados con el mismo plazo y periodicidad de su origen.",
            
            "<strong>Tasa para socios sin historial:</strong> Para socios sin historial grupal en Cooperativa Acreimex la tasa de inter√©s ser√° con base a la tabla de ciclos del producto."
          ];
          
          items.forEach(item => {
            const li = document.createElement("li");
            li.innerHTML = item;
            li.style.marginBottom = "12px";
            list.appendChild(li);
          });
          
          container.appendChild(list);
          
          const note = document.createElement("div");
          note.style.marginTop = "15px";
          note.style.padding = "12px";
          note.style.background = "#d1ecf1";
          note.style.borderRadius = "6px";
          note.style.fontSize = "13px";
          note.innerHTML = "<strong>Importante:</strong> Impulso Solidario.";
          container.appendChild(note);
          
          return { type: 'html', content: container };
        }
      }
      
      if (conversationContext && includesKeyword(lower, keywords.no)) {
        conversationContext = null;
        return { type: 'text', content: "¬øHay algo m√°s en lo que te pueda servir? üòä" };
      }
      
      if (farewellKeywords.some(kw => lower === kw || lower.includes(kw))) {
        const h = new Date().getHours();
        const morning = ["üòä Gracias por comunicarte con Koco. ¬°Que tengas un excelente d√≠a! ü§ù","üåÖ Fue un gusto ayudarte ‚Äî que tu ma√±ana sea productiva.","‚òÄÔ∏è Gracias por usar Cr√©ditos Solidarios. ¬°√âxito en tu d√≠a!"];
        const afternoon = ["‚òÄÔ∏è Fue un gusto apoyarte, ¬°te deseo una tarde productiva!","‚òÄÔ∏è Gracias por comunicarte con Koco. ¬°Que tengas una excelente tarde! ü§ù","ü´∂ Gracias por tu tiempo ‚Äî que la tarde te sea favorable."];
        const night = ["üåô Descansa, gracias por confiar en Cr√©ditos Solidarios.","üåü Que tengas buenas noches ‚Äî Koco siempre est√° para ayudarte.","üò¥ Gracias por comunicarte. ¬°Hasta pronto y buenas noches!"];
        let messages;
        if (h >= 6 && h < 12) messages = morning;
        else if (h >= 12 && h < 18) messages = afternoon;
        else messages = night;
        return { type: 'text', content: messages[Math.floor(Math.random() * messages.length)] };
      }

     // Detectar pregunta sobre Impulso Solidario
const impulsoDirecto = lower.includes('impulso') && lower.includes('solidario');
const esCalculadora = lower.includes('calculadora') || lower.includes('simular');

if (impulsoDirecto && !esCalculadora) {
  conversationContext = 'impulso_pregunta';

  const container = document.createElement("div");

  // Descripci√≥n del producto
  const intro = document.createElement("div");
  intro.innerHTML = `
    <strong>El producto IMPULSO SOLIDARIO ACR</strong> est√° dise√±ado para socios con historial grupal en
    la cooperativa y socios nuevos clasificados con nivel de riesgo bajo o medio que
    provengan de una pl√°tica informativa para cr√©dito en modalidad grupal, de la cual
    no se haya podido formalizar la solicitud debido a que algunos prospectos no clasificaron
    para el cr√©dito (no sujetos o riesgo alto).
  `;
  intro.style.marginBottom = "15px";
  intro.style.lineHeight = "1.6";
  container.appendChild(intro);

  // T√≠tulo
  const title = document.createElement("strong");
  title.textContent =
    "1. ¬øEn qu√© supuestos le podemos realizar tr√°mite con este producto a un socio con historial grupal en la cooperativa?";
  container.appendChild(title);
  container.appendChild(document.createElement("br"));
  container.appendChild(document.createElement("br"));

  // Lista
  const list = document.createElement("ol");
  list.style.lineHeight = "1.9";
  list.style.marginLeft = "20px";

 const items = [
            `<strong>SOCIOS CON HISTORIAL GRUPAL EN ACR:</strong><br>
            ‚Ä¢ Se puede ofertar a socios de grupos que se desintegran y que no completan los 3 integrantes de la mesa directiva, es decir: <strong>Cuando √∫nicamente quedan 2 integrantes y no logran conseguir a m√°s integrantes o estos no clasifican para el cr√©dito</strong>.<br>
            ‚Ä¢ Cuando un socio pide salirse de su grupo por conflictos internos o para solicitar un cr√©dito con un monto o plazo mayor, siempre y cuando no se rebasen los 12 meses y los $100,000.00.<br>
            <mark>Objetivo principal:</em> Que nosotros les sigamos otorgando el financiamiento para <strong>que tu cartera de cr√©dito no
pierda valor y socios</strong> por grupos desintegrados o por salidas de socios que quieren tener
su propio cr√©dito por un plazo o monto mayor.</mark>`,

            `<strong>SOCIOS NUEVOS:</strong><br>
            ‚Ä¢ Se puede otorgar a personas que estaban interesadas en formar un cr√©dito grupal, pero <strong>que no lograron formalizar debido a que algunos interesados no pasaron el filtro de la consulta de bur√≥ de cr√©dito</strong>.<br>
            ‚Ä¢ <strong>Aplica</strong> cuando </strong>√∫nicamente 4 prospectos o menos</strong> son considerados sujetos de cr√©dito con nivel de riesgo bajo o medio.<br>
            ‚Ä¢ En casos en los que 5 prospectos o m√°s pasan el filtro como sujetos a cr√©dito con nivel de riesgo bajo o medio, <strong>el tr√°mite se debe realizar con un producto en modalidad grupal</strong>.<br>
            <mark>Objetivo principal:</em> Que de las pl√°ticas informativas que realices <strong>en las que no se hayan completado los 
integrantes</strong> para formar su grupo,<strong> tengas la oportunidad de otorgarle cr√©dito a los
prospectos que si pasaron el filtro de bur√≥ de cr√©dito y de esta manera crecer√°s el
valor de tu cartera y socios administrados para que llegues a tus metas e
incentivos.</strong></mark>`
        ];

  items.forEach(item => {
    const li = document.createElement("li");
    li.innerHTML = item;
    li.style.marginBottom = "12px";
    list.appendChild(li);
  });

  container.appendChild(list);

  // Pregunta final
  const question = document.createElement("div");
  question.textContent = "¬øDeseas conocer las pol√≠ticas para acceder a este cr√©dito?";
  question.style.fontWeight = "600";
  question.style.color = "#1e40af";
  question.style.marginTop = "10px";
  container.appendChild(question);

  return { type: 'html', content: container };
}

      // Todas las respuestas del chatbot
      if (keywords.ingresos.some(kw => lower.includes(kw))) {
        const container = document.createElement("div");
        const title = document.createElement("strong");
        title.textContent = "COMPROBANTE DE INGRESOS";
        container.appendChild(title);
        container.appendChild(document.createElement("br"));
        container.appendChild(document.createElement("br"));
        
        const subtitle1 = document.createElement("h3");
        subtitle1.textContent = "1. Supuestos de actualizaci√≥n del comprobante de ingresos:";
        subtitle1.style.fontSize = "16px";
        subtitle1.style.marginTop = "10px";
        subtitle1.style.marginBottom = "10px";
        subtitle1.style.fontWeight = "600";
        container.appendChild(subtitle1);
        
        const list1 = document.createElement("ol");
        list1.type = "a";
        list1.style.lineHeight = "1.8";
        list1.style.marginLeft = "20px";
        
        const items1 = [
          "a) Se deber√°n actualizar las evidencias siempre y cuando las deudas en el an√°lisis del SIC tengan un aumento mayor al 25 % de las deudas reportadas en el ciclo que finaliza (del mismo tipo de cr√©dito).",
          "b) Cuando el monto a solicitar rebase los $5,000.00 de aumento en comparaci√≥n con el monto m√°ximo otorgado por la cooperativa en cr√©dito grupal.",
          "c) Se deben actualizar cada a√±o a partir de fecha atestada por el asesor o el personal operativo."
        ];
        
        items1.forEach(item => {
          const li = document.createElement("li");
          li.textContent = item;
          list1.appendChild(li);
        });
        
        container.appendChild(list1);
        
        const note1 = document.createElement("div");
        note1.style.marginTop = "14px";
        note1.style.padding = "14px";
        note1.style.background = "#fff3cd";
        note1.style.borderRadius = "6px";
        note1.style.fontSize = "14px";
        note1.innerHTML = "<strong>Nota:</strong> Para los grupos que paguen correctamente no aplica inciso A y B salvo causas o circunstancias que se justifiquen en el sistema.";
        container.appendChild(note1);
        
        const subtitle2 = document.createElement("h3");
        subtitle2.textContent = "2. Para cr√©ditos adicionales:";
        subtitle2.style.fontSize = "16px";
        subtitle2.style.marginTop = "15px";
        subtitle2.style.marginBottom = "10px";
        subtitle2.style.fontWeight = "600";
        container.appendChild(subtitle2);
        
        const para = document.createElement("p");
        para.textContent = "S√≥lo cuando el cr√©dito adicional anterior tenga m√°s de 1 cuota en atraso.";
        para.style.marginLeft = "20px";
        container.appendChild(para);
        
        return { type: 'html', content: container };
      }

      if (keywords.igualacion.some(kw => lower.includes(kw))) {
        const container = document.createElement("div");
        const title = document.createElement("strong");
        title.textContent = "IGUALACI√ìN DE MONTOS";
        container.appendChild(title);
        container.appendChild(document.createElement("br"));
        container.appendChild(document.createElement("br"));
        
        const subtitle = document.createElement("div");
        subtitle.textContent = "cuando un socio solicite un monto mayor al correspondiente de acuerdo con la tabla de ciclos:";
        container.appendChild(subtitle);
        container.appendChild(document.createElement("br"));
        
        const table = createTable(
          ["pol√≠ticas"],
          [
            ["a) El monto m√°ximo a solicitar debe aparecer en la columna CR√âDITO M√ÅXIMO del Bur√≥ de Cr√©dito o en la evidencia de cr√©dito grupal."],
            ["b) La cuenta de referencia debe ser de un cr√©dito grupal,y el ciclo mas reciente se encuentre pagado o estar en sus √∫ltimos 4 pagos seg√∫n su plan de pagos."],
            ["c) La cuenta de referencia debe estar calificada con MOP 01, o justificar que se encuentra al corriente."],
            ["d) El ciclo m√°s reciente no debe rebasar m√°s de un a√±o desde la fecha del √∫ltimo pago hasta la fecha de consulta."]
          ]
        );
        container.appendChild(table);
        
        const note = document.createElement("div");
        note.style.marginTop = "12px";
        note.style.padding = "10px";
        note.style.background = "#fff3cd";
        note.style.borderRadius = "6px";
        note.style.fontSize = "13px";
        note.innerHTML = "<strong>NOTA:</strong> <li> No aplica para cr√©ditos con menos de 5 integrantes.</li> <li>No aplica para socios con vivienda prestada o rentada. </li>";
        container.appendChild(note);
        
        return { type: 'html', content: container };
      }

      if (keywords.renovacion.some(kw => lower.includes(kw))) {
        const container = document.createElement("div");
        const title = document.createElement("strong");
        title.textContent = "RENOVACI√ìN DE CR√âDITOS EN MODALIDAD GRUPAL";
        container.appendChild(title);
        container.appendChild(document.createElement("br"));
        container.appendChild(document.createElement("br"));
        
      const table = createTable(
  ["Pol√≠ticas"],
  [
    ["1. Los grupos en primer ciclo nO pueden renovarse, excepto en los siguientes casos: grupos nuevos por separaci√≥n de integrantes o asignaci√≥n de ciclos para igualar montos (validar con Coordinaci√≥n)."],
    ["2. A partir del segundo ciclo se permite la renovaci√≥n cuando el grupo lleve pagado el 80% de las cuotas del plan de pagos."],
    ["3. NO aplica renovaci√≥n si el cr√©dito adicional de alg√∫n integrante est√° en atraso."]
  ]
);

        container.appendChild(table);
        
        const note = document.createElement("div");
        note.style.marginTop = "12px";
        note.style.padding = "10px";
        note.style.background = "#fff3cd";
        note.style.borderRadius = "6px";
        note.style.fontSize = "13px";
        note.innerHTML = "<strong>Importante:</strong> Validar casos especiales con la <mark>COORDINACI√ìN DE CR√âDITOS SOLIDARIOS</mark> por correo electr√≥nico.";
        container.appendChild(note);
        
        return { type: 'html', content: container };
      }

      if (keywords.saldos.some(kw => lower.includes(kw))) {
        const container = document.createElement("div");
        const title = document.createElement("strong");
        title.textContent = "SALDOS INSOLUTOS ‚Äì Renovaci√≥n de Cr√©dito Grupal";
        container.appendChild(title);
        container.appendChild(document.createElement("br"));
        container.appendChild(document.createElement("br"));

        const info = document.createElement("p");
        info.style.lineHeight = "1.6";
        info.innerHTML = `
          Cuando el cr√©dito grupal se encuentre en <strong>atraso o con estatus vencido</strong> y los socios tengan 
          intenci√≥n de pago, podr√°n solicitar la <strong>renovaci√≥n del cr√©dito</strong> con un m√≠nimo de <strong>tres integrantes</strong>.
          <br><br>
          Esta renovaci√≥n cubrir√° los <strong>saldos de capital pendientes</strong> del grupo y se podr√°n incluir los saldos 
          de capital del cr√©dito adicional grupal que tengan los integrantes.
          <br><br>
          El cr√©dito ser√° <strong>sesionado por el Comit√© de Cr√©dito</strong> y se apegar√° a lo establecido en las 
          pol√≠ticas generales de clasificaci  n de cartera, tramit√°ndose con el <strong>mismo producto crediticio</strong>.
        `;
        container.appendChild(info);

        const note = document.createElement("div");
        note.style.marginTop = "12px";
        note.style.padding = "12px";
        note.style.background = "#e2e3e5";
        note.style.borderRadius = "6px";
        note.style.fontSize = "13px";
        note.innerHTML = `
          <strong>üí° Nota:</strong> Esta acci√≥n se considera una <em>renovaci√≥n de saldos insolutos</em>, 
          ya que los montos pendientes se trasladan al nuevo cr√©dito sin perder el seguimiento del capital original.
        `;
        container.appendChild(note);

        return { type: 'html', content: container };
      }

      if (keywords.expedientes.some(kw => lower.includes(kw))) {
        const container = document.createElement("div");
        const title = document.createElement("strong");
        title.textContent = "CREACI√ìN DE EXPEDIENTES";
        container.appendChild(title);
        container.appendChild(document.createElement("br"));
        container.appendChild(document.createElement("br"));

        const intro = document.createElement("div");
        intro.textContent = "Para crear un nuevo expediente grupal, se deben seguir los siguientes pasos y cumplir con los requisitos:";
        intro.style.marginBottom = "12px";
        container.appendChild(intro);

        const steps = [
          "Se integrar√° un expediente a nombre del grupo y otro por cada integrante individual.",
          "La fotograf√≠a grupal deber√° estar digitalizada antes del desembolso y debe actualizarse cuando se agreguen o eliminen integrantes.",
          "Cada integrante del grupo deber√° ahorrar durante la vida del cr√©dito; este monto ser√° acordado con el Asesor de Cr√©dito y Recuperaci√≥n o el personal operativo asignado a la sucursal.",
          "Reunir toda la documentaci√≥n requerida del socio o grupo.",
          "Registrar los datos del socio o grupo en el sistema de la cooperativa.",
          "Adjuntar comprobantes de domicilio, ingresos y cualquier otra evidencia necesaria.",
          "Verificar que la informaci√≥n est√© completa y correcta antes de guardar el expediente.",
          "Enviar el expediente para revisi√≥n y aprobaci√≥n por el √°rea correspondiente."
        ];

        const list = document.createElement("ul");
        list.style.listStyleType = "disc";
        list.style.paddingLeft = "25px";
        list.style.lineHeight = "1.8";
        list.style.margin = "0";

        steps.forEach(step => {
          const li = document.createElement("li");
          li.textContent = step;
          li.style.marginBottom = "10px";
          list.appendChild(li);
        });

        container.appendChild(list);
        return { type: "html", content: container };
      }

      if (keywords.incremento.some(kw => lower.includes(kw))) {
        const container = document.createElement("div");
        const title = document.createElement("strong");
        title.textContent = "INCREMENTO DE CR√âDITO PARA SOCIOS ANTIGUOS";
        container.appendChild(title);
        container.appendChild(document.createElement("br"));
        container.appendChild(document.createElement("br"));

        const content = document.createElement("div");
        content.innerHTML = `
          <ul>
            <li>
              <strong>Socios antiguos con buen historial de pagos:</strong> Aquellos que hayan reducido sus montos de cr√©dito, cambiado de grupo o estado inactivo por menos de dos a√±os, podr√°n acceder a un incremento en su siguiente cr√©dito tomando como base el monto m√°s alto recibido y su nueva capacidad de pago, de acuerdo con la tabla de incrementos.
            </li>
            <li>
              <strong>Socios con historial positivo pero inactivos m√°s de dos a√±os:</strong> Se realizar√° el tr√°mite de cr√©dito considerando su historial y capacidad de pago, siguiendo estrictamente el Proceso de Cr√©dito (PDC).
            </li>
          </ul>
        `;
        content.style.marginTop = "8px";
        content.style.lineHeight = "1.7";
        container.appendChild(content);

        return { type: 'html', content: container };
      }

      if (keywords.domicilio.some(kw => lower.includes(kw))) {
        const container = document.createElement("div");
        const title = document.createElement("h3");
        title.textContent = "POLITICAS DE TIPO DE VIVIENDA";
        title.style.marginBottom = "15px";
        container.appendChild(title);

        const viviendaTitle = document.createElement("h4");
        viviendaTitle.textContent = "üìã C√≥mo clasificamos las viviendas:";
        viviendaTitle.style.marginBottom = "10px";
        container.appendChild(viviendaTitle);

        const viviendaList = document.createElement("ul");
        viviendaList.style.lineHeight = "1.8";
        viviendaList.style.marginLeft = "20px";
        viviendaList.innerHTML = `
          <li><strong>Parentescos v√°lidos para vivienda familiar:</strong> Hermanos, padres, hijos, abuelos, nietos, suegros, cu√±ados.</li>
          <li><strong>Parentescos v√°lidos para vivienda propia:</strong> A nombre del socio, c√≥nyuge o concubino(a).</li>
        `;
        container.appendChild(viviendaList);

        const note1 = document.createElement("div");
        note1.style.cssText = "margin-top:12px;padding:12px;background:#fff3cd;border-radius:6px;font-size:13px;";
        note1.innerHTML = `
          <strong>¬øCu√°ndo se actualizan?</strong><br>
          Socios con domicilio propio o familiar actualizar√°n su comprobante cada a√±o o cuando cambien de domicilio.
        `;
        container.appendChild(note1);

        const rentadaTitle = document.createElement("h4");
        rentadaTitle.textContent = "   Personas con vivienda rentada o prestada:";
        rentadaTitle.style.marginTop = "20px";
        container.appendChild(rentadaTitle);

        const note2 = document.createElement("div");
        note2.style.cssText = "margin-top:12px;padding:12px;background:#fff3cd;border-radius:6px;font-size:13px;";
        note2.innerHTML = `
          <strong>¬øCu√°ndo se actualizan?</strong><br>
          Socios que rentan o habitan vivienda prestada actualizar√°n su comprobante cada tr√°mite.
        `;
        container.appendChild(note2);

        const tableTitle = document.createElement("div");
        tableTitle.textContent = "Tabla de integrantes con propiedad rentada o prestada por cada grupo:";
        tableTitle.style.margin = "20px 0 10px";
        tableTitle.style.fontWeight = "500";
        container.appendChild(tableTitle);

        container.appendChild(createTable(
          ["Total Integrantes", "Integrantes con vivienda rentada/prestada", "Integrantes con vivienda propia/familiar"],
          [["5", "2", "3"], ["10", "4", "6"], ["15", "6", "9"], ["20", "8", "12"]]
        ));

        const intro = document.createElement("div");
        intro.textContent = "Pol√≠ticas para la incorporaci√≥n de integrantes que viven en vivienda prestada o rentada";
        intro.style.margin = "18px 0 14px";
        intro.style.fontWeight = "700";
        intro.style.fontSize = "16px";
        intro.style.color = "#212529";
        container.appendChild(intro);

        const list = document.createElement("ol");
        list.style.lineHeight = "1.9";
        list.style.marginLeft = "20px";
        list.innerHTML = `
          <li><strong>Renovaciones sin atrasos:</strong> En renovaciones de grupos que no hayan presentado atrasos de m√°s de una cuota, se podr√°n agregar m√°s integrantes que viven en vivienda prestada o rentada, siempre y cuando <mark>su n√∫mero sea igual o inferior al 50 % del total de integrantes.</mark></li>
          <li><strong>Monto m√°ximo:</strong><br>El monto m√°ximo a otorgar ser√° la cantidad de <mark>$70,000.00</mark> por integrante nuevo que renta.</li>
          <li><strong>Socios con historial:</strong><br>Para socios que hayan trabajado en la cooperativa un monto mayor a $70,000.00 se le podr√° respetar el monto en la renovaci√≥n o cr√©ditos posteriores.</li>
        `;
        container.appendChild(list);

        const finalNote = document.createElement("div");
        finalNote.style.cssText = "margin-top:15px;padding:12px;background:#fff3cd;border-radius:6px;font-size:13px;";
        finalNote.innerHTML = `
          <strong>Importante:</strong>
          Esta pol√≠tica busca mitigar el riesgo manteniendo equilibrio entre integrantes con vivienda
          propia/familiar y quienes rentan.
        `;
        container.appendChild(finalNote);

        return { type: "html", content: container };
      }

      if (keywords.comprobante.some(kw => lower.includes(kw))) {
        const container = document.createElement("div");
        const title = document.createElement("strong");
        title.textContent = "COMPROBANTE DE DOMICILIO";
        container.appendChild(title);
        container.appendChild(document.createElement("br"));
        container.appendChild(document.createElement("br"));

        const subtitle1 = document.createElement("h3");
        subtitle1.textContent = "1. Requisitos generales del comprobante de domicilio:";
        subtitle1.style.fontSize = "16px";
        subtitle1.style.marginTop = "10px";
        subtitle1.style.marginBottom = "10px";
        subtitle1.style.fontWeight = "600";
        container.appendChild(subtitle1);

        const list1 = document.createElement("ol");
        list1.type = "a";
        list1.style.lineHeight = "1.8";
        list1.style.marginLeft = "20px";

        const items1 = [
          "a) El comprobante deber√° tener una antig√ºedad m√°xima de tres meses a partir de su fecha de emisi√≥n.",
          "b) La direcci√≥n deber√° coincidir con la registrada en el sistema.",
          "c) Si el comprobante no est√° a nombre del socio o aval, se deber√° especificar la relaci√≥n o parentesco con el titular."
        ];

        items1.forEach(item => {
          const li = document.createElement("li");
          li.textContent = item;
          list1.appendChild(li);
        });
        container.appendChild(list1);

        const subtitle2 = document.createElement("h3");
        subtitle2.textContent = "2. Tipos de comprobantes de domicilio aceptados:";
        subtitle2.style.fontSize = "16px";
        subtitle2.style.marginTop = "15px";
        subtitle2.style.marginBottom = "10px";
        subtitle2.style.fontWeight = "600";
        container.appendChild(subtitle2);

        const list2 = document.createElement("ul");
        list2.style.lineHeight = "1.8";
        list2.style.marginLeft = "20px";

        const items2 = [
          "Recibo de suministro de energ√≠a el√©ctrica o comprobante CFEm√°tico.",
          "Recibo o estado de cuenta del servicio de agua.",
          "Recibo de gas natural.",
          "Boleta predial del a√±o en curso.",
          "Recibo de servicios de telecomunicaciones fija.",
          "Estado de cuenta bancario (no n√≥mina).",
          "Constancia de Origen y Vecindad expedida por autoridad competente con visto bueno correspondiente."
        ];

        items2.forEach(item => {
          const li = document.createElement("li");
          li.textContent = item;
          list2.appendChild(li);
        });
        container.appendChild(list2);

        const note = document.createElement("div");
        note.style.marginTop = "14px";
        note.style.padding = "14px";
        note.style.background = "#f7bf57";
        note.style.borderRadius = "6px";
        note.style.fontSize = "14px";
        note.innerHTML = `
          <strong>Nota:</strong> 
          Cuando la direcci√≥n registrada no coincida con el comprobante, se deber√° anotar la leyenda 
          <em>"Corrobor√© domicilio"</em> y detallar la direcci√≥n correcta en el margen del documento.
          <br><br>
          Si varios integrantes presentan el mismo comprobante pero habitan viviendas distintas, deber√°n
          anexar fotograf√≠as de la fachada y del acceso principal de cada vivienda. No se consideran
          viviendas distintas las construcciones en segundos niveles de la misma casa.
        `;
        container.appendChild(note);

        return { type: 'html', content: container };
      }

      if (keywords.recurso.some(kw => lower.includes(kw))) {
  const container = document.createElement("div");

  const title = document.createElement("strong");
  title.textContent = "COMPROBACI√ìN CR√âDITO COMERCIAL";
  container.appendChild(title);
  container.appendChild(document.createElement("br"));
  container.appendChild(document.createElement("br"));

  const list = document.createElement("ul");
  list.style.lineHeight = "1.8";
  list.style.marginLeft = "20px";

 const li = document.createElement("li");
li.innerHTML = `Todo cr√©dito con finalidad comercial de 
<mark><strong>grupos nuevos (1er. 2do. y 3er ciclo) se deber√° verificar</strong></mark>
la comprobaci√≥n de la aplicaci√≥n del recurso (de manera f√≠sica o con autenticador digital) 
<mark><strong>dentro de los 30 d√≠as</strong></mark> naturales posteriores al desembolso en cr√©ditos de 
<mark><strong>montos mayores de $50,000.00 (cincuenta mil pesos 00/100 M. N.).</strong></mark>`;

  list.appendChild(li);
  container.appendChild(list);

  return { type: 'html', content: container };
}

  if (keywords.montos.some(kw => lower.includes(kw))) {
        const container = document.createElement("div");
        const title = document.createElement("strong");
        title.textContent = "TR√ÅMITE DE MONTOS SUPERIORES A $70,000.00";
        container.appendChild(title);
        container.appendChild(document.createElement("br"));
        container.appendChild(document.createElement("br"));
        
        const requirement = document.createElement("div");
        requirement.textContent = "Requisitos para montos superiores a $70,000:";
        requirement.style.marginBottom = "10px";
        container.appendChild(requirement);
        
        const list = document.createElement("ul");
        list.style.lineHeight = "1.8";
        list.style.marginLeft = "20px";
        const li = document.createElement("li");
        li.textContent = "Debe contar con un historial en el reporte de bur√≥ de al menos tres cr√©ditos iguales o superiores al monto a solicitar, calificados con MOP 01, o bien, el monto asignado deber√° corresponder al n√∫mero de ciclo actual.";
        list.appendChild(li);
        container.appendChild(list);
        
        const note = document.createElement("div");
        note.style.marginTop = "12px";
        note.style.padding = "12px";
        note.style.background = "#d1ecf1";
        note.style.borderRadius = "6px";
        note.style.fontSize = "13px";
        note.innerHTML = "<strong>Nota:</strong> Los socios con historial grupal en la cooperativa que hayan pagado tres ciclos con un monto de $70,000.00 sin atrasos podr√°n incrementar su monto hasta $100,000.00";
        container.appendChild(note);
        
        return { type: 'html', content: container };
      }

      if (keywords.adicional.some(kw => lower.includes(kw))) {
        const container = document.createElement("div");
        const title = document.createElement("strong");
        title.textContent = "CR√âDITO GRUPAL ADICIONAL";
        container.appendChild(title);
        container.appendChild(document.createElement("br"));
        container.appendChild(document.createElement("br"));
        
        const caracTitle = document.createElement("div");
        caracTitle.innerHTML = "<strong>üìã Caracter√≠sticas del cr√©dito adicional grupal:</strong>";
        caracTitle.style.marginBottom = "10px";
        container.appendChild(caracTitle);
        
        const caracList = document.createElement("ul");
        caracList.style.lineHeight = "1.8";
        caracList.style.marginLeft = "20px";
        
        const caracItems = [
          "<strong>Monto:</strong> de $3,000.00 hasta $25,000.00",
          "<strong>Tasa de inter√©s anual natural:</strong> 32%",
          "<strong>Tasa de inter√©s moratoria anual:</strong> 36%",
          "<strong>Plazo:</strong> de 6 a 18 meses",
          "<strong>Periodicidad:</strong> semanal, Catorcenal, Quincenal o Mensual",
          "<strong>Garant√≠a:</strong> del 10 % del monto solicitado",
          "<strong>Cobertura del cr√©dito:</strong> 1 % del monto solicitado"
        ];
        
        caracItems.forEach(item => {
          const li = document.createElement("li");
          li.innerHTML = item;
          caracList.appendChild(li);
        });
        
        container.appendChild(caracList);
        container.appendChild(document.createElement("br"));
        
        const tableTitle = document.createElement("div");
        tableTitle.textContent = "Tabla de referencia:";
        tableTitle.style.fontWeight = "600";
        tableTitle.style.marginBottom = "8px";
        container.appendChild(tableTitle);
        
        const table1 = createTable(
          ["Rango de Montos", "Plazo M√°ximo"],
          [
            ["$3,000 a $5,000", "6 meses"],
            ["$5,001 a $15,000", "12 meses"],
            ["$15,001 a $25,000", "18 meses"]
          ]
        );
        container.appendChild(table1);
        
        const note1 = document.createElement("div");
        note1.style.marginTop = "12px";
        note1.style.padding = "10px";
        note1.style.background = "#fff3cd";
        note1.style.borderRadius = "6px";
        note1.style.fontSize = "13px";
        note1.innerHTML = "<strong>Nota:</strong> Se necesitar√° la autorizaci√≥n de todo el grupo por medio de una carta de consentimiento (no es necesario que el solicitante la firme) la cual tiene una vigencia de 30 d√≠as.";
        container.appendChild(note1);
        
        container.appendChild(document.createElement("br"));
        
        const polTitle = document.createElement("div");
        polTitle.innerHTML = "<strong>üìå Pol√≠ticas:</strong>";
        polTitle.style.marginTop = "15px";
        polTitle.style.marginBottom = "10px";
        container.appendChild(polTitle);
        
        const polList = document.createElement("ol");
        polList.style.lineHeight = "1.8";
        polList.style.marginLeft = "20px";
        
        const polItems = [
          "a) A partir del tercer ciclo siempre y cuando el grupo lleve un mes de pagos puntuales (4 semanas, 2 catorcenas o quincenas) de acuerdo con su plan de pago.",
          "b) El socio deber√° estar trabajando o haber pagado un cr√©dito grupal con monto igual o mayor a $6,000.00",
          "c) Como cr√©dito adicional el socio tendr√° acceso al 50 % del monto trabajado en el ciclo o el monto m√°s alto con el que haya trabajado en cr√©ditos grupales. Teniendo como m√≠nimo $3,000.00 y un m√°ximo de $25,000.00 previamente validado con su capacidad de pago.",
          "d) En caso de solicitar un cr√©dito adicional mayor de $15,001.00 se necesita haber pagado un monto igual a $15,000.00 sin haberse atrasado m√°s de un pago, con excepci√≥n de los convenios de colaboraci√≥n (agua, etc.).",
          "e) No se otorgar√° el cr√©dito adicional grupal si el grupo se encuentra en atrasos.",
          "f) Se podr√° renovar una vez pagado el 50 % del monto otorgado."
        ];
        
        polItems.forEach(item => {
          const li = document.createElement("li");
          li.textContent = item;
          polList.appendChild(li);
        });
        
        container.appendChild(polList);
        container.appendChild(document.createElement("br"));
        
        const aguaTitle = document.createElement("div");
        aguaTitle.innerHTML = "<strong>üíß Programa: Agua y Saneamiento</strong>";
        aguaTitle.style.marginTop = "15px";
        aguaTitle.style.marginBottom = "10px";
        container.appendChild(aguaTitle);
        
        const aguaDesc = document.createElement("div");
        aguaDesc.textContent = "Pol√≠ticas de cr√©ditos destinados a la mejora de sistemas de almacenamiento, saneamiento y cuidado del agua:";
        aguaDesc.style.marginBottom = "10px";
        container.appendChild(aguaDesc);
        
        const aguaList = document.createElement("ul");
        aguaList.style.lineHeight = "1.8";
        aguaList.style.marginLeft = "20px";
        
        const aguaItems = [
          "1. Socios con cr√©dito grupal activo o grupos nuevos en la cooperativa",
          "2. Los productos participantes son: cr√©dito adicional grupal y grupal consumo-avance",
          "3. Finalidades del cr√©dito:<br>‚Ä¢ Compra de tinacos, biodigestores y/o calentadores solares<br>‚Ä¢ Construcci√≥n o remodelaci√≥n de sanitario<br>‚Ä¢ Mobiliario y accesorios (tazas, regaderas, llaves, etc.)<br>‚Ä¢ Conexi√≥n (plomer√≠a, tuber√≠as o drenaje)<br>‚Ä¢ Construcci√≥n de letrinas, fosas s√©pticas, cisternas o tanques para almacenar agua dom√©stica<br>‚Ä¢ Compra e instalaci√≥n de motobomba dom√©stica o filtros de purificaci√≥n de agua<br>‚Ä¢ Construcci√≥n o finalizaci√≥n de pozo profundo"
        ];
        
        aguaItems.forEach(item => {
          const li = document.createElement("li");
          li.innerHTML = item;
          aguaList.appendChild(li);
        });
        
        container.appendChild(aguaList);
        
        const note2 = document.createElement("div");
        note2.style.marginTop = "12px";
        note2.style.padding = "12px";
        note2.style.background = "#d1ecf1";
        note2.style.borderRadius = "6px";
        note2.style.fontSize = "13px";
        note2.innerHTML = "<strong>Importante:</strong> Consulta con tu asesor para m√°s detalles sobre programas especiales y convenios de colaboraci√≥n.";
        container.appendChild(note2);
        
        return { type: 'html', content: container };
      }

      if (keywords.nuevos.some(kw => lower.includes(kw))) {
        const container = document.createElement("div");
        const title = document.createElement("strong");
        title.textContent = "GRUPOS NUEVOS";
        container.appendChild(title);
        container.appendChild(document.createElement("br"));
        container.appendChild(document.createElement("br"));

        const intro = document.createElement("div");
        intro.innerHTML = `
          REQUISITOS PARA FORMAR UN GRUPO
          <ul style="margin-top:6px; margin-left:18px;">
            <li>Todos los integrantes deber√°n ser socios de la cooperativa.</li>
          </ul>
        `;
        intro.style.marginBottom = "12px";
        intro.style.fontWeight = "500";
        container.appendChild(intro);

        const list = document.createElement("ol");
        list.style.lineHeight = "1.9";
        list.style.marginLeft = "20px";

        const createItem = (html) => {
          const li = document.createElement("li");
          li.innerHTML = html;
          li.style.marginBottom = "12px";
          return li;
        };

        list.appendChild(createItem(`
          <strong>N√∫mero de integrantes:</strong><br>
          El grupo deber√° contar con un m√≠nimo de <mark>5 integrantes</mark>.
        `));

        list.appendChild(createItem(`
          <strong>Rango de edad:</strong><br>
          Desde los <mark>18</mark> hasta los <mark>70 a√±os</mark> (0 d√≠as).
        `));

        list.appendChild(createItem(`
          <strong>Integrantes que rentan:</strong><br>
          M√°ximo <mark>2 personas</mark> con vivienda rentada o prestada.
        `));

        list.appendChild(createItem(`
          <strong>Distancia:</strong><br>
          La distancia entre viviendas o puntos de trabajo debe ser ‚â§ <mark>5 km</mark>.
        `));

        list.appendChild(createItem(`
          <strong>Comprobante de ingresos:</strong><br>
          Todos los integrantes deben contar con ingresos propios.
        `));

        const garantia = document.createElement("li");
        garantia.style.marginBottom = "12px";
        garantia.innerHTML = `
          <strong>Garant√≠as y protecci√≥n:</strong>
          <ul style="margin-top:6px; margin-left:18px;">
            <li>
              Garant√≠a m√≠nima equivalente al <mark>10%</mark> del monto del cr√©dito,
              la cual podr√° ser depositada o retenida en su totalidad.
            </li>
            <li>
              Protecci√≥n del <mark>1 %</mark> por cr√©dito
              ($10 por cada $1,000.00).
            </li>
          </ul>
        `;
        list.appendChild(garantia);

        list.appendChild(createItem(`
          <strong>Sujeto a cr√©dito:</strong><br>
          Los integrantes deber√°n contar con clasificaci√≥n de riesgo
          <mark>bajo o medio</mark>.
        `));

        list.appendChild(createItem(`
          <strong>Integrantes por domicilio:</strong><br>
          M√°ximo <mark>2 integrantes</mark> podr√°n vivir en el mismo domicilio.
        `));

        container.appendChild(list);

        const note = document.createElement("div");
        note.style.marginTop = "15px";
        note.style.padding = "12px";
        note.style.background = "#fff3cd";
        note.style.borderRadius = "6px";
        note.style.fontSize = "13px";
        note.innerHTML = `
          <strong>NOTA ‚Äì Finalidad del cr√©dito:</strong>
          <ul style="margin-top:8px; margin-left:18px;">
            <li>
              <strong>Finalidad comercial:</strong>
              Aplica cuando todos los integrantes cuentan con actividad comercial.
            </li>
            <li>
              Si alg√∫n integrante percibe ingresos por n√≥mina, pero comprueba
              que el cr√©dito ser√° destinado a un negocio, se considerar√°
              finalidad comercial.
            </li>
            <li>
              Si no se justifica la inversi√≥n, el cr√©dito se otorgar√° como
              producto de finalidad de consumo.
            </li>
          </ul>
        `;
        container.appendChild(note);

        return { type: 'html', content: container };
      }

      if (keywords.generalidades.some(kw => lower.includes(kw))) {
        const container = document.createElement("div");
        const title = document.createElement("strong");
        title.textContent = "DESEMBOLSO FUERA DE SUCURSAL";
        container.appendChild(title);
        container.appendChild(document.createElement("br"));
        container.appendChild(document.createElement("br"));
        
        const desembolsoSection = document.createElement("div");
        desembolsoSection.style.marginBottom = "20px";

        const desembolsoTitle = document.createElement("h4");
        desembolsoTitle.textContent = "üí∞ DESEMBOLSO EN CAMPO";
        desembolsoTitle.style.color = "#1e40af";
        desembolsoTitle.style.marginTop = "0";
        desembolsoTitle.style.marginBottom = "12px";
        desembolsoSection.appendChild(desembolsoTitle);

        const desembolsoInfo = document.createElement("div");
        desembolsoInfo.style.padding = "12px";
        desembolsoInfo.style.background = "#e0f2fe";
        desembolsoInfo.style.borderRadius = "8px";
        desembolsoInfo.style.borderLeft = "4px solid #0ea5e9";
        desembolsoInfo.style.lineHeight = "1.6";
        desembolsoInfo.innerHTML = `
          <strong>DE LA ENTREGA DEL CR√âDITO FUERA DE SUCURSAL:</strong>
          <p>Los desembolsos fuera de sucursal s√≥lo aplican para grupos con un valor de <strong>$60,000.00 o superior.</strong></p>
          <ul style="margin-left: 20px; line-height: 1.6; list-style-type: disc;">
            <li>Se env√≠a el formato <mark>"desembolso fuera de sucursal"</mark> para visto bueno a la coordinaci√≥n de cr√©ditos solidarios.</li>
            <li>Una vez que se tenga el visto bueno, mesa de control permitir√° el desembolso en el sistema entendiendose que el pagar√©, contrato y plan de pagos no cuentan con las firmas de los socios.</li>
            <li>Una vez permitido el desembolso por mesa de control se expide el cheque a nombre del socio por la cantidad a entregar.</li>
            <li>El asesor es el responsable de recabar y cotejar las firmas.</li>
            <li>La documenaci√≥n firmada se debe entregar a mesa de control el mismo d√≠a de la entrega del cr√©dito.</li>
            <li>En caso de haber un error u omision se deber√°n realizar las correciones a m√°s tardar un d√≠a h√°bil despues de haber realizado el desembolso.</li>
            <li>En caso de que el desembolso en campo no se realice, se debe notificar de inmediato al gerente de sucursal para reversar los movimientos, en caso de no avisar inmediatamente el asesor ser√° el responsable de los costos generados.</li> 
          </ul>
        `;
        desembolsoSection.appendChild(desembolsoInfo);
        container.appendChild(desembolsoSection);

        return { type: 'html', content: container };
      }

      if (keywords.adulto.some(kw => lower.includes(kw))) {
        const container = document.createElement("div");
        const title = document.createElement("strong");
        title.textContent = "M√ÅS DE 70 A√ëOS";
        container.appendChild(title);
        container.appendChild(document.createElement("br"));
        container.appendChild(document.createElement("br"));
      
        const adultoSection = document.createElement("div");
        adultoSection.style.marginBottom = "20px";

        const adultoTitle = document.createElement("h4");
        adultoTitle.textContent = "üë¥ POL√çTICAS PARA ADULTOS MAYORES";
        adultoTitle.style.color = "#1e40af";
        adultoTitle.style.marginTop = "0";
        adultoTitle.style.marginBottom = "12px";
        adultoSection.appendChild(adultoTitle);

        const adultoInfo = document.createElement("div");
        adultoInfo.style.padding = "12px";
        adultoInfo.style.background = "#e0f2fe";
        adultoInfo.style.borderRadius = "8px";
        adultoInfo.style.borderLeft = "4px solid #0ea5e9";
        adultoInfo.style.lineHeight = "1.6";
        adultoInfo.innerHTML = `
          <strong>POL√çTICAS PARA SOCIOS DE 70 A 80 A√ëOS:</strong>
          <p>Los socios que se encuentren en un rango <strong>de 70 a 80 a√±os</strong> se le otorgar√°n los cr√©ditos de acuerdo con los siguientes criterios:</p>
          <ul style="margin-left: 20px; line-height: 1.6; list-style-type: disc;">
            <li>No haber reflejado atrasos de m√°s de una cuota en su √∫ltimo ciclo trabajado dentro de la Cooperativa Acreimex.</li>
            <li>El monto para otorgar al integrante en este rango de edad ser√° de acuerdo con la tabla de ciclos de cada producto, y hasta $50,000.00 (cincuenta mil pesos 00/100 M. N.).</li>
          </ul>
        `;
        adultoSection.appendChild(adultoInfo);
        container.appendChild(adultoSection);

        const note1 = document.createElement("div");
        note1.style.marginTop = "12px";
        note1.style.padding = "12px";
        note1.style.background = "#f7e69e";
        note1.style.borderRadius = "6px";
        note1.style.fontSize = "13px";
        note1.innerHTML = "<strong>NOTA:</strong> Cuando la persona est√© trabajando un monto mayor a $50,000.00 y requiera el mismo monto, se podr√° mandar a comit√© de cr√©dito, siempre y cuando no se hayan reflejado atrasos en su √∫ltimo cr√©dito.";
        container.appendChild(note1);

        return { type: 'html', content: container };
      }

      if (keywords.multas.some(kw => lower.includes(kw))) {
        const container = document.createElement("div");
        const title = document.createElement("strong");
        title.textContent = "PENALIZACIONES";
        container.appendChild(title);
        container.appendChild(document.createElement("br"));
        container.appendChild(document.createElement("br"));

        const penalTitle = document.createElement("h4");
        penalTitle.textContent = "‚ö†Ô∏è PENALIZACIONES POR ATRASOS";
        penalTitle.style.color = "#dc2626";
        penalTitle.style.marginTop = "20px";
        penalTitle.style.marginBottom = "12px";
        container.appendChild(penalTitle);
        
        const penalIntro = document.createElement("div");
        penalIntro.textContent = "Las penalizaciones se aplican seg√∫n el n√∫mero de cuotas vencidas acumuladas:";
        penalIntro.style.marginBottom = "12px";
        penalIntro.style.fontWeight = "500";
        container.appendChild(penalIntro);
        
        const penal2 = document.createElement("div");
        penal2.style.padding = "14px";
        penal2.style.background = "#fff7ed";
        penal2.style.borderRadius = "8px";
        penal2.style.marginBottom = "10px";
        penal2.style.borderLeft = "4px solid #f59e0b";
        
        const penal2Title = document.createElement("div");
        penal2Title.innerHTML = "<strong>üî∏ 2 CUOTAS ACUMULADAS VENCIDAS</strong>";
        penal2Title.style.marginBottom = "6px";
        penal2Title.style.color = "#92400e";
        penal2.appendChild(penal2Title);
        
        const penal2Text = document.createElement("div");
        penal2Text.textContent = "NO pueden acceder a un incremento de monto.";
        penal2Text.style.fontSize = "14px";
        penal2.appendChild(penal2Text);
        container.appendChild(penal2);
        
        const penal4 = document.createElement("div");
        penal4.style.padding = "14px";
        penal4.style.background = "#fee2e2";
        penal4.style.borderRadius = "8px";
        penal4.style.marginBottom = "10px";
        penal4.style.borderLeft = "4px solid #dc2626";
        
        const penal4Title = document.createElement("div");
        penal4Title.innerHTML = "<strong>üî¥ 4 CUOTAS ACUMULADAS VENCIDAS</strong>";
        penal4Title.style.marginBottom = "8px";
        penal4Title.style.color = "#991b1b";
        penal4.appendChild(penal4Title);
        
        const penal4List = document.createElement("ul");
        penal4List.style.margin = "0";
        penal4List.style.paddingLeft = "20px";
        penal4List.style.fontSize = "14px";
        
        const penal4Item1 = document.createElement("li");
        penal4Item1.innerHTML = "<strong>Primero:</strong> Se solicita la reasignaci√≥n de tasa del ciclo uno de acuerdo con el producto, a la <mark>Coordinaci√≥n de Cr√©ditos Solidarios</mark>.";
        penal4Item1.style.marginBottom = "6px";
        penal4List.appendChild(penal4Item1);
        
        const penal4Item2 = document.createElement("li");
        penal4Item2.innerHTML = "<strong>Segundo:</strong> El monto asignado ser√° el √∫ltimo monto de cuant√≠a menor en el que no se hayan atrasado m√°s de una cuota.";
        penal4List.appendChild(penal4Item2);

        const penal4Item3 = document.createElement("li");
        penal4Item3.innerHTML = "<strong>Tercero:</strong> Los montos m√°ximos a otorgar deber√°n tener una proporcionalidad de 50% entre los integrantes.";
        penal4List.appendChild(penal4Item3);
        
        penal4.appendChild(penal4List);
        container.appendChild(penal4);
        
        const warningNote = document.createElement("div");
        warningNote.style.marginTop = "15px";
        warningNote.style.padding = "12px";
        warningNote.style.background = "#dbeafe";
        warningNote.style.borderRadius = "6px";
        warningNote.style.fontSize = "13px";
        warningNote.innerHTML = "<strong>üí° Nota importante:</strong> Las penalizaciones buscan incentivar el pago puntual y hacer conciencia de que existe una consecuencia en caso de atrasos.";
        container.appendChild(warningNote);
        
        const penalTable = document.createElement("table");
        penalTable.style.width = "100%";
        penalTable.style.borderCollapse = "collapse";
        penalTable.style.marginBottom = "18px";
        penalTable.style.fontSize = "14px";

        const thead = document.createElement("thead");
        thead.innerHTML = `
          <tr style="background:#f1f5f9;">
            <th style="border:1px solid #cbd5e1; padding:8px;">Periodicidad</th>
            <th style="border:1px solid #cbd5e1; padding:8px;">2 cuotas acumuladas vencidas (d√≠as de atraso)</th>
            <th style="border:1px solid #cbd5e1; padding:8px;">3 cuotas acumuladas vencidas (d√≠as de atraso)</th>
            <th style="border:1px solid #cbd5e1; padding:8px;">4 cuotas acumuladas vencidas (d√≠as de atraso)</th>
          </tr>
        `;
        penalTable.appendChild(thead);

        const tbody = document.createElement("tbody");
        tbody.innerHTML = `
          <tr>
            <td style="border:1px solid #e5e7eb; padding:8px; text-align:center;">semanal</td>
            <td style="border:1px solid #e5e7eb; padding:8px;">8</td>
            <td style="border:1px solid #e5e7eb; padding:8px;">16</td>
            <td style="border:1px solid #e5e7eb; padding:8px;">22</td>
          </tr>
          <tr>
            <td style="border:1px solid #e5e7eb; padding:8px; text-align:center;">catorcenal</td>
            <td style="border:1px solid #e5e7eb; padding:8px;">15</td>
            <td style="border:1px solid #e5e7eb; padding:8px;">29</td>
            <td style="border:1px solid #e5e7eb; padding:8px;">43</td>
          </tr>
          <tr>
            <td style="border:1px solid #e5e7eb; padding:8px; text-align:center;">quincenal</td>
            <td style="border:1px solid #e5e7eb; padding:8px;">16</td>
            <td style="border:1px solid #e5e7eb; padding:8px;">31</td>
            <td style="border:1px solid #e5e7eb; padding:8px;">46</td>
          </tr>
        `;
        penalTable.appendChild(tbody);
        container.appendChild(penalTable);
        
        return { type: 'html', content: container };
      }

if (keywords.sucursal.some(kw => lower.includes(kw))) {
  const container = document.createElement("div");

  const title = document.createElement("strong");
  title.textContent = "CAMBIO DE SUCURSAL";
  container.appendChild(title);
  container.appendChild(document.createElement("br"));
  container.appendChild(document.createElement("br"));

  const intro = document.createElement("div");
  intro.textContent =
    "Para realizar el cambio de sucursal, el socio deber√° cumplir con las siguientes pol√≠ticas y lineamientos:";
  intro.style.marginBottom = "12px";
  container.appendChild(intro);

  const steps = [
    "El socio deber√° solicitar el cambio de sucursal de manera formal, indicando el motivo de la solicitud.",
    "El socio no deber√° presentar adeudos vencidos al momento de solicitar el cambio.",
    "La solicitud estar√° sujeta a revisi√≥n y autorizaci√≥n por parte de la sucursal de origen y la sucursal destino.",
    "Se deber√° verificar que el expediente del socio est√© completo y actualizado.",
    "El cambio de sucursal podr√° realizarse por cambio de domicilio, trabajo o causa debidamente justificada.",
    "La sucursal destino deber√° contar con la capacidad operativa para recibir al socio.",
    "Una vez autorizado, el expediente f√≠sico y digital ser√° transferido a la nueva sucursal.",
    "El cambio de sucursal no modifica las condiciones del cr√©dito, ahorro u otros productos contratados."
  ];

  // Lista con vi√±etas forzadas
  const list = document.createElement("ul");
  list.style.listStyleType = "disc";
  list.style.paddingLeft = "25px";
  list.style.lineHeight = "1.8";
  list.style.margin = "0";

  steps.forEach(step => {
    const li = document.createElement("li");
    li.textContent = step;
    li.style.marginBottom = "10px";
    list.appendChild(li);
  });

  container.appendChild(list);

  return { type: "html", content: container };
}

      if (keywords.coordinacion.some(kw => lower.includes(kw))) {
        const container = document.createElement("div");
        const title = document.createElement("strong");
        title.textContent = "CALCULADORA DE CR√âDITOS - COORDINACI√ìN";
        container.appendChild(title);
        container.appendChild(document.createElement("br"));
        container.appendChild(document.createElement("br"));

        const closeBtn = document.createElement("button");
        closeBtn.textContent = "‚úñ";
        closeBtn.style.cssText = "float:right;background:red;border:none;cursor:pointer;color:white;font-size:24px;padding:10px 15px;border-radius:6px;";
        closeBtn.addEventListener("click", () => { container.remove(); });
        container.appendChild(closeBtn);
        
        // Calculadora
        const calcCard = document.createElement("div");
        calcCard.style.cssText = "background:white;padding:20px;border-radius:12px;box-shadow:0 2px 8px rgba(0,0,0,0.1);margin-bottom:15px;";
        
        const calcTitle = document.createElement("h4");
        calcTitle.textContent = "Calculadora de Cr√©ditos";
        calcTitle.style.cssText = "margin-top:0;color:#1e40af;";
        calcCard.appendChild(calcTitle);
        
        // Producto
        const prodRow = document.createElement("div");
        prodRow.style.marginBottom = "12px";
        prodRow.innerHTML = `<label style="display:block;margin-bottom:5px;font-weight:600;">Producto:</label>`;
        const prodSelect = document.createElement("select");
        prodSelect.id = "producto";
        prodSelect.style.cssText = "width:100%;padding:8px;border-radius:6px;border:1px solid #d1d5db;";
        prodSelect.innerHTML = `
          <option value="poder">Poder de Mujer</option>
          <option value="mixto">Grupal Mixto</option>
          <option value="preferente">Grupal Preferente</option>
          <option value="consumo">Consumo avance</option>
          <option value="impulso">Impulso solidario</option>
        `;
        prodRow.appendChild(prodSelect);
        calcCard.appendChild(prodRow);
        
        // Ciclo
        const cicloRow = document.createElement("div");
        cicloRow.style.marginBottom = "12px";
        cicloRow.innerHTML = `<label style="display:block;margin-bottom:5px;font-weight:600;">Ciclo:</label>`;
        const cicloSelect = document.createElement("select");
        cicloSelect.id = "ciclo";
        cicloSelect.style.cssText = "width:100%;padding:8px;border-radius:6px;border:1px solid #d1d5db;";
        cicloRow.appendChild(cicloSelect);
        calcCard.appendChild(cicloRow);
        
        // Monto
        const montoRow = document.createElement("div");
        montoRow.style.marginBottom = "12px";
        montoRow.innerHTML = `<label style="display:block;margin-bottom:5px;font-weight:600;">Monto solicitado (por integrante $):</label>`;
        const montoInput = document.createElement("input");
        montoInput.type = "number";
        montoInput.id = "monto";
        montoInput.placeholder = "Ej: 3000";
        montoInput.min = "0";
        montoInput.style.cssText = "width:100%;padding:8px;border-radius:6px;border:1px solid #d1d5db;";
        montoRow.appendChild(montoInput);
        calcCard.appendChild(montoRow);
        
        // Periodicidad
        const perRow = document.createElement("div");
        perRow.style.marginBottom = "12px";
        perRow.innerHTML = `<label style="display:block;margin-bottom:5px;font-weight:600;">Periodicidad:</label>`;
        const perSelect = document.createElement("select");
        perSelect.id = "periodicidad";
        perSelect.style.cssText = "width:100%;padding:8px;border-radius:6px;border:1px solid #d1d5db;";
        perRow.appendChild(perSelect);
        calcCard.appendChild(perRow);
        
        // N√∫mero de pagos
        const pagosRow = document.createElement("div");
        pagosRow.style.marginBottom = "12px";
        pagosRow.innerHTML = `<label style="display:block;margin-bottom:5px;font-weight:600;">N√∫mero de pagos:</label>`;
        const pagosSelect = document.createElement("select");
        pagosSelect.id = "numPagos";
        pagosSelect.style.cssText = "width:100%;padding:8px;border-radius:6px;border:1px solid #d1d5db;";
        pagosRow.appendChild(pagosSelect);
        calcCard.appendChild(pagosRow);
        
        // Resultados peque√±os
        const miniResults = document.createElement("div");
        miniResults.style.cssText = "display:flex;gap:10px;margin-top:12px;";
        
        const pago1000Div = document.createElement("div");
        pago1000Div.style.flex = "1";
        pago1000Div.innerHTML = `<label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Pago por cada $1,000:</label>`;
        const pago1000Input = document.createElement("input");
        pago1000Input.id = "pago1000";
        pago1000Input.readOnly = true;
        pago1000Input.style.cssText = "width:100%;padding:8px;border-radius:6px;border:1px solid #d1d5db;background:#f9fafb;";
        pago1000Div.appendChild(pago1000Input);
        
        const tasaDiv = document.createElement("div");
        tasaDiv.style.flex = "1";
        tasaDiv.innerHTML = `<label style="display:block;margin-bottom:5px;font-weight:600;font-size:13px;">Tasa del ciclo:</label>`;
        const tasaInput = document.createElement("input");
        tasaInput.id = "tasaCiclo";
        tasaInput.readOnly = true;
        tasaInput.style.cssText = "width:100%;padding:8px;border-radius:6px;border:1px solid #d1d5db;background:#f9fafb;";
        tasaDiv.appendChild(tasaInput);
        
        miniResults.appendChild(pago1000Div);
        miniResults.appendChild(tasaDiv);
        calcCard.appendChild(miniResults);
        
        // Resultado principal
        const resultBox = document.createElement("div");
        resultBox.id = "resultadoBox";
        resultBox.style.cssText = "background:#f0f9ff;padding:15px;border-radius:8px;margin-top:15px;border:2px solid #bfdbfe;";
        
        const resLinea1 = document.createElement("div");
        resLinea1.id = "resLinea1";
        resLinea1.textContent = "Ingrese datos para ver resultados";
        resLinea1.style.cssText = "font-size:14px;color:#64748b;";
        resultBox.appendChild(resLinea1);
        
        const resLinea2 = document.createElement("div");
        resLinea2.id = "resLinea2";
        resLinea2.style.cssText = "color:#1e293b;font-weight:600;margin-top:5px;";
        resultBox.appendChild(resLinea2);
        
        const resLinea3 = document.createElement("div");
        resLinea3.id = "resLinea3";
        resLinea3.style.cssText = "color:#1e293b;margin-top:3px;";
        resultBox.appendChild(resLinea3);
        
        const errorDiv = document.createElement("div");
        errorDiv.id = "error";
        errorDiv.style.cssText = "display:none;color:#dc2626;margin-top:8px;font-size:13px;";
        resultBox.appendChild(errorDiv);
        
        calcCard.appendChild(resultBox);
        
        // Bot√≥n generar ficha
        const fichaBtn = document.createElement("button");
        fichaBtn.textContent = "Generar ficha descriptiva";
        fichaBtn.style.cssText = "width:100%;margin-top:10px;padding:10px;background:#2563eb;color:white;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:all 0.2s;";
        fichaBtn.addEventListener("mouseover", () => { fichaBtn.style.background = "#1d4ed8"; });
        fichaBtn.addEventListener("mouseout", () => { fichaBtn.style.background = "#2563eb"; });
        fichaBtn.addEventListener("click", () => { generarFicha(); });
        calcCard.appendChild(fichaBtn);
        
        const noteCalc = document.createElement("div");
        noteCalc.style.cssText = "margin-top:10px;padding:10px;background:#fff3cd;border-radius:6px;font-size:12px;";
        noteCalc.innerHTML = "<strong>Nota:</strong> Si existe un 'monto por cada $1,000' en la tabla se utilizar√°. Si no, se usar√° el monto base del producto.";
        calcCard.appendChild(noteCalc);

        container.appendChild(calcCard);
        
        // Botones de tablas
        const tablesSection = document.createElement("div");
        tablesSection.style.cssText = "margin-top:20px;padding-top:15px;border-top:2px solid #e5e7eb;";
        
        const tablesTitle = document.createElement("h4");
        tablesTitle.textContent = "Tablas por Ciclo";
        tablesTitle.style.marginTop = "0";
        tablesSection.appendChild(tablesTitle);
        
        const btnContainer = document.createElement("div");
        btnContainer.style.cssText = "display:flex;flex-wrap:wrap;gap:10px;margin-top:10px;";
        
        const tableButtons = [
          { text: "Ver tabla Mixto", id: "mixto" },
          { text: "Ver tabla Consumo", id: "consumo" },
          { text: "Ver tabla Impulso", id: "impulso" },
          { text: "Ver tabla Poder", id: "poder" },
          { text: "Ver tabla Preferente", id: "preferente" }
        ];
        
        tableButtons.forEach(btn => {
          const button = document.createElement("button");
          button.textContent = btn.text;
          button.style.cssText = "padding:8px 16px;background:#e0f2fe;border:1px solid #0ea5e9;border-radius:6px;cursor:pointer;font-size:13px;font-weight:500;transition:all 0.2s;";
          button.addEventListener("mouseover", () => {
            button.style.background = "#0ea5e9";
            button.style.color = "white";
          });
          button.addEventListener("mouseout", () => {
            button.style.background = "#e0f2fe";
            button.style.color = "inherit";
          });
          button.addEventListener("click", () => { mostrarTablaCompleta(btn.id); });
          btnContainer.appendChild(button);
        });
        
        tablesSection.appendChild(btnContainer);
        container.appendChild(tablesSection);
        
        const infoNote = document.createElement("div");
        infoNote.style.cssText = "margin-top:15px;padding:12px;background:#d1ecf1;border-radius:6px;font-size:13px;";
        infoNote.innerHTML = "<strong>üí° Importante:</strong> Esta herramienta te permite simular cr√©ditos de: Poder de Mujer, Grupal Mixto, Grupal Preferente, Consumo Avance e Impulso Solidario. Selecciona el producto, el ciclo y el monto para conocer los resultados.";
        container.appendChild(infoNote);

        const closeReminder = document.createElement("div");
        closeReminder.style.cssText = "margin-top:15px;padding:15px;background:#f87171;border-radius:6px;font-size:16px;font-weight:600;color:white;text-align:center;";
        closeReminder.innerHTML = "‚ö†Ô∏è No olvides cerrar la herramienta del simulador con el bot√≥n ‚úñ antes de continuar.";
        container.appendChild(closeReminder);
        
        // Inicializar calculadora despu√©s de agregar al DOM
        setTimeout(() => { initCalculadora(); }, 100);
        
        return { type: 'html', content: container };
      }

      return { type: 'text', content: "No entend√≠ tu consulta ü§î. Intenta de nuevo: üí∞(INGRESOS) üíµ(IGUALACION DE MONTOS) üè†(DOMICILIO) üîÑ(RENOVACIONES) üìù(ADICIONAL) üë•(GRUPOS NUEVOS) üè¢(SUCURSAL) ‚ö†Ô∏è(PENALIZACIONES) üèòÔ∏è(VIVIENDA RENTADA) üìä(RENOVACION DE SALDOS INSOLUTOS) üìÅ(DESEMBOLSO EN CAMPO) üìÇ(EXPEDIENTES) üí∞(MONTOS + DE 70000) üí∏(INCREMENTO SOCIOS ANTIGUOS) üë¥(ADULTOS MAYORES) üßÆ(CALCULADORA)?" };
    }

    function handleSend() {
      const input = document.getElementById("messageInput");
      const message = input.value.trim();
      
      if (!message) return;
      
      addMessage(message, true);
      input.value = "";
      
      setTimeout(() => {
        const response = getResponse(message);
        if (response.type === 'text') {
          addMessage(response.content, false);
        } else {
          addMessage(response.content, false);
        }
      }, 500);
    }

    document.getElementById("sendBtn").addEventListener("click", handleSend);
    document.getElementById("messageInput").addEventListener("keypress", (e) => {
      if (e.key === "Enter") {
        handleSend();
      }
    });

    // Welcome message
    setTimeout(() => {
      const advisors = ["koco bot", "koco"];
      const advisor = advisors[Math.floor(Math.random() * advisors.length)];
      const hour = new Date().getHours();
      let greeting = "¬°Hola!";
      if (hour >= 6 && hour < 12) greeting = "¬°Buenos d√≠as! üåÖ";
      else if (hour >= 12 && hour < 18) greeting = "¬°Buenas tardes! ‚òÄÔ∏è";
      else greeting = "¬°Buenas noches! üåô";

      const welcomeContainer = document.createElement("div");
      const greetingDiv = document.createElement("div");
      greetingDiv.style.fontWeight = "600";
      greetingDiv.style.marginBottom = "6px";
      greetingDiv.textContent = greeting;
      
      const messageDiv = document.createElement("div");
      messageDiv.innerHTML = `Gracias por comunicarte a la Coordinaci√≥n de Cr√©ditos Solidarios. Te atiende <strong>${advisor}</strong>. ¬øEn qu√© te puedo ayudar?`;
      
      welcomeContainer.appendChild(greetingDiv);
      welcomeContainer.appendChild(messageDiv);
      
      addMessage(welcomeContainer, false);
    }, 500);

    // Helper functions
    function $(id){ return document.getElementById(id); }
    function formatNumber(n){ return Number(n).toLocaleString('en-US'); }

    // Calculadora logic
    function initCalculadora() {
      const productoSelect = $("producto");
      const cicloSelect = $("ciclo");
      const montoInput = $("monto");
      const periodicidadSelect = $("periodicidad");
      const numPagosSelect = $("numPagos");
      
      if (!productoSelect || !cicloSelect) return;
      
      productoSelect.addEventListener("change", onProductoChange);
      cicloSelect.addEventListener("change", onCicloChange);
      periodicidadSelect.addEventListener("change", onPeriodicidadChange);
      numPagosSelect.addEventListener("change", calcular);
      montoInput.addEventListener("input", calcular);
      
      onProductoChange();
    }

    const productos = {
      mixto: {
        name: "Grupal Mixto",
        basePor1000: 68.41,
        ciclos: [
          { id:1, min:3000, max:10000, minDias:110, maxDias:187, periodos:["semanal","catorcenal","quincenal"], tasa:48 },
          { id:2, min:3000, max:15000, minDias:110, maxDias:187, periodos:["semanal","catorcenal","quincenal"], tasa:48 },
          { id:3, min:3000, max:20000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:42 },
          { id:4, min:3000, max:30000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:42 },
          { id:5, min:3000, max:40000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:6, min:3000, max:50000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:7, min:3000, max:60000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:30 },
          { id:8, min:3000, max:100000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:30 }
        ]
      },
      consumo: {
        name: "Consumo Avance",
        basePor1000: 68.41,
        ciclos: [
          { id:1, min:3000, max:10000, minDias:110, maxDias:187, periodos:["semanal","catorcenal","quincenal"], tasa:48 },
          { id:2, min:3000, max:15000, minDias:110, maxDias:187, periodos:["semanal","catorcenal","quincenal"], tasa:48 },
          { id:3, min:3000, max:20000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:42 },
          { id:4, min:3000, max:30000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:42 },
          { id:5, min:3000, max:40000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:6, min:3000, max:50000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:7, min:3000, max:60000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:30 },
          { id:8, min:3000, max:100000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:30 }
        ]
      },
      impulso: {
        name: "Impulso Solidario",
        basePor1000: 68.41,
        ciclos: [
          { id:1, min:3000, max:10000, minDias:110, maxDias:187, periodos:["semanal","catorcenal","quincenal"], tasa:48 },
          { id:2, min:3000, max:15000, minDias:110, maxDias:187, periodos:["semanal","catorcenal","quincenal"], tasa:48 },
          { id:3, min:3000, max:20000, minDias:110, maxDias:187, periodos:["semanal","catorcenal","quincenal"], tasa:48 },
          { id:4, min:3000, max:30000, minDias:110, maxDias:365, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:5, min:3000, max:40000, minDias:110, maxDias:365, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:6, min:3000, max:50000, minDias:110, maxDias:365, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:7, min:3000, max:60000, minDias:110, maxDias:365, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:8, min:3000, max:70000, minDias:110, maxDias:365, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:9, min:3000, max:80000, minDias:110, maxDias:365, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:10, min:3000, max:90000, minDias:110, maxDias:365, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:11, min:3000, max:100000, minDias:110, maxDias:365, periodos:["semanal","catorcenal","quincenal"], tasa:36 }
        ]
      },
      poder: {
        name: "Poder de Mujer",
        basePor1000: 67.65,
        ciclos: [
          { id:1, min:3000, max:10000, minDias:110, maxDias:187, periodos:["semanal","catorcenal","quincenal"], tasa:42 },
          { id:2, min:3000, max:15000, minDias:110, maxDias:187, periodos:["semanal","catorcenal","quincenal"], tasa:42 },
          { id:3, min:3000, max:20000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:4, min:3000, max:30000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:36 },
          { id:5, min:3000, max:40000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:33 },
          { id:6, min:3000, max:50000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:33 },
          { id:7, min:3000, max:60000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:30 },
          { id:8, min:3000, max:100000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:30 }
        ]
      },
      preferente: {
        name: "Grupal Preferente",
        basePor1000: 56.28,
        ciclos: [
          { id:1, min:3000, max:20000, minDias:110, maxDias:115, periodos:["semanal"], tasa:24 },
          { id:2, min:3000, max:25000, minDias:110, maxDias:115, periodos:["semanal"], tasa:24 },
          { id:3, min:3000, max:30000, minDias:110, maxDias:171, periodos:["semanal"], tasa:24 },
          { id:4, min:3000, max:40000, minDias:110, maxDias:171, periodos:["semanal","catorcenal","quincenal"], tasa:24 },
          { id:5, min:3000, max:50000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:24 },
          { id:6, min:3000, max:55000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:24 },
          { id:7, min:3000, max:60000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:24 },
          { id:8, min:3000, max:100000, minDias:110, maxDias:307, periodos:["semanal","catorcenal","quincenal"], tasa:24 }
        ]
      }
    };

    const montosPor1000 = {
      poder:{
        16:{periodicidad:"semanal",monto:67.65},
        8:{periodicidad:"catorcenal",monto:135.90},
        "8_q":{periodicidad:"quincenal",monto:136.70},
        20:{periodicidad:"semanal",monto:55.10},
        10:{periodicidad:"catorcenal",monto:110.65},
        "10_q":{periodicidad:"quincenal",monto:111.40},
        24:{periodicidad:"semanal",monto:46.70},
        12:{periodicidad:"catorcenal",monto:93.85},
        "12_q":{periodicidad:"quincenal",monto:94.60}
      },
      mixto:{
        16:{periodicidad:"semanal",monto:68.41},
        8:{periodicidad:"catorcenal",monto:137.39},
        "8_q":{periodicidad:"quincenal",monto:138.27},
        20:{periodicidad:"semanal",monto:55.78},
        10:{periodicidad:"catorcenal",monto:112.11},
        "10_q":{periodicidad:"quincenal",monto:112.98},
        24:{periodicidad:"semanal",monto:47.40},
        12:{periodicidad:"catorcenal",monto:95.26},
        "12_q":{periodicidad:"quincenal",monto:96.11}
      },
      preferente:{
        16:{periodicidad:"semanal",monto:56.28},
        8:{periodicidad:"catorcenal",monto:112.96},
        "8_q":{periodicidad:"quincenal",monto:113.75},
        20:{periodicidad:"semanal",monto:45.88},
        10:{periodicidad:"catorcenal",monto:92.20},
        "10_q":{periodicidad:"quincenal",monto:92.98},
        24:{periodicidad:"semanal",monto:39.02},
        12:{periodicidad:"catorcenal",monto:78.35},
        "12_q":{periodicidad:"quincenal",monto:79.11}
      },
      impulso:{
        16:{periodicidad:"semanal",monto:68.41},
        8:{periodicidad:"catorcenal",monto:137.39},
        "8_q":{periodicidad:"quincenal",monto:138.27},
        20:{periodicidad:"semanal",monto:55.78},
        10:{periodicidad:"catorcenal",monto:112.11},
        "10_q":{periodicidad:"quincenal",monto:112.98},
        24:{periodicidad:"semanal",monto:47.40},
        12:{periodicidad:"catorcenal",monto:95.26},
        "12_q":{periodicidad:"quincenal",monto:96.11}
      },
      consumo:{
        16:{periodicidad:"semanal",monto:68.41},
        8:{periodicidad:"catorcenal",monto:137.39},
        "8_q":{periodicidad:"quincenal",monto:138.27},
        20:{periodicidad:"semanal",monto:55.78},
        10:{periodicidad:"catorcenal",monto:112.11},
        "10_q":{periodicidad:"quincenal",monto:112.98},
        24:{periodicidad:"semanal",monto:47.40},
        12:{periodicidad:"catorcenal",monto:95.26},
        "12_q":{periodicidad:"quincenal",monto:96.11}
      }
    };

    function llenarCiclos(prodKey){
      const sel = $('ciclo');
      sel.innerHTML = '';
      productos[prodKey].ciclos.forEach(c => {
        const opt = document.createElement('option');
        opt.value = c.id;
        opt.text = `Ciclo ${c.id} ‚Äî $${formatNumber(c.min)} - $${formatNumber(c.max)} ‚Äî ${c.minDias}-${c.maxDias} d√≠as ‚Äî ${c.tasa}%`;
        sel.appendChild(opt);
      });
    }

    function llenarPeriodicidades(prodKey, cicloId){
      const sel = $('periodicidad');
      sel.innerHTML = '';
      const ciclo = productos[prodKey].ciclos.find(x => x.id == cicloId);
      ciclo.periodos.forEach(p => {
        const opt = document.createElement('option');
        opt.value = p;
        opt.text = p.charAt(0).toUpperCase() + p.slice(1);
        sel.appendChild(opt);
      });
    }

    function generarOpcionesPagos(ciclo, periodicidad){
      let periodDays = 7;
      if (periodicidad === 'catorcenal') periodDays = 14;
      if (periodicidad === 'quincenal') periodDays = 15;
      const minPagos = Math.ceil(ciclo.minDias / periodDays);
      const maxPagos = Math.ceil(ciclo.maxDias / periodDays);

      const comunes = { semanal:[16,20,24,28,32,40], catorcenal:[8,10,12,14,20], quincenal:[8,10,12,14,20] };
      const listaComunes = (comunes[periodicidad] || []).filter(n => n >= minPagos && n <= maxPagos);
      if (listaComunes.length) return listaComunes;

      const arr = [];
      for (let n = minPagos; n <= maxPagos && arr.length < 20; n++) arr.push(n);
      return arr;
    }

    function onProductoChange(){
      const prod = $('producto').value;
      llenarCiclos(prod);
      llenarPeriodicidades(prod, $('ciclo').value);
      onPeriodicidadChange();
      calcular();
    }

    function onCicloChange(){
      const prod = $('producto').value;
      const ciclo = $('ciclo').value;
      llenarPeriodicidades(prod, ciclo);
      onPeriodicidadChange();
      calcular();
    }

    function onPeriodicidadChange(){
      const prod = $('producto').value;
      const cicloId = Number($('ciclo').value);
      const periodo = $('periodicidad').value;
      const ciclo = productos[prod].ciclos.find(c => c.id === cicloId);
      const opciones = generarOpcionesPagos(ciclo, periodo);
      const sel = $('numPagos');
      sel.innerHTML = '';
      opciones.forEach(n => {
        const o = document.createElement('option'); 
        o.value = n; 
        o.text = n + ' pagos'; 
        sel.appendChild(o);
      });
      calcular();
    }

    function buscarMontoPor1000(prodKey, numPagos, periodicidad){
      const map = montosPor1000[prodKey];
      if (!map) return null;
      if (periodicidad === 'quincenal'){
        const q = map[numPagos + '_q']; 
        if (q) return q.monto;
      }
      const v = map[numPagos];
      if (v && v.periodicidad === periodicidad) return v.monto;
      return null;
    }

    // Funci√≥n PAGO de Excel
    function PAGO(tasa, nper, vp) {
      if (tasa === 0) return vp / nper;
      return (tasa * vp) / (1 - Math.pow(1 + tasa, -nper));
    }

    function diasPorPeriodicidad(periodicidad){
      if (periodicidad === "semanal") return 7;
      if (periodicidad === "catorcenal") return 14;
      if (periodicidad === "quincenal") return 15;
      if (periodicidad === "mensual") return 30;
      return 0;
    }

    function calcular(){
      const prodKey = $('producto').value;
      const prod = productos[prodKey];
      const cicloId = Number($('ciclo').value);
      const ciclo = prod.ciclos.find(c => c.id === cicloId);

      const monto = parseFloat($('monto').value);
      if (!monto || monto <= 0){
        $('resLinea1').textContent = 'Ingrese datos para ver resultados';
        $('resLinea2').textContent = ''; 
        $('resLinea3').textContent = '';
        $('error').style.display = 'none';
        $('pago1000').value = '';
        $('tasaCiclo').value = ciclo.tasa + '%';
        return;
      }

      if (monto < ciclo.min || monto > ciclo.max){
        $('error').style.display = 'block';
        $('error').textContent = `El monto debe estar entre $${formatNumber(ciclo.min)} y $${formatNumber(ciclo.max)} para este ciclo (por integrante).`;
        $('resLinea1').textContent = 'Monto fuera de rango'; 
        $('resLinea2').textContent = ''; 
        $('resLinea3').textContent = '';
        $('pago1000').value = '';
        $('tasaCiclo').value = ciclo.tasa + '%';
        return;
      } else {
        $('error').style.display = 'none';
      }

      const periodicidad = $('periodicidad').value;
      const numPagos = Number($('numPagos').value);
      const tasaAnual = ciclo.tasa / 100;
      const aplicaIVA = true;
      const iva = 0.16;
      const diasPeriodo = diasPorPeriodicidad(periodicidad);
      
      $('tasaCiclo').value = ciclo.tasa + '%';

      const tasaPeriodo = ((tasaAnual * (1 + (aplicaIVA ? iva : 0))) / 360) * diasPeriodo;
      const cuota = Math.abs(PAGO(tasaPeriodo, numPagos, -monto));
      const total = cuota * numPagos;

      const cuotaPor1000 = Math.abs(PAGO(tasaPeriodo, numPagos, -1000));
      $('pago1000').value = `$ ${cuotaPor1000.toFixed(2)} por $1,000`;

      $('resLinea1').textContent = `Monto por cuota: $${formatNumber(cuota.toFixed(2))} (con IVA incluido)`;
      $('resLinea2').textContent = `N√∫mero de pagos: ${numPagos}. Total a pagar: $${formatNumber(total.toFixed(2))}.`;
      $('resLinea3').textContent = `Periodicidad: ${periodicidad}. Tasa del ciclo: ${ciclo.tasa}%.`;
    }

    function generarFicha(){
      const prodKey = $('producto').value;
      const prod = productos[prodKey];
      const cicloId = Number($('ciclo').value);
      const ciclo = prod.ciclos.find(c => c.id === cicloId);
      const monto = parseFloat($('monto').value);
      
      if (!monto || monto <= 0){ 
        const container = document.createElement("div");
        container.style.cssText = "padding:12px;background:#fee2e2;border-radius:8px;color:#dc2626;";
        container.textContent = "Ingrese un monto v√°lido";
        addMessage(container, false);
        return; 
      }
      
      if (monto < ciclo.min || monto > ciclo.max){ 
        const container = document.createElement("div");
        container.style.cssText = "padding:12px;background:#fee2e2;border-radius:8px;color:#dc2626;";
        container.textContent = `Monto fuera de rango. Debe estar entre $${formatNumber(ciclo.min)} y $${formatNumber(ciclo.max)}.`;
        addMessage(container, false);
        return; 
      }
      
      const periodicidad = $('periodicidad').value;
      const numPagos = Number($('numPagos').value);
      const tasaAnual = ciclo.tasa / 100;
      const aplicaIVA = true;
      const iva = 0.16;
      const diasPeriodo = diasPorPeriodicidad(periodicidad);
      
      const tasaPeriodo = ((tasaAnual * (1 + (aplicaIVA ? iva : 0))) / 360) * diasPeriodo;
      const cuota = Math.abs(PAGO(tasaPeriodo, numPagos, -monto));
      const total = cuota * numPagos;
      const cuotaPor1000 = Math.abs(PAGO(tasaPeriodo, numPagos, -1000));
      
      const container = document.createElement("div");
      container.style.cssText = "background:white;padding:20px;border-radius:12px;box-shadow:0 4px 12px rgba(0,0,0,0.15);";
      
      const titulo = document.createElement("h3");
      titulo.textContent = `üìã Ficha Descriptiva - ${prod.name}`;
      titulo.style.cssText = "margin-top:0;margin-bottom:15px;color:#1e40af;";
      container.appendChild(titulo);
      
      const table = createTable(
        ["Campo", "Valor"],
        [
          ["Producto", prod.name],
          ["Ciclo", ciclo.id.toString()],
          ["Monto solicitado (por integrante)", `$${formatNumber(monto.toFixed(2))}`],
          ["Rango ciclo", `$${formatNumber(ciclo.min)} - $${formatNumber(ciclo.max)}`],
          ["Periodicidad", periodicidad.charAt(0).toUpperCase() + periodicidad.slice(1)],
          ["N√∫mero de pagos", numPagos.toString()],
          ["Tasa anual", `${ciclo.tasa}%`],
          ["Tasa periodo (con IVA)", `${(tasaPeriodo * 100).toFixed(4)}%`],
          ["Pago por $1,000", `$${cuotaPor1000.toFixed(2)}`],
          ["Monto por cuota", `$${formatNumber(cuota.toFixed(2))}`],
          ["Total a pagar", `$${formatNumber(total.toFixed(2))}`]
        ]
      );
      container.appendChild(table);

      // Opciones despu√©s de simular
      const opcionesDiv = document.createElement("div");
      opcionesDiv.style.cssText = "margin-top:20px;padding-top:15px;border-top:2px solid #e5e7eb;";
      
      const opcionesTitulo = document.createElement("div");
      opcionesTitulo.textContent = "¬øQu√© deseas hacer ahora?";
      opcionesTitulo.style.cssText = "margin-bottom:12px;font-weight:600;color:#1e293b;";
      opcionesDiv.appendChild(opcionesTitulo);
      
      const botonesContainer = document.createElement("div");
      botonesContainer.style.cssText = "display:flex;flex-wrap:wrap;gap:10px;";
      
      // Bot√≥n ver tabla completa
      const btnTabla = document.createElement("button");
      btnTabla.textContent = `üìä Ver tabla completa de ${prod.name}`;
      btnTabla.style.cssText = "flex:1;min-width:200px;padding:10px 16px;background:#10b981;color:white;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:all 0.2s;";
      btnTabla.addEventListener("mouseover", () => { btnTabla.style.background = "#059669"; });
      btnTabla.addEventListener("mouseout", () => { btnTabla.style.background = "#10b981"; });
      btnTabla.addEventListener("click", () => { mostrarTablaCompleta(prodKey); });
      botonesContainer.appendChild(btnTabla);
      
      opcionesDiv.appendChild(botonesContainer);
      container.appendChild(opcionesDiv);

      addMessage(container, false);
    }

    function mostrarTablaCompleta(producto) {
      const tablasCompletas = {
        mixto: {
          titulo: "TABLA DE CICLOS GRUPAL MIXTO",
          filas: [
            ["1", "$3,000", "$10,000", "110", "187", "Semanal/Catorcenal/Quincenal", "48%"],
            ["2", "$3,000", "$15,000", "110", "187", "Semanal/Catorcenal/Quincenal", "48%"],
            ["3", "$3,000", "$20,000", "110", "307", "Semanal/Catorcenal/Quincenal", "42%"],
            ["4", "$3,000", "$30,000", "110", "307", "Semanal/Catorcenal/Quincenal", "42%"],
            ["5", "$3,000", "$40,000", "110", "307", "Semanal/Catorcenal/Quincenal", "36%"],
            ["6", "$3,000", "$50,000", "110", "307", "Semanal/Catorcenal/Quincenal", "36%"],
            ["7", "$3,000", "$60,000", "110", "307", "Semanal/Catorcenal/Quincenal", "30%"],
            ["8", "$3,000", "$70,000 - $100,000", "110", "307", "Semanal/Catorcenal/Quincenal", "30%"]
          ]
        },
        consumo: {
          titulo: "TABLA DE CICLOS CONSUMO AVANCE",
          filas: [
            ["1", "$3,000", "$10,000", "110", "187", "Semanal/Catorcenal/Quincenal", "48%"],
            ["2", "$3,000", "$15,000", "110", "187", "Semanal/Catorcenal/Quincenal", "48%"],
            ["3", "$3,000", "$20,000", "110", "307", "Semanal/Catorcenal/Quincenal", "42%"],
            ["4", "$3,000", "$30,000", "110", "307", "Semanal/Catorcenal/Quincenal", "42%"],
            ["5", "$3,000", "$40,000", "110", "307", "Semanal/Catorcenal/Quincenal", "36%"],
            ["6", "$3,000", "$50,000", "110", "307", "Semanal/Catorcenal/Quincenal", "36%"],
            ["7", "$3,000", "$60,000", "110", "307", "Semanal/Catorcenal/Quincenal", "30%"],
            ["8", "$3,000", "$70,000 - $100,000", "110", "307", "Semanal/Catorcenal/Quincenal", "30%"]
          ]
        },
        impulso: {
          titulo: "TABLA DE CICLOS IMPULSO SOLIDARIO",
          filas: [
            ["1", "$3,000", "$10,000", "", "4 MESES", "Semanal/Catorcenal/Quincenal", "48%"],
            ["2", "$3,000", "$15,000", "", "4 MESES", "Semanal/Catorcenal/Quincenal", "48%"],
            ["3", "$3,000", "$20,000", "", "4 MESES", "Semanal/Catorcenal/Quincenal", "48%"],
            ["4", "$3,000", "$30,000", "", "12 MESES", "Semanal/Catorcenal/Quincenal", "36%"],
            ["5", "$3,000", "$40,000", "", "12 MESES", "Semanal/Catorcenal/Quincenal", "36%"],
            ["6", "$3,000", "$50,000", "", "12 MESES", "Semanal/Catorcenal/Quincenal", "36%"],
            ["7", "$3,000", "$60,000", "", "12 MESES", "Semanal/Catorcenal/Quincenal", "36%"],
            ["8", "$3,000", "$70,000", "", "12 MESES", "Semanal/Catorcenal/Quincenal", "36%"],
            ["9", "$3,000", "$80,000", "", "12 MESES", "Semanal/Catorcenal/Quincenal", "36%"],
            ["10", "$3,000", "$90,000", "", "12 MESES", "Semanal/Catorcenal/Quincenal", "36%"],
            ["11", "$3,000", "$100,000", "", "12 MESES", "Semanal/Catorcenal/Quincenal", "36%"]
          ]
        },
        poder: {
          titulo: "TABLA DE CICLOS PODER DE MUJER",
          filas: [
            ["1", "$3,000", "$10,000", "110", "187", "Semanal/Catorcenal/Quincenal", "42%"],
            ["2", "$3,000", "$15,000", "110", "187", "Semanal/Catorcenal/Quincenal", "42%"],
            ["3", "$3,000", "$20,000", "110", "307", "Semanal/Catorcenal/Quincenal", "36%"],
            ["4", "$3,000", "$30,000", "110", "307", "Semanal/Catorcenal/Quincenal", "36%"],
            ["5", "$3,000", "$40,000", "110", "307", "Semanal/Catorcenal/Quincenal", "33%"],
            ["6", "$3,000", "$50,000", "110", "307", "Semanal/Catorcenal/Quincenal", "33%"],
            ["7", "$3,000", "$60,000", "110", "307", "Semanal/Catorcenal/Quincenal", "30%"],
            ["8", "$3,000", "$70,000 - $100,000", "110", "307", "Semanal/Catorcenal/Quincenal", "30%"]
          ]
        },
        preferente: {
          titulo: "TABLA DE CICLOS GRUPAL PREFERENTE",
          filas: [
            ["1", "$3,000", "$20,000", "110", "115", "Semanal", "24%"],
            ["2", "$3,000", "$25,000", "110", "115", "Semanal", "24%"],
            ["3", "$3,000", "$30,000", "110", "171", "Semanal", "24%"],
            ["4", "$3,000", "$40,000", "110", "171", "Semanal/Catorcenal/Quincenal", "24%"],
            ["5", "$3,000", "$50,000", "110", "307", "Semanal/Catorcenal/Quincenal", "24%"],
            ["6", "$3,000", "$55,000", "110", "307", "Semanal/Catorcenal/Quincenal", "24%"],
            ["7", "$3,000", "$60,000", "110", "307", "Semanal/Catorcenal/Quincenal", "24%"],
            ["8", "$3,000", "$70,000 - $100,000", "110", "307", "Semanal/Catorcenal/Quincenal", "24%"]
          ]
        }
      };

      const tablaData = tablasCompletas[producto];
      if (!tablaData) return;

      const container = document.createElement("div");
      
      const titulo = document.createElement("h4");
      titulo.textContent = tablaData.titulo;
      titulo.style.marginTop = "0";
      titulo.style.marginBottom = "15px";
      titulo.style.color = "#1e40af";
      container.appendChild(titulo);

      const table = createTable(
        ["CICLO", "MIN", "MAX", "MIN D√çAS", "MAX D√çAS", "PERIODICIDAD", "TASA"],
        tablaData.filas
      );
      container.appendChild(table);

      addMessage(container, false);
    }

    async function onConfigChange(config) {
      const baseSize = config.font_size || defaultConfig.font_size;
      const customFont = config.font_family || defaultConfig.font_family;
      const baseFontStack = 'Tahoma, Geneva, Verdana, sans-serif';

      // Apply colors
      const header = document.getElementById("chatHeader");
      header.style.background = `linear-gradient(135deg, ${config.background_color || defaultConfig.background_color}, ${config.primary_action_color || defaultConfig.primary_action_color})`;

      const chatMessages = document.getElementById("chatMessages");
      chatMessages.style.background = config.secondary_surface_color || defaultConfig.secondary_surface_color;

      const userMessages = document.querySelectorAll(".user-message");
      userMessages.forEach(msg => {
        msg.style.background = config.primary_action_color || defaultConfig.primary_action_color;
      });

      const botMessages = document.querySelectorAll(".bot-message");
      botMessages.forEach(msg => {
        msg.style.background = config.secondary_action_color || defaultConfig.secondary_action_color;
        msg.style.borderColor = config.secondary_surface_color || defaultConfig.secondary_surface_color;
        msg.style.color = config.text_color || defaultConfig.text_color;
      });

      const sendBtn = document.getElementById("sendBtn");
      sendBtn.style.background = config.primary_action_color || defaultConfig.primary_action_color;

      const input = document.getElementById("messageInput");
      input.style.color = config.text_color || defaultConfig.text_color;

      // Apply fonts
      document.body.style.fontFamily = `${customFont}, ${baseFontStack}`;
      document.body.style.fontSize = `${baseSize}px`;

      const title = document.getElementById("chatTitle");
      title.style.fontSize = `${baseSize * 1.5}px`;
      title.textContent = config.chat_title || defaultConfig.chat_title;

      const subtitle = document.getElementById("chatSubtitle");
      subtitle.style.fontSize = `${baseSize * 0.9375}px`;
      subtitle.textContent = config.chat_subtitle || defaultConfig.chat_subtitle;

      const headerMessage = document.getElementById("headerMessage");
      headerMessage.style.fontSize = `${baseSize * 0.9375}px`;
      headerMessage.textContent = config.header_message || defaultConfig.header_message;

      const footerText = document.getElementById("footerText");
      footerText.style.fontSize = `${baseSize * 0.875}px`;
      footerText.textContent = config.footer_text || defaultConfig.footer_text;

      input.placeholder = config.input_placeholder || defaultConfig.input_placeholder;

      sendBtn.style.fontSize = `${baseSize * 0.9375}px`;
    }

    if (window.elementSdk) {
      window.elementSdk.init({
        defaultConfig,
        onConfigChange,
        mapToCapabilities: (config) => ({
          recolorables: [
            {
              get: () => config.background_color || defaultConfig.background_color,
              set: (value) => {
                config.background_color = value;
                window.elementSdk.setConfig({ background_color: value });
              }
            },
            {
              get: () => config.secondary_surface_color || defaultConfig.secondary_surface_color,
              set: (value) => {
                config.secondary_surface_color = value;
                window.elementSdk.setConfig({ secondary_surface_color: value });
              }
            },
            {
              get: () => config.text_color || defaultConfig.text_color,
              set: (value) => {
                config.text_color = value;
                window.elementSdk.setConfig({ text_color: value });
              }
            },
            {
              get: () => config.primary_action_color || defaultConfig.primary_action_color,
              set: (value) => {
                config.primary_action_color = value;
                window.elementSdk.setConfig({ primary_action_color: value });
              }
            },
            {
              get: () => config.secondary_action_color || defaultConfig.secondary_action_color,
              set: (value) => {
                config.secondary_action_color = value;
                window.elementSdk.setConfig({ secondary_action_color: value });
              }
            }
          ],
          borderables: [],
          fontEditable: {
            get: () => config.font_family || defaultConfig.font_family,
            set: (value) => {
              config.font_family = value;
              window.elementSdk.setConfig({ font_family: value });
            }
          },
          fontSizeable: {
            get: () => config.font_size || defaultConfig.font_size,
            set: (value) => {
              config.font_size = value;
              window.elementSdk.setConfig({ font_size: value });
            }
          }
        }),
        mapToEditPanelValues: (config) => new Map([
          ["chat_title", config.chat_title || defaultConfig.chat_title],
          ["chat_subtitle", config.chat_subtitle || defaultConfig.chat_subtitle],
          ["header_message", config.header_message || defaultConfig.header_message],
          ["footer_text", config.footer_text || defaultConfig.footer_text],
          ["input_placeholder", config.input_placeholder || defaultConfig.input_placeholder]
        ])
      });
    }
  </script>

  <!-- SERVICE WORKER -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", () => {
        navigator.serviceWorker
          .register("sw.js")
          .then(reg => console.log("‚úÖ Service Worker registrado:", reg.scope))
          .catch(err => console.error("‚ùå Error SW:", err));
      });
    }
  </script>

  <!-- Cloudflare (si es obligatorio) -->
  <script>
    (function(){function c(){var b=a.contentDocument||a.contentWindow.document;
    if(b){var d=b.createElement('script');
    d.innerHTML="window.__CF$cv$params={r:'9c6b591b21375638',t:'MTc2OTg4NDkzNy4wMDAwMDA='};";
    b.getElementsByTagName('head')[0].appendChild(d)}}
    if(document.body){var a=document.createElement('iframe');
    a.height=1;a.width=1;a.style.display='none';
    document.body.appendChild(a);
    if(document.readyState!=='loading')c();
    else document.addEventListener('DOMContentLoaded',c);}})();
  </script>

</body>
</html>
